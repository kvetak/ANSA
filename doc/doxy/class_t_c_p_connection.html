<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>INET Framework for OMNeT++/OMNEST: TCPConnection Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">INET Framework for OMNeT++/OMNEST</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_t_c_p_connection.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle">
<div class="title">TCPConnection Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="TCPConnection" -->
<p><code>#include &lt;TCPConnection.h&gt;</code></p>

<p><a href="class_t_c_p_connection-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData</a> (bool fullSegmentsOnly, uint32 congestionWindow)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment</a> (bool called_at_rto)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a> (uint32 seqNo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3dc25263bb2f0b1013ee398c1587b128">sendRst</a> (uint32 seq, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a> (uint32 seq, uint32 ack, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest, int srcPort, int destPort)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a> (uint32 bytes)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a> (const char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a264eb196b44591ed68422a9e70dab680">signalConnectionTimeout</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a> (cMessage *msg, simtime_t timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, bool doAlways=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection</a> (<a class="el" href="class_t_c_p.html">TCP</a> *mod, int <a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>, int <a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpSeg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> srcAddr, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> destAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a> (uint32 seqNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4fb6aaf244a5da2eaa02af271099a06b">sendDataDuringLossRecoveryPhase</a> (uint32 congestionWindow)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase</a> (uint32 seqNum)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment</a> (bool fullSegmentsOnly, uint32 congestionWindow)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad2ab4393f60b26351d445334d4626cc7">convertSimtimeToTS</a> (simtime_t simtime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af8c2c97216e867103c61e0b6393ba625">convertTSToSimtime</a> (uint32 timestamp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aafbfa20356a296e70ca483daa9132460">isSendQueueEmpty</a> ()</td></tr>
<tr><td colspan="2"><div class="groupHeader">Various getters</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa96e386d3f5d597dd0c03c52a103071d">getFsmState</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a2bf497c23b9c58dbf704a511e36f19f1">getState</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1ef81a39ac3ed1ef11b5d141136c1926">getSendQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1eebaa12717ee8c8197b744275e0c7b0">getRexmitQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3c6829af5f8233ce0a666cda858374e6">getReceiveQueue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6a70265d4b753e5eefb47c2cdc54e9f5">getTcpAlgorithm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5c9318d9fe504d7e5779a5b2eab87e09">getTcpMain</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a> (int <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a> (int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a> (int code)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad7429706bcb29990ebfc65ff24970faa">optionName</a> (int option)</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_connection.html">TCPConnection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a> (TCPOpenCommand *openCmd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3d4824b8c96a46028c5a337c1ae22f59">getTSval</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5aac66dd96f84aae48e8fb0e45b86861">getTSecr</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a> (cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a> (int code)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a> ()</td></tr>
<tr><td colspan="2"><div class="groupHeader">FSM transitions: analysing events and executing state transitions</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a> (int commandCode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a> (const <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a> (int <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing app commands. Invoked from processAppCommand().</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event, TCPCommand *tcpCommand, cMessage *msg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing TCP segment arrivals. Invoked from processTCPSegment().</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing of TCP options. Invoked from readHeaderOptions(). Return value indicates whether the option was valid.</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const TCPOption &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a83bb4cd8bc8912d6bfbf6e7e5b47e4b2">processWSOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const TCPOption &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const TCPOption &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const TCPOption &amp;option)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#adc95d91946a80a2ad98b0d0b1e40909e">processTSOption</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, const TCPOption &amp;option)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Processing timeouts. Invoked from processTimer().</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a> (<a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;event)</td></tr>
<tr><td colspan="2"><h2><a name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a8763146770969da7d0a1196efe23615c">sendToIP</a> (<a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> src, <a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> dest)</td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p.html">TCP</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cFSM&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cOutVector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Manages a <a class="el" href="class_t_c_p.html">TCP</a> connection. This class itself implements the <a class="el" href="class_t_c_p.html">TCP</a> state machine as well as handling control PDUs (SYN, SYN+ACK, RST, FIN, etc.), timers (2MSL, CONN-ESTAB, FIN-WAIT-2) and events (OPEN, SEND, etc) associated with <a class="el" href="class_t_c_p.html">TCP</a> state changes.</p>
<p>The implementation largely follows the functional specification at the end of RFC 793. Code comments extensively quote RFC 793 to make it easier to understand.</p>
<p><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> objects are not used alone -- they are instantiated and managed by a <a class="el" href="class_t_c_p.html">TCP</a> module.</p>
<p><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> "outsources" several tasks to objects subclassed from <a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>, <a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> and <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>; see overview of this with <a class="el" href="class_t_c_p.html">TCP</a> documentation.</p>
<p>Connection variables (TCB) are kept in <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>. <a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> implementations can extend <a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a> to add their own stuff (see <a class="el" href="class_t_c_p_algorithm.html#a07ec2c74836af2485af586023ca9c915">TCPAlgorithm::createStateVariables()</a> factory method.)</p>
<p>The "entry points" of TCPConnnection from <a class="el" href="class_t_c_p.html">TCP</a> are:</p>
<ul>
<li><a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer(cMessage *msg)</a>: handle self-messages which belong to the connection</li>
<li><a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)</a>: handle segment arrivals</li>
<li><a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand(cMessage *msg)</a>: process commands which arrive from the application (TCP_C_xxx)</li>
</ul>
<p>All three methods follow a common structure:</p>
<ol type="1">
<li>dispatch to specific methods. For example, <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a> invokes one of <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a> or <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, etc., and <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a> dispatches to <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a> or <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>. Those methods will do the REAL JOB.</li>
<li>after they return, we'll know the state machine event (TCPEventCode, TCP_E_xxx) for sure, so we can:</li>
<li>invoke <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> which executes the necessary state transition (for example, TCP_E_RCV_SYN will take the state machine from TCP_S_LISTEN to TCP_S_SYN_RCVD). No other actions are taken in this step.</li>
<li>if there was a state change (for example, we entered the TCP_S_ESTABLISHED state), <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a> invokes <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, which performs some necessary housekeeping (cancel the CONN-ESTAB timer).</li>
</ol>
<p>When the CLOSED state is reached, <a class="el" href="class_t_c_p.html">TCP</a> will delete the <a class="el" href="class_t_c_p_connection.html">TCPConnection</a> object. </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aab510bb961623a41ade36bfbda9f86b6"></a><!-- doxytag: member="TCPConnection::TCPConnection" ref="aab510bb961623a41ade36bfbda9f86b6" args="(TCP *mod, int appGateIndex, int connId)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p.html">TCP</a> *&#160;</td>
          <td class="paramname"><em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>appGateIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>connId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The "normal" constructor. </p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a> = _mod;
    <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a> = _appGateIndex;
    <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> = _connId;

    <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> = <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a> = -1;

    <span class="keywordtype">char</span> fsmname[24];
    sprintf(fsmname, <span class="stringliteral">&quot;fsm-%d&quot;</span>, <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
    <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.setName(fsmname);
    <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.setState(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>);


    <span class="comment">// queues and algorithm will be created on active or passive open</span>
    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = NULL;

    <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;2MSL&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;CONN-ESTAB&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;FIN-WAIT-2&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;SYN-REXMIT&quot;</span>);

    <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
    <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
    <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>-&gt;setContextPointer(<span class="keyword">this</span>);
    <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>-&gt;setContextPointer(<span class="keyword">this</span>);

    <span class="comment">// statistics</span>
    <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> = NULL;

    <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = NULL;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a5c9318d9fe504d7e5779a5b2eab87e09">getTcpMain</a>()-&gt;recordStatistics)
    {
        <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;send window&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;receive window&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;advertised window&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent seq&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent ack&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd seq&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd ack&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;unacked bytes&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd dupAcks&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;pipe&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;sent sacks&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd sacks&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd oooseg&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;rcvd sackedBytes&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;tcpRcvQueueBytes&quot;</span>);
        <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = <span class="keyword">new</span> cOutVector(<span class="stringliteral">&quot;tcpRcvQueueDrops&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a11a3cccb118b0b66bee1a07929510e4c"></a><!-- doxytag: member="TCPConnection::TCPConnection" ref="a11a3cccb118b0b66bee1a07929510e4c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Note: this default ctor is NOT used to create live connections, only temporary ones so that TCPMain can invoke their <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Note: this ctor is NOT used to create live connections, only</span>
    <span class="comment">// temporary ones to invoke segmentArrivalWhileClosed() on</span>
    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a> = <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a> = <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = NULL;
    <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a> = <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a> = <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a> = <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> = <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a> = <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a> = <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a> = <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a> =
    <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a> = <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a> = <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a> = <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a> =
    <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a> = <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a> = <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a> = <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a> = NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0b79ac9c31e99766954c9cca733a362d"></a><!-- doxytag: member="TCPConnection::~TCPConnection" ref="a0b79ac9c31e99766954c9cca733a362d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TCPConnection::~TCPConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor. </p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)   <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)  <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);

    <span class="comment">// statistics</span>
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>;
    <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="afada098bf955db81aa1786f33c813363"></a><!-- doxytag: member="TCPConnection::addSacks" ref="afada098bf955db81aa1786f33c813363" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> TCPConnection::addSacks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: adds SACKs to segments header options field </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    TCPOption option;
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> options_len = 0;
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> used_options_len = 0;
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> m = 0; <span class="comment">// number of sack blocks to be sent in current segment</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> n = 0; <span class="comment">// number of sack blocks in sacks_array before sending current segment</span>
    <span class="keywordtype">bool</span> skip_sacks_array = <span class="keyword">false</span>; <span class="comment">// set if dsack is subsets of a bigger sack block recently reported</span>
    <span class="keywordtype">bool</span> overlap = <span class="keyword">false</span>; <span class="comment">// set if recently reported sack blocks are subsets of &quot;sacks_array[0]&quot;</span>

    uint32 start = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a>;
    uint32 end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a>;

    ASSERT(start!=0 || end!=0);

    <span class="comment">// delete old sacks (below rcv_nxt), delete duplicates and print previous status of sacks_array:</span>
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Previous status of sacks_array: \n&quot;</span>;
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;<a class="code" href="_t_c_p_connection_8h.html#a07b8719be91287fc05f5e527852bc1ec">MAX_SACK_BLOCKS</a>; a++) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart()!=0 &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
        {
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].setStart(0);
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].setEnd(0);
        }
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart()!=0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd()!=0) <span class="comment">// do not print empty entries</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; (a+1) &lt;&lt; <span class="stringliteral">&quot;. SACK in sacks_array:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
        <span class="keywordflow">else</span>
            <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;MAX_SACK_BLOCKS-1; a++)
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart() != 0)
            m++;
        <span class="keywordflow">else</span>
            <span class="keywordflow">break</span>;
    }
    n = m + 1; <span class="comment">// +1 for new the new sack block</span>

    <span class="comment">// 2 padding bytes are prefixed or TS option is present</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getOptionsArraySize()&gt;0)
    {
        <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
            used_options_len = used_options_len + tcpseg-&gt;getOptions(i).getLength();
        <span class="keywordflow">if</span> (used_options_len&gt;30)
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Failed to addSacks - at least 10 free bytes needed for SACK - used_options_len=&quot;</span> &lt;&lt; used_options_len &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
            <span class="comment">//reset flags:</span>
            skip_sacks_array = <span class="keyword">false</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a>  = <span class="keyword">false</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">false</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = 0;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = 0;
            <span class="keywordflow">return</span> *tcpseg;
        }
        <span class="keywordflow">else</span>
        {
            n = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (n, (((40-used_options_len)-2)/8));
            option.setValuesArraySize(n*2);
        }
    }
    <span class="keywordflow">else</span>
    {
        n = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (n, MAX_SACK_ENTRIES);
        option.setValuesArraySize(n*2);
    }

    <span class="comment">// before adding a new sack move old sacks by one to the right</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=(MAX_SACK_BLOCKS-1); a&gt;=0; a--) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];

    if (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>) <span class="comment">// SequenceNo &lt; rcv_nxt</span>
    {
        <span class="comment">// RFC 2883, page 3:</span>
        <span class="comment">// &quot;(3) The left edge of the D-SACK block specifies the first sequence</span>
        <span class="comment">// number of the duplicate contiguous sequence, and the right edge of</span>
        <span class="comment">// the D-SACK block specifies the sequence number immediately following</span>
        <span class="comment">// the last sequence in the duplicate contiguous sequence.&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(start, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>) &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, end))
            end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (start==0 &amp;&amp; end==0) <span class="comment">// rcv_nxt_old != rcv_nxt</span>
    {
        <span class="comment">// RFC 2018, page 4:</span>
        <span class="comment">// &quot;* The first SACK block (i.e., the one immediately following the</span>
        <span class="comment">// kind and length fields in the option) MUST specify the contiguous</span>
        <span class="comment">// block of data containing the segment which triggered this ACK,</span>
        <span class="comment">// unless that segment advanced the Acknowledgment Number field in</span>
        <span class="comment">// the header.  This assures that the ACK with the SACK option</span>
        <span class="comment">// reflects the most recent change in the data receiver&#39;s buffer</span>
        <span class="comment">// queue.&quot;</span>
        start = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].getStart();
        end = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].getEnd();
    }
    <span class="keywordflow">else</span> <span class="comment">// rcv_nxt_old == rcv_nxt or end &lt;= rcv_nxt</span>
    {
        <span class="comment">// RFC 2018, page 4:</span>
        <span class="comment">// &quot;* The first SACK block (i.e., the one immediately following the</span>
        <span class="comment">// kind and length fields in the option) MUST specify the contiguous</span>
        <span class="comment">// block of data containing the segment which triggered this ACK,&quot;</span>
        start = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a63808618fe6b4b592302c440414ac093">getLE</a>(start);
        end = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a747e434e4b2f48059269f6ba81c6593c">getRE</a>(end);
    }

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].setStart(start);
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[0].setEnd(end);

    <span class="comment">// RFC 2883, page 3:</span>
    <span class="comment">// &quot;(4) If the D-SACK block reports a duplicate contiguous sequence from</span>
    <span class="comment">// a (possibly larger) block of data in the receiver&#39;s data queue above</span>
    <span class="comment">// the cumulative acknowledgement, then the second SACK block in that</span>
    <span class="comment">// SACK option should specify that (possibly larger) block of data.</span>
    <span class="comment">//</span>
    <span class="comment">// (5) Following the SACK blocks described above for reporting duplicate</span>
    <span class="comment">// segments, additional SACK blocks can be used for reporting additional</span>
    <span class="comment">// blocks of data, as specified in RFC 2018.&quot;</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
    {
        uint32 start_new = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a63808618fe6b4b592302c440414ac093">getLE</a>(start);
        uint32 end_new = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a747e434e4b2f48059269f6ba81c6593c">getRE</a>(end);
        <span class="keywordflow">if</span> (start_new != start || end_new != end)
        {
            skip_sacks_array = <span class="keyword">true</span>;
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=(MAX_SACK_BLOCKS-1); a&gt;=1; a--) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[1].setStart(start_new); <span class="comment">// specifies larger block of data</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[1].setEnd(end_new);     <span class="comment">// specifies larger block of data</span>
        }
    }

    <span class="comment">// RFC 2018, page 4:</span>
    <span class="comment">// &quot;* The SACK option SHOULD be filled out by repeating the most</span>
    <span class="comment">// recently reported SACK blocks (based on first SACK blocks in</span>
    <span class="comment">// previous SACK options) that are not subsets of a SACK block</span>
    <span class="comment">// already included in the SACK option being constructed.&quot;</span>

    <span class="comment">// check if recently reported SACK blocks are subsets of &quot;sacks_array[0]&quot;</span>
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;MAX_SACK_BLOCKS-1; a++)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i = 1;
        <span class="keywordtype">bool</span> matched = <span class="keyword">false</span>;

        <span class="keywordflow">if</span> (a==0 &amp;&amp; skip_sacks_array)
            a = 1;

        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].getStart() == 0)
            <span class="keywordflow">break</span>;

        <span class="keywordflow">while</span> ((<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].getStart() ||
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].getStart() ||
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i].getEnd())
            &amp;&amp; a+i &lt; MAX_SACK_BLOCKS &amp;&amp; state-&gt;sacks_array[a].getStart()!=0) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
        {
            matched = <span class="keyword">true</span>;
            i++;
            overlap = <span class="keyword">true</span>;
        }
        <span class="keywordflow">if</span> (matched)
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a+i];
    }

    <span class="keywordflow">if</span> (!skip_sacks_array &amp;&amp; overlap &amp;&amp; m&lt;4)
        n--;

    option.setKind(TCPOPTION_SACK);
    option.setLength(8*n+2);
    option.setValuesArraySize(2*n);

    <span class="comment">// write sacks from sacks_array to options</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> counter = 0;
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> a=0; a&lt;n; a++)
    {
        option.setValues(counter,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getStart());
        counter++;
        option.setValues(counter,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a].getEnd());
        counter++;
    }

    <span class="comment">// independent of &quot;n&quot; we always need 2 padding bytes (NOP) to make: (used_options_len % 4 == 0)</span>
    options_len = used_options_len + 8*n + 2; <span class="comment">// 8 bytes for each SACK (n) + 2 bytes for kind&amp;length</span>

    <span class="keywordflow">if</span> (options_len &lt;= 40) <span class="comment">// Options length allowed? - maximum: 40 Bytes</span>
    {
        tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
        tcpseg-&gt;setOptions((tcpseg-&gt;getOptionsArraySize()-1),option);

        <span class="comment">// update number of sent sacks</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a>+n;
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">sndSacksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0af59887792b19719cace81e44089eed">snd_sacks</a>);

        <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> counter = 0;
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; SACK(s) added to header:\n&quot;</span>;
        <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> t=0; t&lt;(n*2); t++)
        {
            counter++;
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; counter &lt;&lt; <span class="stringliteral">&quot;. SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; option.getValues(t);
            t++;
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; option.getValues(t) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
            <span class="keywordflow">if</span> (t==1)
            {
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot; (D-SACK)&quot;</span>;
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(option.getValues(t),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
                {
                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot; (received segment filled out a gap)&quot;</span>;
                    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>; <span class="comment">// Note: Set snd_dsack to delete first sack from sacks_array</span>
                }
            }
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }
    <span class="keywordflow">else</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Option length exceeded! Segment will be sent without SACK(s)&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="comment">// RFC 2883, page 3:</span>
    <span class="comment">// &quot;(1) A D-SACK block is only used to report a duplicate contiguous</span>
    <span class="comment">// sequence of data received by the receiver in the most recent packet.</span>
    <span class="comment">//</span>
    <span class="comment">// (2) Each duplicate contiguous sequence of data received is reported</span>
    <span class="comment">// in at most one D-SACK block.  (I.e., the receiver sends two identical</span>
    <span class="comment">// D-SACK blocks in subsequent packets only if the receiver receives two</span>
    <span class="comment">// duplicate segments.)//</span>
    <span class="comment">//</span>
    <span class="comment">// In case of d-sack: delete first sack (d-sack) and move old sacks by one to the left</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>)
    {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> a=1; a&lt;<a class="code" href="_t_c_p_connection_8h.html#a07b8719be91287fc05f5e527852bc1ec">MAX_SACK_BLOCKS</a>; a++) <span class="comment">// MAX_SACK_BLOCKS is set to 60</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a-1] = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[a];

        <span class="comment">// delete/reset last sack to avoid duplicates</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[MAX_SACK_BLOCKS-1].setStart(0);
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#adf151c2f3284a3f4847fade882886400">sacks_array</a>[MAX_SACK_BLOCKS-1].setEnd(0);
    }

    <span class="comment">// reset flags:</span>
    skip_sacks_array = <span class="keyword">false</span>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a>  = <span class="keyword">false</span>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">false</span>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = 0;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = 0;

    <span class="keywordflow">return</span> *tcpseg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aecded14193441e78c31ca0c635ac19c8"></a><!-- doxytag: member="TCPConnection::cancelEvent" ref="aecded14193441e78c31ca0c635ac19c8" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* TCPConnection::cancelEvent </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: cancel a timer </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;cancelEvent(msg);}
</pre></div>
</div>
</div>
<a class="anchor" id="a1d5624dcbc77e79d142f6a886b3e788d"></a><!-- doxytag: member="TCPConnection::cloneListeningConnection" ref="a1d5624dcbc77e79d142f6a886b3e788d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_connection.html">TCPConnection</a> * TCPConnection::cloneListeningConnection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: clone a listening connection. Used for forking. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <span class="keyword">new</span> <a class="code" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection</a>(<a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>,<a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>,<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);

    <span class="comment">// following code to be kept consistent with initConnection()</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;getClassName();
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a9e052fb6c65615916039b5e1da8a1abf">setConnection</a>(conn);

    <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;getClassName();
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a19f45b8c7cc06b456227a67d533218f7">setConnection</a>(conn);

    <span class="comment">// create SACK retransmit queue</span>
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = <span class="keyword">new</span> <a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>();
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a76c212912f59518e0b05a79c494ac0e2">setConnection</a>(<span class="keyword">this</span>);

    <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;getClassName();
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ac014216e698c557621bc907eb6d5ea6b">setConnection</a>(conn);

    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a98bebe4904ec8d6c85056adff9526697">getStateVariables</a>();
    <a class="code" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a0b15a6a2f11c4a482ecec6208f5ee23d">initialize</a>();

    <span class="comment">// put it into LISTEN, with our localAddr/localPort</span>
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">false</span>;
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a> = <span class="keyword">true</span>;
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a> = <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>;
    conn-&gt;<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> = <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>;
    FSM_Goto(conn-&gt;<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>);

    <span class="keywordflow">return</span> conn;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ddd3d422b9d6e00ad15cf99f9870ef4"></a><!-- doxytag: member="TCPConnection::configureStateVariables" ref="a8ddd3d422b9d6e00ad15cf99f9870ef4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::configureStateVariables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: set snd_mss, rcv_wnd and sack in newly created state variables block </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">long</span> advertisedWindowPar = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;advertisedWindow&quot;</span>).longValue();
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;windowScalingSupport&quot;</span>); <span class="comment">// if set, this means that current host supports WS (RFC 1323)</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> &amp;&amp; (advertisedWindowPar &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> || advertisedWindowPar &lt;= 0))
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;Invalid advertisedWindow parameter: %ld&quot;</span>, advertisedWindowPar);
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> = advertisedWindowPar;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = advertisedWindowPar;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> &amp;&amp; advertisedWindowPar &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>)
    {
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> = <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>; <span class="comment">// we cannot to guarantee that the other end is also supporting the Window Scale (header option) (RFC 1322)</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>; <span class="comment">// therefore TCP_MAX_WIN is used as initial value for rcv_wnd and rcv_adv</span>
    }
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> = advertisedWindowPar;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a43536d5fd1e75c068cbcfe4ccf8fc79d">delayed_acks_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;delayedAcksEnabled&quot;</span>); <span class="comment">// delayed ACK algorithm (RFC 1122) enabled/disabled</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad0a43b2fd46e7659e79c3cfd90c926a2">nagle_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;nagleEnabled&quot;</span>); <span class="comment">// Nagle&#39;s algorithm (RFC 896) enabled/disabled</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a406b24dd2a997eae7618c762dfe2e48d">limited_transmit_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;limitedTransmitEnabled&quot;</span>); <span class="comment">// Limited Transmit algorithm (RFC 3042) enabled/disabled</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a7c3d5a7916b1d457f6065c488684d1d5">increased_IW_enabled</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;increasedIWEnabled&quot;</span>); <span class="comment">// Increased Initial Window (RFC 3390) enabled/disabled</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;mss&quot;</span>).longValue(); <span class="comment">// Maximum Segment Size (RFC 793)</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8c78c2a8ced36433f68e1668e9ac4eaf">ts_support</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;timestampSupport&quot;</span>); <span class="comment">// if set, this means that current host supports TS (RFC 1323)</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;sackSupport&quot;</span>); <span class="comment">// if set, this means that current host supports SACK (RFC 2018, 2883, 3517)</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a>)
    {
        std::string algorithmName1 = <span class="stringliteral">&quot;TCPReno&quot;</span>;
        std::string algorithmName2 = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;tcpAlgorithmClass&quot;</span>);
        <span class="keywordflow">if</span> (algorithmName1!=algorithmName2) <span class="comment">// TODO add additional checks for new SACK supporting algorithms here once they are implemented</span>
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;If you want to use TCP SACK please set tcpAlgorithmClass to TCPReno&quot;</span> &lt;&lt; endl;
            ASSERT(<span class="keyword">false</span>);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad2ab4393f60b26351d445334d4626cc7"></a><!-- doxytag: member="TCPConnection::convertSimtimeToTS" ref="ad2ab4393f60b26351d445334d4626cc7" args="(simtime_t simtime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 TCPConnection::convertSimtimeToTS </td>
          <td>(</td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>simtime</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: converts a given simtime to a timestamp (TS). </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#a7515afa05f1ae81306d10824d4940a54">TCPBaseAlg::rttMeasurementCompleteUsingTS()</a>, and <a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (SimTime::getScaleExp() &lt;= -3); <span class="comment">// FIXME TODO - If the scale factor is different, we need to adjust our simTime to uint32 casts - we are currently using ms precision</span>
    uint32 timestamp = (uint32) (simtime.dbl() * 1000);
    <span class="keywordflow">return</span> timestamp;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af8c2c97216e867103c61e0b6393ba625"></a><!-- doxytag: member="TCPConnection::convertTSToSimtime" ref="af8c2c97216e867103c61e0b6393ba625" args="(uint32 timestamp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t TCPConnection::convertTSToSimtime </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>timestamp</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: converts a given timestamp (TS) to a simtime. </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#a7515afa05f1ae81306d10824d4940a54">TCPBaseAlg::rttMeasurementCompleteUsingTS()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (SimTime::getScaleExp() &lt;= -3); <span class="comment">// FIXME TODO - If the scale factor is different, we need to adjust our simTime to uint32 casts - we are currently using ms precision</span>
    simtime_t simtime = (simtime_t) ((<span class="keywordtype">double</span>) timestamp * 0.001);
    <span class="keywordflow">return</span> simtime;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a462206e0bc50ae521a47a797552a0057"></a><!-- doxytag: member="TCPConnection::createTCPSegment" ref="a462206e0bc50ae521a47a797552a0057" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> * TCPConnection::createTCPSegment </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: This factory method gets invoked throughout the <a class="el" href="class_t_c_p.html">TCP</a> model to create a <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. Override it if you need to subclass <a class="el" href="class_t_c_p_segment.html">TCPSegment</a>. </p>

<p>Referenced by <a class="el" href="class_t_c_p_virtual_data_send_queue.html#aedff3a104851f83cd9d64fcd0d93d146">TCPVirtualDataSendQueue::createSegmentWithBytes()</a>, <a class="el" href="class_t_c_p_msg_based_send_queue.html#a7a567c8b65da65321342021a83246aa1">TCPMsgBasedSendQueue::createSegmentWithBytes()</a>, <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin()</a>, <a class="el" href="class_t_c_p_connection.html#a3dc25263bb2f0b1013ee398c1587b128">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, and <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_t_c_p_segment.html">TCPSegment</a>(name);
}
</pre></div>
</div>
</div>
<a class="anchor" id="af199cd53f71f27341684145c3bdab306"></a><!-- doxytag: member="TCPConnection::eventName" ref="af199cd53f71f27341684145c3bdab306" args="(int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::eventName </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_E_xxx constants </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>, and <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
    <span class="keywordflow">switch</span> (event)
    {
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea304f695bbcba57cc5d6bb6ccbca5cfac">TCP_E_RCV_DATA</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>);
    }
    <span class="keywordflow">return</span> s;
<span class="preprocessor">#undef CASE</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="aa96e386d3f5d597dd0c03c52a103071d"></a><!-- doxytag: member="TCPConnection::getFsmState" ref="aa96e386d3f5d597dd0c03c52a103071d" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TCPConnection::getFsmState </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState();}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c6829af5f8233ce0a666cda858374e6"></a><!-- doxytag: member="TCPConnection::getReceiveQueue" ref="a3c6829af5f8233ce0a666cda858374e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* TCPConnection::getReceiveQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a1eebaa12717ee8c8197b744275e0c7b0"></a><!-- doxytag: member="TCPConnection::getRexmitQueue" ref="a1eebaa12717ee8c8197b744275e0c7b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>* TCPConnection::getRexmitQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a1ef81a39ac3ed1ef11b5d141136c1926"></a><!-- doxytag: member="TCPConnection::getSendQueue" ref="a1ef81a39ac3ed1ef11b5d141136c1926" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* TCPConnection::getSendQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a2bf497c23b9c58dbf704a511e36f19f1"></a><!-- doxytag: member="TCPConnection::getState" ref="a2bf497c23b9c58dbf704a511e36f19f1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* TCPConnection::getState </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a6a70265d4b753e5eefb47c2cdc54e9f5"></a><!-- doxytag: member="TCPConnection::getTcpAlgorithm" ref="a6a70265d4b753e5eefb47c2cdc54e9f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* TCPConnection::getTcpAlgorithm </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a5c9318d9fe504d7e5779a5b2eab87e09"></a><!-- doxytag: member="TCPConnection::getTcpMain" ref="a5c9318d9fe504d7e5779a5b2eab87e09" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p.html">TCP</a>* TCPConnection::getTcpMain </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_dumb_t_c_p.html#a3e2bed832b7e4e2e258290b947eea526">DumbTCP::connectionClosed()</a>, <a class="el" href="class_dumb_t_c_p.html#a312e0203fada40e843fc3635ff4b1cdf">DumbTCP::dataSent()</a>, <a class="el" href="class_t_c_p_base_alg.html#ae6147731689fcc4c5c79f4cc539c6b7f">TCPBaseAlg::initialize()</a>, <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>, and <a class="el" href="class_dumb_t_c_p.html#a67f17b145d9d945a12ff0dafc0c9af4e">DumbTCP::~DumbTCP()</a>.</p>
<div class="fragment"><pre class="fragment">{<span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>;}
</pre></div>
</div>
</div>
<a class="anchor" id="a5aac66dd96f84aae48e8fb0e45b86861"></a><!-- doxytag: member="TCPConnection::getTSecr" ref="a5aac66dd96f84aae48e8fb0e45b86861" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 TCPConnection::getTSecr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: get TSecr from segments TS header option </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
    {
        <span class="keyword">const</span> TCPOption&amp; option = tcpseg-&gt;getOptions(i);
        <span class="keywordtype">short</span> kind = option.getKind();
        <span class="keywordflow">if</span> (kind == TCPOPTION_TIMESTAMP)
            <span class="keywordflow">return</span> option.getValues(1);
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3d4824b8c96a46028c5a337c1ae22f59"></a><!-- doxytag: member="TCPConnection::getTSval" ref="a3d4824b8c96a46028c5a337c1ae22f59" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 TCPConnection::getTSval </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: get TSval from segments TS header option </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
    {
        <span class="keyword">const</span> TCPOption&amp; option = tcpseg-&gt;getOptions(i);
        <span class="keywordtype">short</span> kind = option.getKind();
        <span class="keywordflow">if</span> (kind == TCPOPTION_TIMESTAMP)
            <span class="keywordflow">return</span> option.getValues(0);
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>
</div>
</div>
<a class="anchor" id="adeef1c0b8f04a744168a107f68c397ba"></a><!-- doxytag: member="TCPConnection::indicationName" ref="adeef1c0b8f04a744168a107f68c397ba" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::indicationName </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>code</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_I_xxx constants </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, and <a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
    <span class="keywordflow">switch</span> (code)
    {
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_DATA);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_URGENT_DATA);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_ESTABLISHED);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_PEER_CLOSED);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_CLOSED);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_CONNECTION_REFUSED);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_CONNECTION_RESET);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_TIMED_OUT);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(TCP_I_STATUS);
    }
    <span class="keywordflow">return</span> s;
<span class="preprocessor">#undef CASE</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a69caa8ea0ffbe8d9f73f935aac1b29d9"></a><!-- doxytag: member="TCPConnection::initConnection" ref="a69caa8ea0ffbe8d9f73f935aac1b29d9" args="(TCPOpenCommand *openCmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::initConnection </td>
          <td>(</td>
          <td class="paramtype">TCPOpenCommand *&#160;</td>
          <td class="paramname"><em>openCmd</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: creates send/receive queues and tcpAlgorithm </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, and <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// create send queue</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *sendQueueClass = openCmd-&gt;getSendQueueClass();
    <span class="keywordflow">if</span> (!sendQueueClass || !sendQueueClass[0])
        sendQueueClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;sendQueueClass&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_send_queue.html">TCPSendQueue</a> *&gt;(createOne(sendQueueClass));
    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a9e052fb6c65615916039b5e1da8a1abf">setConnection</a>(<span class="keyword">this</span>);

    <span class="comment">// create receive queue</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *receiveQueueClass = openCmd-&gt;getReceiveQueueClass();
    <span class="keywordflow">if</span> (!receiveQueueClass || !receiveQueueClass[0])
        receiveQueueClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;receiveQueueClass&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a> *&gt;(createOne(receiveQueueClass));
    <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a19f45b8c7cc06b456227a67d533218f7">setConnection</a>(<span class="keyword">this</span>);

    <span class="comment">// create SACK retransmit queue</span>
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a> = <span class="keyword">new</span> <a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>();
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a76c212912f59518e0b05a79c494ac0e2">setConnection</a>(<span class="keyword">this</span>);

    <span class="comment">// create algorithm</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *tcpAlgorithmClass = openCmd-&gt;getTcpAlgorithmClass();
    <span class="keywordflow">if</span> (!tcpAlgorithmClass || !tcpAlgorithmClass[0])
        tcpAlgorithmClass = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;par(<span class="stringliteral">&quot;tcpAlgorithmClass&quot;</span>);
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a> = check_and_cast&lt;<a class="code" href="class_t_c_p_algorithm.html">TCPAlgorithm</a> *&gt;(createOne(tcpAlgorithmClass));
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ac014216e698c557621bc907eb6d5ea6b">setConnection</a>(<span class="keyword">this</span>);

    <span class="comment">// create state block</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a> = <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a98bebe4904ec8d6c85056adff9526697">getStateVariables</a>();
    <a class="code" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables</a>();
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a0b15a6a2f11c4a482ecec6208f5ee23d">initialize</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a261dc1ebd41e03d655b112f2b82b3f08"></a><!-- doxytag: member="TCPConnection::isLost" ref="a261dc1ebd41e03d655b112f2b82b3f08" args="(uint32 seqNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isLost </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>seqNum</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: "This routine returns whether the given sequence number is considered to be lost. The routine returns true when either DupThresh discontiguous SACKed sequences have arrived above 'SeqNum' or (DupThresh * SMSS) bytes with sequence numbers greater than 'SeqNum' have been SACKed. Otherwise, the routine returns false." </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg()</a>, and <a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
    <span class="comment">// RFC 3517, page 3: &quot;This routine returns whether the given sequence number is</span>
    <span class="comment">// considered to be lost.  The routine returns true when either</span>
    <span class="comment">// DupThresh discontiguous SACKed sequences have arrived above</span>
    <span class="comment">// &#39;SeqNum&#39; or (DupThresh * SMSS) bytes with sequence numbers greater</span>
    <span class="comment">// than &#39;SeqNum&#39; have been SACKed.  Otherwise, the routine returns</span>
    <span class="comment">// false.&quot;</span>
    <span class="keywordtype">bool</span> <a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a> = <span class="keyword">false</span>;

    ASSERT(<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(seqNum,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>)); <span class="comment">// HighAck = snd_una</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a54be5e710f72ed92239d5e20b0729b97">getNumOfDiscontiguousSacks</a>(seqNum) &gt;= <a class="code" href="_t_c_p_connection_8h.html#a6d22725191167fb4feaacff2c1291afd">DUPTHRESH</a> ||     <span class="comment">// DUPTHRESH = 3</span>
        <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#ab41d57345e37e6db6d9e7a0db5ae0580">getAmountOfSackedBytes</a>(seqNum) &gt;= (<a class="code" href="_t_c_p_connection_8h.html#a6d22725191167fb4feaacff2c1291afd">DUPTHRESH</a> * <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>))
        isLost = <span class="keyword">true</span>;
    <span class="keywordflow">else</span>
        isLost = <span class="keyword">false</span>;

    <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="acceb561b23349d06b298858e39433435"></a><!-- doxytag: member="TCPConnection::isSegmentAcceptable" ref="acceb561b23349d06b298858e39433435" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isSegmentAcceptable </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: check if segment is acceptable (all bytes are in receive window) </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// check that segment entirely falls in receive window</span>
    <span class="comment">// RFC 793, page 69:</span>
    <span class="comment">// &quot;There are four cases for the acceptability test for an incoming segment:&quot;</span>
    uint32 len = tcpseg-&gt;getPayloadLength();
    uint32 seqNo = tcpseg-&gt;getSequenceNo();
    <span class="keywordtype">bool</span> ret;

    <span class="keywordflow">if</span> (len == 0)
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> == 0)
            ret = (seqNo == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
        <span class="keywordflow">else</span> <span class="comment">// rcv_wnd &gt; 0</span>
            ret = <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo) &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
    }
    <span class="keywordflow">else</span> <span class="comment">// len &gt; 0</span>
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> == 0)
            ret = <span class="keyword">false</span>;
        <span class="keywordflow">else</span> <span class="comment">// rcv_wnd &gt; 0</span>
            ret = (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo) &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>))
            ||
            (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, seqNo + len - 1) &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(seqNo + len - 1, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>));
    }
    <span class="keywordflow">if</span> (!ret)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Not Acceptable segment. seqNo:&quot;</span> &lt;&lt; seqNo &lt;&lt; <span class="stringliteral">&quot;, len:&quot;</span> &lt;&lt; len &lt;&lt; <span class="stringliteral">&quot;, rcv_nxt:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>  &lt;&lt; <span class="stringliteral">&quot;, rcv_wnd:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> &lt;&lt; endl;
    }
    <span class="keywordflow">return</span> ret;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aafbfa20356a296e70ca483daa9132460"></a><!-- doxytag: member="TCPConnection::isSendQueueEmpty" ref="aafbfa20356a296e70ca483daa9132460" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::isSendQueueEmpty </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: checks if send queue is empty (no data to send). </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#a28c072f575629d0c5ec6478edd3bb7e5">TCPBaseAlg::sendData()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> (<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>) == 0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae8d9450252219a54062112f6d8688309"></a><!-- doxytag: member="TCPConnection::nextSeg" ref="ae8d9450252219a54062112f6d8688309" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32 TCPConnection::nextSeg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: "This routine uses the scoreboard data structure maintained by the Update() function to determine what to transmit based on the SACK information that has arrived from the data receiver (and hence been marked in the scoreboard). NextSeg () MUST return the sequence number range of the next segment that is to be transmitted..." </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a4fb6aaf244a5da2eaa02af271099a06b">sendDataDuringLossRecoveryPhase()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
    <span class="comment">// RFC 3517, page 5: &quot;This routine uses the scoreboard data structure maintained by the</span>
    <span class="comment">// Update() function to determine what to transmit based on the SACK</span>
    <span class="comment">// information that has arrived from the data receiver (and hence</span>
    <span class="comment">// been marked in the scoreboard).  NextSeg () MUST return the</span>
    <span class="comment">// sequence number range of the next segment that is to be</span>
    <span class="comment">// transmitted, per the following rules:&quot;</span>

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
    uint32 seqNum = 0;
    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
    uint32 shift = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
        shift -= <a class="code" href="_t_c_p_connection_8h.html#a86574d0dee9bf72a715b4b0a026171d6">TCP_OPTION_TS_SIZE</a>;

    <span class="comment">// RFC 3517, page 5: &quot;(1) If there exists a smallest unSACKed sequence number &#39;S2&#39; that</span>
    <span class="comment">// meets the following three criteria for determining loss, the</span>
    <span class="comment">// sequence range of one segment of up to SMSS octets starting</span>
    <span class="comment">// with S2 MUST be returned.</span>
    <span class="comment">//</span>
    <span class="comment">// (1.a) S2 is greater than HighRxt.</span>
    <span class="comment">//</span>
    <span class="comment">// (1.b) S2 is less than the highest octet covered by any</span>
    <span class="comment">//       received SACK.</span>
    <span class="comment">//</span>
    <span class="comment">// (1.c) IsLost (S2) returns true.&quot;</span>
    <span class="keywordflow">for</span> (uint32 s2=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s2&lt;state-&gt;snd_max; s2=s2+shift)
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s2)==<span class="keyword">false</span>)
        {
            <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(s2,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>) &amp;&amp;
                <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s2,(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a56303d12ec8a593e9f4f58dabbb79d8d">getHighestSackedSeqNum</a>())) &amp;&amp;
                <a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a>(s2))
            {
                seqNum = s2;
                found = <span class="keyword">true</span>;
                <span class="keywordflow">return</span> seqNum;
            }
        }
    }

    <span class="comment">// RFC 3517, page 5: &quot;(2) If no sequence number &#39;S2&#39; per rule (1) exists but there</span>
    <span class="comment">// exists available unsent data and the receiver&#39;s advertised</span>
    <span class="comment">// window allows, the sequence range of one segment of up to SMSS</span>
    <span class="comment">// octets of previously unsent data starting with sequence number</span>
    <span class="comment">// HighData+1 MUST be returned.&quot;</span>
    <span class="keywordflow">if</span> (!found)
    {
        <span class="comment">// check how many unsent bytes we have</span>
        <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
        <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> maxWindow = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>;
        <span class="comment">// effectiveWindow: number of bytes we&#39;re allowed to send now</span>
        <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> effectiveWin = maxWindow - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>;
        <span class="keywordflow">if</span> (buffered &gt; 0 &amp;&amp; effectiveWin &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
        {
            seqNum = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>; <span class="comment">// HighData = snd_max</span>
            found = <span class="keyword">true</span>;
            <span class="keywordflow">return</span> seqNum;
        }
    }

    <span class="comment">// RFC 3517, pages 5 and 6: &quot;(3) If the conditions for rules (1) and (2) fail, but there exists</span>
    <span class="comment">// an unSACKed sequence number &#39;S3&#39; that meets the criteria for</span>
    <span class="comment">// detecting loss given in steps (1.a) and (1.b) above</span>
    <span class="comment">// (specifically excluding step (1.c)) then one segment of up to</span>
    <span class="comment">// SMSS octets starting with S3 MAY be returned.</span>
    <span class="comment">//</span>
    <span class="comment">// Note that rule (3) is a sort of retransmission &quot;last resort&quot;.</span>
    <span class="comment">// It allows for retransmission of sequence numbers even when the</span>
    <span class="comment">// sender has less certainty a segment has been lost than as with</span>
    <span class="comment">// rule (1).  Retransmitting segments via rule (3) will help</span>
    <span class="comment">// sustain TCP&#39;s ACK clock and therefore can potentially help</span>
    <span class="comment">// avoid retransmission timeouts.  However, in sending these</span>
    <span class="comment">// segments the sender has two copies of the same data considered</span>
    <span class="comment">// to be in the network (and also in the Pipe estimate).  When an</span>
    <span class="comment">// ACK or SACK arrives covering this retransmitted segment, the</span>
    <span class="comment">// sender cannot be sure exactly how much data left the network</span>
    <span class="comment">// (one of the two transmissions of the packet or both</span>
    <span class="comment">// transmissions of the packet).  Therefore the sender may</span>
    <span class="comment">// underestimate Pipe by considering both segments to have left</span>
    <span class="comment">// the network when it is possible that only one of the two has.</span>
    <span class="comment">//</span>
    <span class="comment">// We believe that the triggering of rule (3) will be rare and</span>
    <span class="comment">// that the implications are likely limited to corner cases</span>
    <span class="comment">// relative to the entire recovery algorithm.  Therefore we leave</span>
    <span class="comment">// the decision of whether or not to use rule (3) to</span>
    <span class="comment">// implementors.&quot;</span>
    <span class="keywordflow">if</span> (!found)
    {
        <span class="keywordflow">for</span> (uint32 s3=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s3&lt;state-&gt;snd_max; s3=s3+shift)
        {
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s3)==<span class="keyword">false</span>)
            {
                <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(s3,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>) &amp;&amp;
                    <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s3,(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a56303d12ec8a593e9f4f58dabbb79d8d">getHighestSackedSeqNum</a>())))
                {
                    seqNum = s3;
                    found = <span class="keyword">true</span>;
                    <span class="keywordflow">return</span> seqNum;
                }
            }
        }
    }

    <span class="comment">// RFC 3517, page 6: &quot;(4) If the conditions for each of (1), (2), and (3) are not met,</span>
    <span class="comment">// then NextSeg () MUST indicate failure, and no segment is</span>
    <span class="comment">// returned.&quot;</span>
    <span class="keywordflow">if</span> (!found)
        seqNum = 0;

    <span class="keywordflow">return</span> seqNum;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad7429706bcb29990ebfc65ff24970faa"></a><!-- doxytag: member="TCPConnection::optionName" ref="ad7429706bcb29990ebfc65ff24970faa" args="(int option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::optionName </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>option</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCPOPTION_xxx constants </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief()</a>, and <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (option)
    {
        <span class="keywordflow">case</span> TCPOPTION_END_OF_OPTION_LIST:   <span class="keywordflow">return</span> <span class="stringliteral">&quot;EOL&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_NO_OPERATION:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOP&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_MAXIMUM_SEGMENT_SIZE: <span class="keywordflow">return</span> <span class="stringliteral">&quot;MSS&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_WINDOW_SCALE:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;WS&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_SACK_PERMITTED:       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SACK_PERMITTED&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_SACK:                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SACK&quot;</span>;
        <span class="keywordflow">case</span> TCPOPTION_TIMESTAMP:            <span class="keywordflow">return</span> <span class="stringliteral">&quot;TS&quot;</span>;
        <span class="keywordflow">default</span>:                             <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa1fe5fa359d4063c984d686e4166b798"></a><!-- doxytag: member="TCPConnection::performStateTransition" ref="aa1fe5fa359d4063c984d686e4166b798" args="(const TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::performStateTransition </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Implemements the pure <a class="el" href="class_t_c_p.html">TCP</a> state machine </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, and <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="comment">// closed connections should be deleted immediately</span>

    <span class="keywordflow">if</span> (event==<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>)  <span class="comment">// e.g. discarded segment</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (no FSM event)\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">true</span>;
    }

    <span class="comment">// state machine</span>
    <span class="comment">// TBD add handling of connection timeout event (KEEP-ALIVE), with transition to CLOSED</span>
    <span class="comment">// Note: empty &quot;default:&quot; lines are for gcc&#39;s benefit which would otherwise spit warnings</span>
    <span class="keywordtype">int</span> oldState = <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState();
    <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>:FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>:        FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>);<span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> ? <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a> : <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> ? <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a> : <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
            <span class="keywordflow">switch</span> (event)
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>:       FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>:     FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>: FSM_Goto(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>, <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>); <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:;
            }
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>:
            <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span> (oldState!=<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Transition: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (event was: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
        <a class="code" href="_t_c_p_8h.html#a85ddacbb6727d1260826a130068eef15">testingEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(oldState) &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot;  (on &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;

        <span class="comment">// cancel timers, etc.</span>
        <a class="code" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Staying in state: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; (event was: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
    }

    <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a792d9159b4e64b344cac79d0716c907a"></a><!-- doxytag: member="TCPConnection::preanalyseAppCommandEvent" ref="a792d9159b4e64b344cac79d0716c907a" args="(int commandCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::preanalyseAppCommandEvent </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>commandCode</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Maps app command codes (msg kind of app command msgs) to TCP_E_xxx event codes </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span> (commandCode)
    {
        <span class="keywordflow">case</span> TCP_C_OPEN_ACTIVE:  <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>;
        <span class="keywordflow">case</span> TCP_C_OPEN_PASSIVE: <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>;
        <span class="keywordflow">case</span> TCP_C_SEND:         <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>;
        <span class="keywordflow">case</span> TCP_C_CLOSE:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
        <span class="keywordflow">case</span> TCP_C_ABORT:        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>;
        <span class="keywordflow">case</span> TCP_C_STATUS:       <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>;
        <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;Unknown message kind in app command&quot;</span>);
                 <span class="keywordflow">return</span> (<a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a>)0; <span class="comment">// to satisfy compiler</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8aaec47dd8098dbaa015f2e3e7b16442"></a><!-- doxytag: member="TCPConnection::printConnBrief" ref="a8aaec47dd8098dbaa015f2e3e7b16442" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printConnBrief </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints local/remote addr/port and app gate index/connId </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, and <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection &quot;</span>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a> &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  on app[&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a> &lt;&lt; <span class="stringliteral">&quot;],connId=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  in &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;  (ptr=0x&quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a188549e7c936c8cad622c180d3200c69"></a><!-- doxytag: member="TCPConnection::printSegmentBrief" ref="a188549e7c936c8cad622c180d3200c69" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::printSegmentBrief </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: prints important header fields </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>, <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>, and <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;getSrcPort() &lt;&lt; <span class="stringliteral">&quot; &gt; &quot;</span>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; tcpseg-&gt;getDestPort() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;

    <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;getAckBit() ? <span class="stringliteral">&quot;SYN+ACK &quot;</span> : <span class="stringliteral">&quot;SYN &quot;</span>);
    <span class="keywordflow">if</span> (tcpseg-&gt;getFinBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN(+ACK) &quot;</span>;
    <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (tcpseg-&gt;getAckBit() ? <span class="stringliteral">&quot;RST+ACK &quot;</span> : <span class="stringliteral">&quot;RST &quot;</span>);
    <span class="keywordflow">if</span> (tcpseg-&gt;getPshBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;PSH &quot;</span>;

    <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()&gt;0 || tcpseg-&gt;getSynBit())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; tcpseg-&gt;getSequenceNo() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; (tcpseg-&gt;getSequenceNo()+tcpseg-&gt;getPayloadLength()) &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;(l=&quot;</span> &lt;&lt; tcpseg-&gt;getPayloadLength() &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>;
    }
    <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ack &quot;</span> &lt;&lt; tcpseg-&gt;getAckNo() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;win &quot;</span> &lt;&lt; tcpseg-&gt;getWindow() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
    <span class="keywordflow">if</span> (tcpseg-&gt;getUrgBit())  <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;urg &quot;</span> &lt;&lt; tcpseg-&gt;getUrgentPointer() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
    <span class="keywordflow">if</span> (tcpseg-&gt;getHeaderLength() &gt; TCP_HEADER_OCTETS) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;options &quot;</span>;
        <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
        {
            <span class="keyword">const</span> TCPOption&amp; option = tcpseg-&gt;getOptions(i);
            <span class="keywordtype">short</span> kind = option.getKind();
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ad7429706bcb29990ebfc65ff24970faa">optionName</a>(kind) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
        }
    }
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afb2189f1428627dcde1d1b0bfbc50833"></a><!-- doxytag: member="TCPConnection::process_ABORT" ref="afb2189f1428627dcde1d1b0bfbc50833" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_ABORT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> tcpCommand;
    <span class="keyword">delete</span> msg;

    <span class="comment">//</span>
    <span class="comment">// The ABORT event will automatically take the connection to the CLOSED</span>
    <span class="comment">// state, flush queues etc -- no need to do it here. Also, we don&#39;t need to</span>
    <span class="comment">// send notification to the user, they know what&#39;s going on.</span>
    <span class="comment">//</span>
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            opp_error(<span class="stringliteral">&quot;Error processing command ABORT: connection not open&quot;</span>);

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
            <span class="comment">//&quot;</span>
            <span class="comment">// Send a reset segment:</span>
            <span class="comment">//</span>
            <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;CTL=RST&gt;</span>
            <span class="comment">//&quot;</span>
            <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
            <span class="keywordflow">break</span>;
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a5aa9b20651a4c1f90772a7c02eacbf05"></a><!-- doxytag: member="TCPConnection::process_CLOSE" ref="a5aa9b20651a4c1f90772a7c02eacbf05" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_CLOSE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> tcpCommand;
    <span class="keyword">delete</span> msg;

    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            opp_error(<span class="stringliteral">&quot;Error processing command CLOSE: connection not open&quot;</span>);

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
            <span class="comment">// Nothing to do here</span>
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
            <span class="comment">// Delete the TCB and return &quot;error:  closing&quot; responses to any</span>
            <span class="comment">// queued SENDs, or RECEIVEs.</span>
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
            <span class="comment">//</span>
            <span class="comment">// SYN_RCVD processing (ESTABLISHED and CLOSE_WAIT are similar):</span>
            <span class="comment">//&quot;</span>
            <span class="comment">// If no SENDs have been issued and there is no pending data to send,</span>
            <span class="comment">// then form a FIN segment and send it, and enter FIN-WAIT-1 state;</span>
            <span class="comment">// otherwise queue for processing after entering ESTABLISHED state.</span>
            <span class="comment">//&quot;</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>==<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>())
            {
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;No outstanding SENDs, sending FIN right away, advancing snd_nxt over the FIN\n&quot;</span>;
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
                <a class="code" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a>();
                <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = ++<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

                <span class="comment">// state transition will automatically take us to FIN_WAIT_1 (or LAST_ACK)</span>
            }
            <span class="keywordflow">else</span>
            {
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND of &quot;</span> &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>()-<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>) &lt;&lt;
                      <span class="stringliteral">&quot; bytes pending, deferring sending of FIN\n&quot;</span>;
                <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
            }
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a> = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>();
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
            <span class="comment">// RFC 793 is not entirely clear on how to handle a duplicate close request.</span>
            <span class="comment">// Here we treat it as an error.</span>
            opp_error(<span class="stringliteral">&quot;Duplicate CLOSE command: connection already closing&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6ef625498d593ac11744aa92a404e06d"></a><!-- doxytag: member="TCPConnection::process_OPEN_ACTIVE" ref="a6ef625498d593ac11744aa92a404e06d" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_ACTIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    TCPOpenCommand *openCmd = check_and_cast&lt;TCPOpenCommand *&gt;(tcpCommand);
    <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>, <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>;
    <span class="keywordtype">int</span> <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>, <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>;

    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            <a class="code" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);

            <span class="comment">// store local/remote socket</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">true</span>;
            localAddr = openCmd-&gt;getLocalAddr();
            remoteAddr = openCmd-&gt;getRemoteAddr();
            localPort = openCmd-&gt;getLocalPort();
            remotePort = openCmd-&gt;getRemotePort();

            <span class="keywordflow">if</span> (remoteAddr.isUnspecified() || remotePort==-1)
                opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: remote address and port must be specified&quot;</span>);

            <span class="keywordflow">if</span> (localPort==-1)
            {
                localPort = <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#af6a465c04eb9301ac7627d6922564e72">getEphemeralPort</a>();
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Assigned ephemeral port &quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
            }

            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;OPEN: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot; --&gt; &quot;</span> &lt;&lt; remoteAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; remotePort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

            <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, remoteAddr, localPort, remotePort);

            <span class="comment">// send initial SYN</span>
            <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
            <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
            <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
            <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
            <span class="keywordflow">break</span>;

        <span class="keywordflow">default</span>:
            opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: connection already exists&quot;</span>);
    }

    <span class="keyword">delete</span> openCmd;
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a26e4a86dfbc1efaf02e99ea14d410ae3"></a><!-- doxytag: member="TCPConnection::process_OPEN_PASSIVE" ref="a26e4a86dfbc1efaf02e99ea14d410ae3" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_OPEN_PASSIVE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    TCPOpenCommand *openCmd = check_and_cast&lt;TCPOpenCommand *&gt;(tcpCommand);
    <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>;
    <span class="keywordtype">int</span> <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>;

    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            <a class="code" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection</a>(openCmd);

            <span class="comment">// store local/remote socket</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">false</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a> = openCmd-&gt;getFork();
            localAddr = openCmd-&gt;getLocalAddr();
            localPort = openCmd-&gt;getLocalPort();

            <span class="keywordflow">if</span> (localPort==-1)
                opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: local port must be specified&quot;</span>);

            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Starting to listen on: &quot;</span> &lt;&lt; localAddr &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; localPort &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

            <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">addSockPair</a>(<span class="keyword">this</span>, localAddr, <a class="code" href="class_i_pv_x_address.html">IPvXAddress</a>(), localPort, -1);
            <span class="keywordflow">break</span>;

        <span class="keywordflow">default</span>:
            opp_error(<span class="stringliteral">&quot;Error processing command OPEN_PASSIVE: connection already exists&quot;</span>);
    }

    <span class="keyword">delete</span> openCmd;
    <span class="keyword">delete</span> msg;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a46ac1b09624942471db2eb76ef991143"></a><!-- doxytag: member="TCPConnection::process_RCV_SEGMENT" ref="a46ac1b09624942471db2eb76ef991143" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::process_RCV_SEGMENT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Returns a specific event code (e.g. TCP_E_RCV_SYN) which will drive the state machine. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
    <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCB: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a93fbf3558fe0e1dfa27bdbab25c36aff">info</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>) <a class="code" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">rcvSeqVector</a>-&gt;record(tcpseg-&gt;getSequenceNo());
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>) <a class="code" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">rcvAckVector</a>-&gt;record(tcpseg-&gt;getAckNo());

    <span class="comment">//</span>
    <span class="comment">// Note: this code is organized exactly as RFC 793, section &quot;3.9 Event</span>
    <span class="comment">// Processing&quot;, subsection &quot;SEGMENT ARRIVES&quot;.</span>
    <span class="comment">//</span>
    <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen</a>(tcpseg, src, dest);
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent</a>(tcpseg, src, dest);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// RFC 793 steps &quot;first check sequence number&quot;, &quot;second check the RST bit&quot;, etc</span>
        <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th</a>(tcpseg);
    }
    <span class="keyword">delete</span> tcpseg;
    <span class="keywordflow">return</span> event;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a65fa8d6570761c63cdab5cef7f5df685"></a><!-- doxytag: member="TCPConnection::process_SEND" ref="a65fa8d6570761c63cdab5cef7f5df685" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_SEND </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    TCPSendCommand *sendCommand = check_and_cast&lt;TCPSendCommand *&gt;(tcpCommand);

    <span class="comment">// FIXME how to support PUSH? One option is to treat each SEND as a unit of data,</span>
    <span class="comment">// and set PSH at SEND boundaries</span>
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection not open&quot;</span>);

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SEND command turns passive open into active open, sending initial SYN\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();
            <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>();
            <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
            <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);
            <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));  <span class="comment">// queue up for later</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Queueing up data for sending later.\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg)); <span class="comment">// queue up for later</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue\n&quot;</span>;
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
            <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3387c33e121dceb0f14d951559634ad1">enqueueAppData</a>(<a class="code" href="_i_n_e_t_defs_8h.html#ae5b816f7de3c5248c812bdb6920f4e06">PK</a>(msg));
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes in queue, plus &quot;</span>
                  &lt;&lt; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>-<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>) &lt;&lt; <span class="stringliteral">&quot; bytes unacknowledged\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a4f091f7203a1813550bcad5738e815cb">sendCommandInvoked</a>();
            <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
            opp_error(<span class="stringliteral">&quot;Error processing command SEND: connection closing&quot;</span>);
    }

    <span class="keyword">delete</span> sendCommand; <span class="comment">// msg itself has been taken by the sendQueue</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a519a2b6612737fbdbd5641dfa33833e8"></a><!-- doxytag: member="TCPConnection::process_STATUS" ref="a519a2b6612737fbdbd5641dfa33833e8" args="(TCPEventCode &amp;event, TCPCommand *tcpCommand, cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_STATUS </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TCPCommand *&#160;</td>
          <td class="paramname"><em>tcpCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aebf3e44d104151c83a84a1efbae3f312">processAppCommand()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keyword">delete</span> tcpCommand; <span class="comment">// but reuse msg for reply</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>)
        opp_error(<span class="stringliteral">&quot;Error processing command STATUS: connection not open&quot;</span>);

    TCPStatusInfo *statusInfo = <span class="keyword">new</span> TCPStatusInfo();

    statusInfo-&gt;setState(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState());
    statusInfo-&gt;setStateName(<a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));

    statusInfo-&gt;setLocalAddr(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>);
    statusInfo-&gt;setRemoteAddr(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>);
    statusInfo-&gt;setLocalPort(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
    statusInfo-&gt;setRemotePort(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);

    statusInfo-&gt;setSnd_mss(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
    statusInfo-&gt;setSnd_una(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
    statusInfo-&gt;setSnd_nxt(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    statusInfo-&gt;setSnd_max(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);
    statusInfo-&gt;setSnd_wnd(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>);
    statusInfo-&gt;setSnd_up(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a380d1be36964eb83f3d98d24562b92f3">snd_up</a>);
    statusInfo-&gt;setSnd_wl1(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a>);
    statusInfo-&gt;setSnd_wl2(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a>);
    statusInfo-&gt;setIss(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
    statusInfo-&gt;setRcv_nxt(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
    statusInfo-&gt;setRcv_wnd(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);
    statusInfo-&gt;setRcv_up(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae9646df9e0e50b7f04a5898929a78aed">rcv_up</a>);
    statusInfo-&gt;setIrs(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a>);
    statusInfo-&gt;setFin_ack_rcvd(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>);

    msg-&gt;setControlInfo(statusInfo);
    <a class="code" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae29072ef963e593c4c3053827ebbec6e"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_2MSL" ref="ae29072ef963e593c4c3053827ebbec6e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_2MSL </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">//&quot;</span>
    <span class="comment">// If the time-wait timeout expires on a connection delete the TCB,</span>
    <span class="comment">// enter the CLOSED state and return.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
            <span class="comment">// Nothing to do here. The TIMEOUT_2MSL event will automatically take</span>
            <span class="comment">// the connection to CLOSED. We already notified the user</span>
            <span class="comment">// (TCP_I_CLOSED) when we entered the TIME_WAIT state from CLOSING,</span>
            <span class="comment">// FIN_WAIT_1 or FIN_WAIT_2.</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="comment">// We should not receive this timeout in this state.</span>
            opp_error(<span class="stringliteral">&quot;Internal error: received time-wait (2MSL) timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7b47d21fa8a97f13cab52097f3332ea6"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_CONN_ESTAB" ref="a7b47d21fa8a97f13cab52097f3332ea6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_CONN_ESTAB </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
            <span class="comment">// Nothing to do here. TIMEOUT_CONN_ESTAB event will automatically</span>
            <span class="comment">// take the connection to LISTEN or CLOSED, and cancel SYN-REXMIT timer.</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a>)
            {
                <span class="comment">// notify user if we&#39;re on the active side</span>
                <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_TIMED_OUT);
            }
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="comment">// We should not receive this timeout in this state.</span>
            opp_error(<span class="stringliteral">&quot;Internal error: received CONN_ESTAB timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a53d62d237307ad56bae8d320ff557e48"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_FIN_WAIT_2" ref="a53d62d237307ad56bae8d320ff557e48" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_FIN_WAIT_2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
            <span class="comment">// Nothing to do here. The TIMEOUT_FIN_WAIT_2 event will automatically take</span>
            <span class="comment">// the connection to CLOSED.</span>
            <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:
            <span class="comment">// We should not receive this timeout in this state.</span>
            opp_error(<span class="stringliteral">&quot;Internal error: received FIN_WAIT_2 timeout in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33c6fe420de8b7fc6c09761f70118ed0"></a><!-- doxytag: member="TCPConnection::process_TIMEOUT_SYN_REXMIT" ref="a33c6fe420de8b7fc6c09761f70118ed0" args="(TCPEventCode &amp;event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::process_TIMEOUT_SYN_REXMIT </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (++<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;<a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission count during connection setup exceeds &quot;</span> &lt;&lt; <a class="code" href="_t_c_p_connection_8h.html#acd69c7cf1d3622b1d7aa706d7f9b97f9">MAX_SYN_REXMIT_COUNT</a> &lt;&lt; <span class="stringliteral">&quot;, giving up\n&quot;</span>;
        <span class="comment">// Note ABORT will take the connection to closed, and cancel CONN-ESTAB timer as well</span>
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>;
        <span class="keywordflow">return</span>;
    }

    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Performing retransmission #&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="comment">// resend what&#39;s needed</span>
    <span class="keywordflow">switch</span>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>: <a class="code" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn</a>(); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>: <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>(); <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>:  opp_error(<span class="stringliteral">&quot;Internal error: SYN-REXMIT timer expired while in state %s&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()));
    }

    <span class="comment">// reschedule timer</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> *= 2;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> &gt; <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>)
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a0b48410b2bd35dbc6509568bfb1842aa">TCP_TIMEOUT_SYN_REXMIT_MAX</a>;
    <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac1144f5ca6e960176d6e623998cb7456"></a><!-- doxytag: member="TCPConnection::processAckInEstabEtc" ref="ac1144f5ca6e960176d6e623998cb7456" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAckInEstabEtc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing ACK in a data transfer state\n&quot;</span>;

    <span class="comment">//</span>
    <span class="comment">//&quot;</span>
    <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
    <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
    <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
    <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
    <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
    <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
    <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
    <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
    <span class="comment">//  drop the segment, and return.</span>
    <span class="comment">//</span>
    <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
    <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
    <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
    <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
    <span class="comment">//</span>
    <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
    <span class="comment">//  records the sequence number of the last segment used to update</span>
    <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
    <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
    <span class="comment">//  prevents using old segments to update the window.</span>
    <span class="comment">//&quot;</span>
    <span class="comment">// Note: should use SND.MAX instead of SND.NXT in above checks</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>, tcpseg-&gt;getAckNo()))
    {
        <span class="comment">//</span>
        <span class="comment">// duplicate ACK? A received TCP segment is a duplicate ACK if all of</span>
        <span class="comment">// the following apply:</span>
        <span class="comment">//    (1) snd_una==ackNo</span>
        <span class="comment">//    (2) segment contains no data</span>
        <span class="comment">//    (3) there&#39;s unacked data (snd_una!=snd_max)</span>
        <span class="comment">//</span>
        <span class="comment">// Note: ssfnet uses additional constraint &quot;window is the same as last</span>
        <span class="comment">// received (not an update)&quot; -- we don&#39;t do that because window updates</span>
        <span class="comment">// are ignored anyway if neither seqNo nor ackNo has changed.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>==tcpseg-&gt;getAckNo() &amp;&amp; tcpseg-&gt;getPayloadLength()==0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)
        {
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>++;
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
                <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);

            <span class="comment">// we need to update send window even if the ACK is a dupACK, because rcv win</span>
            <span class="comment">// could have been changed if faulty data receiver is not respecting the &quot;do not shrink window&quot; rule</span>
            <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg);

            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a83a8916731ff5ce73e5d4f05d8ae6d30">receivedDuplicateAck</a>();
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// if doesn&#39;t qualify as duplicate ACK, just ignore it.</span>
            <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()==0)
            {
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>!=tcpseg-&gt;getAckNo())
                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Old ACK: ackNo&lt;snd_una\n&quot;</span>;
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)
                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK looks duplicate but we have currently no unacked data (snd_una==snd_max)\n&quot;</span>;
            }

            <span class="comment">// reset counter</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
                <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
        }
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;getAckNo(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
    {
        <span class="comment">// ack in window.</span>
        uint32 old_snd_una = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = tcpseg-&gt;getAckNo();
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

        <span class="comment">// after retransmitting a lost segment, we may get an ack well ahead of snd_nxt</span>
        <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>))
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;

        <span class="comment">// RFC 1323, page 36:</span>
        <span class="comment">// &quot;If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
        <span class="comment">// Also compute a new estimate of round-trip time.  If Snd.TS.OK</span>
        <span class="comment">// bit is on, use my.TSclock - SEG.TSecr; otherwise use the</span>
        <span class="comment">// elapsed time since the first segment in the retransmission</span>
        <span class="comment">// queue was sent.  Any segments on the retransmission queue</span>
        <span class="comment">// which are thereby entirely acknowledged.&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ac2660d1b53bdca9a6b1cb54a7cee7ad6">rttMeasurementCompleteUsingTS</a>(<a class="code" href="class_t_c_p_connection.html#a5aac66dd96f84aae48e8fb0e45b86861">getTSecr</a>(tcpseg));
        <span class="comment">// Note: If TS is disabled the RTT measurement is complete in TCPBaseAlg::receivedDataAck()</span>

        uint32 discardUpToSeq = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;

        <span class="comment">// our FIN acked?</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; tcpseg-&gt;getAckNo()==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
        {
            <span class="comment">// set flag that our FIN has been acked</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK acks our FIN\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a> = <span class="keyword">true</span>;
            discardUpToSeq--; <span class="comment">// the FIN sequence number is not real data</span>
        }

        <span class="comment">// acked data no longer needed in send queue</span>
        <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(discardUpToSeq);
        <span class="comment">// acked data no longer needed in rexmit queue</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
            <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(discardUpToSeq);

        <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg);

        <span class="comment">// if segment contains data, wait until data has been forwarded to app before sending ACK,</span>
        <span class="comment">// otherwise we would use an old ACKNo</span>
        <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength() == 0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>)
        {
            <span class="comment">// notify</span>
            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#abe5d8e8c02ba34cd5c50eca71824b81e">receivedDataAck</a>(old_snd_una);

            <span class="comment">// in the receivedDataAck we need the old value</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
                <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
        }
    }
    <span class="keywordflow">else</span>
    {
        ASSERT(<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(tcpseg-&gt;getAckNo(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)); <span class="comment">// from if-ladder</span>

        <span class="comment">// send an ACK, drop the segment, and return.</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a113d03b1de3e1b788ae95635d69e064d">receivedAckForDataNotYetSent</a>(tcpseg-&gt;getAckNo());
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
            <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// means &quot;drop&quot;</span>
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aebf3e44d104151c83a84a1efbae3f312"></a><!-- doxytag: member="TCPConnection::processAppCommand" ref="aebf3e44d104151c83a84a1efbae3f312" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processAppCommand </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process commands from the application. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="class_t_c_p.html#ae3a05ea5147737dd2889b8afc2647f69">TCP::handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();

    <span class="comment">// first do actions</span>
    TCPCommand *tcpCommand = (TCPCommand *)(msg-&gt;removeControlInfo());
    <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a792d9159b4e64b344cac79d0716c907a">preanalyseAppCommandEvent</a>(msg-&gt;getKind());
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;App command: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#af199cd53f71f27341684145c3bdab306">eventName</a>(event) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">switch</span> (event)
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea17e50afaeaa3dbb408d5cdeb89e72e73">TCP_E_OPEN_ACTIVE</a>: <a class="code" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaea16a1754a7e2cd75ffd5e58be566a3f">TCP_E_OPEN_PASSIVE</a>: <a class="code" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaeea7c15df02e9826f07358dcee5980f4">TCP_E_SEND</a>: <a class="code" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>: <a class="code" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea2cc18190ce98d4997975fa624a8e147d">TCP_E_ABORT</a>: <a class="code" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eae44e44115e1cee7dfc8432ea3b393064">TCP_E_STATUS</a>: <a class="code" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS</a>(event, tcpCommand, msg); <span class="keywordflow">break</span>;
        <span class="keywordflow">default</span>: opp_error(<span class="stringliteral">&quot;wrong event code&quot;</span>);
    }

    <span class="comment">// then state transitions</span>
    <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a632302213a1f4344d908bdfd1509323d"></a><!-- doxytag: member="TCPConnection::processMSSOption" ref="a632302213a1f4344d908bdfd1509323d" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processMSSOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TCPOption &amp;&#160;</td>
          <td class="paramname"><em>option</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (option.getLength() != 4)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option MSS received, but in unexpected state\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (option.getValuesArraySize() == 0)
    {
        <span class="comment">// since option.getLength() was already checked, this is a programming error not a TCP error</span>
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;TCPOption for MSS does not contain the data its getLength() promises&quot;</span>);
    }

    <span class="comment">// RFC 2581, page 1:</span>
    <span class="comment">// &quot;The SMSS is the size of the largest segment that the sender can transmit.</span>
    <span class="comment">// This value can be based on the maximum transmission unit of the network,</span>
    <span class="comment">// the path MTU discovery [MD90] algorithm, RMSS (see next item), or other</span>
    <span class="comment">// factors.  The size does not include the TCP/IP headers and options.&quot;</span>
    <span class="comment">//</span>
    <span class="comment">// &quot;The RMSS is the size of the largest segment the receiver is willing to accept.</span>
    <span class="comment">// This is the value specified in the MSS option sent by the receiver during</span>
    <span class="comment">// connection startup.  Or, if the MSS option is not used, 536 bytes [Bra89].</span>
    <span class="comment">// The size does not include the TCP/IP headers and options.&quot;</span>
    <span class="comment">//</span>
    <span class="comment">//</span>
    <span class="comment">// The value of snd_mss (SMSS) is set to the minimum of snd_mss (local parameter) and</span>
    <span class="comment">// the value specified in the MSS option received during connection startup.</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>, (uint32) option.getValues(0));
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>==0)
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> = 536;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option MSS(=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;) received, SMSS is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4d240ca8f36aa37a29b8bcc44ec052cd"></a><!-- doxytag: member="TCPConnection::processRstInSynReceived" ref="a4d240ca8f36aa37a29b8bcc44ec052cd" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processRstInSynReceived </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing RST in SYN_RCVD\n&quot;</span>;

    <span class="comment">//&quot;</span>
    <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
    <span class="comment">// came from the LISTEN state), then return this connection to</span>
    <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
    <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
    <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
    <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
    <span class="comment">// on the retransmission queue should be removed.  And in the</span>
    <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
    <span class="comment">// and return.</span>
    <span class="comment">//&quot;</span>

    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>()); <span class="comment">// flush send queue</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
        <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#aab51c929cca62ab481aebf24ecaff747">getBufferEndSeq</a>()); <span class="comment">// flush rexmit queue</span>

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a4341a40e233610fbf989e373e450a08d">active</a>)
    {
        <span class="comment">// signal &quot;connection refused&quot;</span>
        <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CONNECTION_REFUSED);
    }

    <span class="comment">// on RCV_RST, FSM will go either to LISTEN or to CLOSED, depending on state-&gt;active</span>
    <span class="comment">// FIXME if this was a forked connection, it should rather close than go back to listening (otherwise we&#39;d now have two listening connections with the original one!)</span>
    <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33b50078727564bd2c4e7e906e2f1648"></a><!-- doxytag: member="TCPConnection::processSACKOption" ref="a33b50078727564bd2c4e7e906e2f1648" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processSACKOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TCPOption &amp;&#160;</td>
          <td class="paramname"><em>option</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (option.getLength() % 8 != 2)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option SACK received, but in unexpected state\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: &quot;</span> &lt;&lt; (option.getLength()/2) &lt;&lt; <span class="stringliteral">&quot;. SACK(s) received, but sack_enabled is set to &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> n = option.getValuesArraySize()/2;
    <span class="keywordflow">if</span> (n &gt; 0) <span class="comment">// sacks present?</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot; SACK(s) received:\n&quot;</span>;
        <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> count=0;
        <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;n; i++)
        {
            Sack tmp;
            tmp.setStart(option.getValues(count));
            count++;
            tmp.setEnd(option.getValues(count));
            count++;

            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; (i+1) &lt;&lt; <span class="stringliteral">&quot;. SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.getStart() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.getEnd() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;

            <span class="comment">// check for D-SACK</span>
            <span class="keywordflow">if</span> (i==0 &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(tmp.getEnd(), tcpseg-&gt;getAckNo()))
            {
                <span class="comment">// RFC 2883, page 8:</span>
                <span class="comment">// &quot;In order for the sender to check that the first (D)SACK block of an</span>
                <span class="comment">// acknowledgement in fact acknowledges duplicate data, the sender</span>
                <span class="comment">// should compare the sequence space in the first SACK block to the</span>
                <span class="comment">// cumulative ACK which is carried IN THE SAME PACKET.  If the SACK</span>
                <span class="comment">// sequence space is less than this cumulative ACK, it is an indication</span>
                <span class="comment">// that the segment identified by the SACK block has been received more</span>
                <span class="comment">// than once by the receiver.  An implementation MUST NOT compare the</span>
                <span class="comment">// sequence space in the SACK block to the TCP state variable snd.una</span>
                <span class="comment">// (which carries the total cumulative ACK), as this may result in the</span>
                <span class="comment">// wrong conclusion if ACK packets are reordered.&quot;</span>
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received D-SACK below cumulative ACK=&quot;</span> &lt;&lt; tcpseg-&gt;getAckNo() &lt;&lt; <span class="stringliteral">&quot; D-SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.getStart() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.getEnd() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==0 &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(tmp.getEnd(), tcpseg-&gt;getAckNo()) &amp;&amp; n&gt;1)
            {
                <span class="comment">// RFC 2883, page 8:</span>
                <span class="comment">// &quot;If the sequence space in the first SACK block is greater than the</span>
                <span class="comment">// cumulative ACK, then the sender next compares the sequence space in</span>
                <span class="comment">// the first SACK block with the sequence space in the second SACK</span>
                <span class="comment">// block, if there is one.  This comparison can determine if the first</span>
                <span class="comment">// SACK block is reporting duplicate data that lies above the cumulative</span>
                <span class="comment">// ACK.&quot;</span>
                Sack tmp2;
                tmp2.setStart(option.getValues(2));
                tmp2.setEnd(option.getValues(3));

                <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(tmp.getStart(), tmp2.getStart()) &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tmp.getEnd(), tmp2.getEnd()))
                {<a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Received D-SACK above cumulative ACK=&quot;</span> &lt;&lt; tcpseg-&gt;getAckNo() &lt;&lt; <span class="stringliteral">&quot; D-SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp.getStart() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp.getEnd() &lt;&lt; <span class="stringliteral">&quot;) SACK:&quot;</span> &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; tmp2.getStart() &lt;&lt; <span class="stringliteral">&quot;..&quot;</span> &lt;&lt; tmp2.getEnd() &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;}
            }

            <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(tmp.getEnd(), tcpseg-&gt;getAckNo()))
                <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#abd0309b9f592a452399c73174bbd94cf">setSackedBit</a>(tmp.getStart(), tmp.getEnd());
        }
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a> + n; <span class="comment">// total counter, no current number</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">rcvSacksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a89f41e684a082c84539dc4876bca0322">rcv_sacks</a>);

        <span class="comment">// update scoreboard</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#afc44bbf1e92ac47b7ef4ed4158af9a64">sackedBytes_old</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>; <span class="comment">// needed for RFC 3042 to check if last dupAck contained new sack information</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a9e3ff65826298ce1b2000bbd0bc04957">getTotalAmountOfSackedBytes</a>();
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">sackedBytesVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>);
    }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a009bb98808477c6cbf9b0b82c3ae2ca4"></a><!-- doxytag: member="TCPConnection::processSACKPermittedOption" ref="a009bb98808477c6cbf9b0b82c3ae2ca4" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processSACKPermittedOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TCPOption &amp;&#160;</td>
          <td class="paramname"><em>option</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (option.getLength() != 2)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: length incorrect\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option SACK_PERMITTED received, but in unexpected state\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a> = <span class="keyword">true</span>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a>;
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option SACK_PERMITTED received, SACK (sack_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0758284e5bd6bd162b6ff267add2e2d"></a><!-- doxytag: member="TCPConnection::processSegment1stThru8th" ref="aa0758284e5bd6bd162b6ff267add2e2d" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegment1stThru8th </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">//</span>
    <span class="comment">// RFC 793: first check sequence number</span>
    <span class="comment">//</span>

    <span class="keywordtype">bool</span> acceptable = <span class="keyword">true</span>;

    <span class="keywordflow">if</span> (tcpseg-&gt;getHeaderLength() &gt; TCP_HEADER_OCTETS) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
    {
        <span class="comment">// PAWS</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
        {
            uint32 tsval = <a class="code" href="class_t_c_p_connection.html#a3d4824b8c96a46028c5a337c1ae22f59">getTSval</a>(tcpseg);
            <span class="comment">// FIXME check TS rounding on all other code</span>
            <span class="keywordflow">if</span> (tsval != 0 &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(tsval, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a>) &amp;&amp;
                    (simTime() - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8ac5ae9db4029d0f8a6cff75297fa2c8">time_last_data_sent</a>) &gt; <a class="code" href="_t_c_p_connection_8h.html#a6d5e1b9a987d5263ed7885c1e13a5dbf">PAWS_IDLE_TIME_THRESH</a>) <span class="comment">// PAWS_IDLE_TIME_THRESH = 24 days</span>
            {
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;PAWS: Segment is not acceptable, TSval=&quot;</span> &lt;&lt; tsval &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt;
                        <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; state received: dropping segment\n&quot;</span>;
                acceptable = <span class="keyword">false</span>;
            }
        }
        <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);
    }

    <span class="keywordflow">if</span> (acceptable)
        acceptable = <a class="code" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg);

    <span class="keywordflow">if</span> (!acceptable)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// If an incoming segment is not acceptable, an acknowledgment</span>
        <span class="comment">// should be sent in reply (unless the RST bit is set, if so drop</span>
        <span class="comment">// the segment and return):</span>
        <span class="comment">//</span>
        <span class="comment">//  &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
        <span class="comment">//&quot;</span>
        <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST with unacceptable seqNum: dropping\n&quot;</span>;
        }
        <span class="keywordflow">else</span>
        {
            <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit())
            {
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN with unacceptable seqNum in &quot;</span> &lt;&lt;  <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; state received (SYN duplicat?)\n&quot;</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>((tcpseg-&gt;getSequenceNo()+tcpseg-&gt;getPayloadLength()), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))
            {
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;getSequenceNo();
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;getSequenceNo() + tcpseg-&gt;getPayloadLength();
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>;
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_D-SACK SET (dupseg rcvd)\n&quot;</span>;
            }

            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment seqNum not acceptable, sending ACK with current receive seq\n&quot;</span>;
            <span class="comment">// RFC 2018, page 4:</span>
            <span class="comment">// &quot;The receiver SHOULD send an ACK for every valid segment that arrives</span>
            <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
            <span class="comment">// SACK option.&quot;</span>
            <span class="comment">//</span>
            <span class="comment">// The received segment is not &quot;valid&quot; therefore the ACK will not bear a SACK option, if snd_dsack (D-SACK) is not set.</span>
            <a class="code" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
        }
        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
    }

    <span class="comment">//</span>
    <span class="comment">// RFC 793: second check the RST bit,</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())
    {
        <span class="comment">// Note: if we come from LISTEN, processSegmentInListen() has already handled RST.</span>
        <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
        {
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
                <span class="comment">//&quot;</span>
                <span class="comment">// If this connection was initiated with a passive OPEN (i.e.,</span>
                <span class="comment">// came from the LISTEN state), then return this connection to</span>
                <span class="comment">// LISTEN state and return.  The user need not be informed.  If</span>
                <span class="comment">// this connection was initiated with an active OPEN (i.e., came</span>
                <span class="comment">// from SYN-SENT state) then the connection was refused, signal</span>
                <span class="comment">// the user &quot;connection refused&quot;.  In either case, all segments</span>
                <span class="comment">// on the retransmission queue should be removed.  And in the</span>
                <span class="comment">// active OPEN case, enter the CLOSED state and delete the TCB,</span>
                <span class="comment">// and return.</span>
                <span class="comment">//&quot;</span>
                <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived</a>(tcpseg);

            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
                <span class="comment">//&quot;</span>
                <span class="comment">// If the RST bit is set then, any outstanding RECEIVEs and SEND</span>
                <span class="comment">// should receive &quot;reset&quot; responses.  All segment queues should be</span>
                <span class="comment">// flushed.  Users should also receive an unsolicited general</span>
                <span class="comment">// &quot;connection reset&quot; signal.</span>
                <span class="comment">//</span>
                <span class="comment">// Enter the CLOSED state, delete the TCB, and return.</span>
                <span class="comment">//&quot;</span>
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: performing connection reset, closing connection\n&quot;</span>;
                <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
                <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;  <span class="comment">// this will trigger state transition</span>

            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
                <span class="comment">//&quot;</span>
                <span class="comment">// enter the CLOSED state, delete the TCB, and return.</span>
                <span class="comment">//&quot;</span>
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST: closing connection\n&quot;</span>;
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()!=<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>)
                    <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED); <span class="comment">// in TIME_WAIT, we&#39;ve already sent it</span>
                <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>; <span class="comment">// this will trigger state transition</span>

            <span class="keywordflow">default</span>: ASSERT(0);
        }
    }

    <span class="comment">// RFC 793: third check security and precedence</span>
    <span class="comment">// This step is ignored.</span>

    <span class="comment">//</span>
    <span class="comment">// RFC 793: fourth, check the SYN bit,</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit())
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// If the SYN is in the window it is an error, send a reset, any</span>
        <span class="comment">// outstanding RECEIVEs and SEND should receive &quot;reset&quot; responses,</span>
        <span class="comment">// all segment queues should be flushed, the user should also</span>
        <span class="comment">// receive an unsolicited general &quot;connection reset&quot; signal, enter</span>
        <span class="comment">// the CLOSED state, delete the TCB, and return.</span>
        <span class="comment">//</span>
        <span class="comment">// If the SYN is not in the window this step would not be reached</span>
        <span class="comment">// and an ack would have been sent in the first step (sequence</span>
        <span class="comment">// number check).</span>
        <span class="comment">//&quot;</span>

        ASSERT(<a class="code" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable</a>(tcpseg));  <span class="comment">// assert SYN is in the window</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN is in the window: performing connection reset, closing connection\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eac411ade35040a1a93a97487da933a6ff">TCP_E_RCV_UNEXP_SYN</a>;
    }

    <span class="comment">//</span>
    <span class="comment">// RFC 793: fifth check the ACK field,</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (!tcpseg-&gt;getAckBit())
    {
        <span class="comment">// if the ACK bit is off drop the segment and return</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK not set, dropping segment\n&quot;</span>;
        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
    }

    uint32 old_snd_una = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;

    <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then enter ESTABLISHED state</span>
        <span class="comment">// and continue processing.</span>
        <span class="comment">//</span>
        <span class="comment">// If the segment acknowledgment is not acceptable, form a</span>
        <span class="comment">// reset segment,</span>
        <span class="comment">//</span>
        <span class="comment">//  &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
        <span class="comment">//</span>
        <span class="comment">// and send it.</span>
        <span class="comment">//&quot;</span>
        <span class="keywordflow">if</span> (!<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>,tcpseg-&gt;getAckNo()) || !<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;getAckNo(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>))
        {
            <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;getAckNo());
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
        }

        <span class="comment">// notify tcpAlgorithm and app layer</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a2d051b6a9e2a9fccfa6f8b64bb8c647d">established</a>(<span class="keyword">false</span>);
        <a class="code" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();

        <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
        <span class="comment">// app will be taken care of in stateEntered().</span>
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;
    }

    uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>; <span class="comment">// later we&#39;ll need to see if snd_nxt changed</span>
    <span class="comment">// Note: If one of the last data segments is lost while already in LAST-ACK state (e.g. if using TCPEchoApps)</span>
    <span class="comment">// TCP must be able to process acceptable acknowledgments, however please note RFC 793, page 73:</span>
        <span class="comment">// &quot;LAST-ACK STATE</span>
    <span class="comment">//    The only thing that can arrive in this state is an</span>
    <span class="comment">//    acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
    <span class="comment">//    delete the TCB, enter the CLOSED state, and return.&quot;</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> ||
        <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a> ||
        <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>)
    {
        <span class="comment">//</span>
        <span class="comment">// ESTABLISHED processing:</span>
        <span class="comment">//&quot;</span>
        <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT then, set SND.UNA &lt;- SEG.ACK.</span>
        <span class="comment">//  Any segments on the retransmission queue which are thereby</span>
        <span class="comment">//  entirely acknowledged are removed.  Users should receive</span>
        <span class="comment">//  positive acknowledgments for buffers which have been SENT and</span>
        <span class="comment">//  fully acknowledged (i.e., SEND buffer should be returned with</span>
        <span class="comment">//  &quot;ok&quot; response).  If the ACK is a duplicate</span>
        <span class="comment">//  (SEG.ACK &lt; SND.UNA), it can be ignored.  If the ACK acks</span>
        <span class="comment">//  something not yet sent (SEG.ACK &gt; SND.NXT) then send an ACK,</span>
        <span class="comment">//  drop the segment, and return.</span>
        <span class="comment">//</span>
        <span class="comment">//  If SND.UNA &lt; SEG.ACK =&lt; SND.NXT, the send window should be</span>
        <span class="comment">//  updated.  If (SND.WL1 &lt; SEG.SEQ or (SND.WL1 = SEG.SEQ and</span>
        <span class="comment">//  SND.WL2 =&lt; SEG.ACK)), set SND.WND &lt;- SEG.WND, set</span>
        <span class="comment">//  SND.WL1 &lt;- SEG.SEQ, and set SND.WL2 &lt;- SEG.ACK.</span>
        <span class="comment">//</span>
        <span class="comment">//  Note that SND.WND is an offset from SND.UNA, that SND.WL1</span>
        <span class="comment">//  records the sequence number of the last segment used to update</span>
        <span class="comment">//  SND.WND, and that SND.WL2 records the acknowledgment number of</span>
        <span class="comment">//  the last segment used to update SND.WND.  The check here</span>
        <span class="comment">//  prevents using old segments to update the window.</span>
        <span class="comment">//&quot;</span>
        <span class="keywordtype">bool</span> ok = <a class="code" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc</a>(tcpseg);
        <span class="keywordflow">if</span> (!ok)
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;  <span class="comment">// if acks something not yet sent, drop it</span>
    }

    <span class="keywordflow">if</span> ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>))
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// FIN-WAIT-1 STATE</span>
        <span class="comment">//   In addition to the processing for the ESTABLISHED state, if</span>
        <span class="comment">//   our FIN is now acknowledged then enter FIN-WAIT-2 and continue</span>
        <span class="comment">//   processing in that state.</span>
        <span class="comment">//&quot;</span>
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to FIN-WAIT-2</span>
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// FIN-WAIT-2 STATE</span>
        <span class="comment">//  In addition to the processing for the ESTABLISHED state, if</span>
        <span class="comment">//  the retransmission queue is empty, the user&#39;s CLOSE can be</span>
        <span class="comment">//  acknowledged (&quot;ok&quot;) but do not delete the TCB.</span>
        <span class="comment">//&quot;</span>
        <span class="comment">// nothing to do here (in our model, used commands don&#39;t need to be</span>
        <span class="comment">// acknowledged)</span>
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// In addition to the processing for the ESTABLISHED state, if</span>
        <span class="comment">// the ACK acknowledges our FIN then enter the TIME-WAIT state,</span>
        <span class="comment">// otherwise ignore the segment.</span>
        <span class="comment">//&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Our FIN acked -- can go to TIME_WAIT now\n&quot;</span>;
            <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>;  <span class="comment">// will trigger transition to TIME-WAIT</span>
            <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);  <span class="comment">// start timer</span>

            <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
            <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
            <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// The only thing that can arrive in this state is an</span>
        <span class="comment">// acknowledgment of our FIN.  If our FIN is now acknowledged,</span>
        <span class="comment">// delete the TCB, enter the CLOSED state, and return.</span>
        <span class="comment">//&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; tcpseg-&gt;getAckNo()==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Last ACK arrived\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea5458371b7cd8cddaa5342ab47915844a">TCP_E_RCV_ACK</a>; <span class="comment">// will trigger transition to CLOSED</span>
        }
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// The only thing that can arrive in this state is a</span>
        <span class="comment">// retransmission of the remote FIN.  Acknowledge it, and restart</span>
        <span class="comment">// the 2 MSL timeout.</span>
        <span class="comment">//&quot;</span>
        <span class="comment">// And we are staying in the TIME_WAIT state.</span>
        <span class="comment">//</span>
        <a class="code" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck</a>();
        <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
        <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
    }

    <span class="comment">//</span>
    <span class="comment">// RFC 793: sixth, check the URG bit,</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getUrgBit() &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> ||
            <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>))
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// If the URG bit is set, RCV.UP &lt;- max(RCV.UP,SEG.UP), and signal</span>
        <span class="comment">// the user that the remote side has urgent data if the urgent</span>
        <span class="comment">// pointer (RCV.UP) is in advance of the data consumed.  If the</span>
        <span class="comment">// user has already been signaled (or is still in the &quot;urgent</span>
        <span class="comment">// mode&quot;) for this continuous sequence of urgent data, do not</span>
        <span class="comment">// signal the user again.</span>
        <span class="comment">//&quot;</span>

        <span class="comment">// TBD: URG currently not supported</span>
    }

    <span class="comment">//</span>
    <span class="comment">// RFC 793: seventh, process the segment text,</span>
    <span class="comment">//</span>
    uint32 old_rcv_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>; <span class="comment">// if rcv_nxt changes, we need to send/schedule an ACK</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> ||
            <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>)
    {
        <span class="comment">//&quot;</span>
        <span class="comment">// Once in the ESTABLISHED state, it is possible to deliver segment</span>
        <span class="comment">// text to user RECEIVE buffers.  Text from segments can be moved</span>
        <span class="comment">// into buffers until either the buffer is full or the segment is</span>
        <span class="comment">// empty.  If the segment empties and carries an PUSH flag, then</span>
        <span class="comment">// the user is informed, when the buffer is returned, that a PUSH</span>
        <span class="comment">// has been received.</span>
        <span class="comment">//</span>
        <span class="comment">// When the TCP takes responsibility for delivering the data to the</span>
        <span class="comment">// user it must also acknowledge the receipt of the data.</span>
        <span class="comment">//</span>
        <span class="comment">// Once the TCP takes responsibility for the data it advances</span>
        <span class="comment">// RCV.NXT over the data accepted, and adjusts RCV.WND as</span>
        <span class="comment">// apporopriate to the current buffer availability.  The total of</span>
        <span class="comment">// RCV.NXT and RCV.WND should not be reduced.</span>
        <span class="comment">//</span>
        <span class="comment">// Please note the window management suggestions in section 3.7.</span>
        <span class="comment">//</span>
        <span class="comment">// Send an acknowledgment of the form:</span>
        <span class="comment">//</span>
        <span class="comment">//   &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
        <span class="comment">//</span>
        <span class="comment">// This acknowledgment should be piggybacked on a segment being</span>
        <span class="comment">// transmitted if possible without incurring undue delay.</span>
        <span class="comment">//&quot;</span>

        tcpseg-&gt;<a class="code" href="class_t_c_p_segment.html#a41b595a9daaa8132ef11aa10f24dbabd">truncateSegment</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);

        <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()&gt;0)
        {
            <span class="comment">// check for full sized segment</span>
            <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength() == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> || tcpseg-&gt;getPayloadLength() + tcpseg-&gt;getHeaderLength() - TCP_HEADER_OCTETS == <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5d47c2c046bb9fe704be153bb0731e9a">full_sized_segment_counter</a>++;
            <span class="comment">// check for persist probe</span>
            if (tcpseg-&gt;getPayloadLength() == 1)
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;    <span class="comment">// TODO how to check if it is really a persist probe?</span>

            <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;getPayloadLength()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
            {
                <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment text in a data transfer state\n&quot;</span>;

                <span class="comment">// insert into receive buffers. If this segment is contiguous with</span>
                <span class="comment">// previously received ones (seqNo==rcv_nxt), rcv_nxt can be increased;</span>
                <span class="comment">// otherwise it stays the same but the data must be cached nevertheless</span>
                <span class="comment">// (to avoid &quot;Failure to retain above-sequence data&quot; problem, RFC 2525</span>
                <span class="comment">// section 2.5).</span>

                uint32 old_usedRcvBuffer = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a>;
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);

                <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>, old_snd_una))
                {
                    <span class="comment">// notify</span>
                    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#abe5d8e8c02ba34cd5c50eca71824b81e">receivedDataAck</a>(old_snd_una);

                    <span class="comment">// in the receivedDataAck we need the old value</span>
                    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a> = 0;
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>)
                        <a class="code" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">dupAcksVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ae3ddd98e68751df8e6a8f4c0c7081f28">dupacks</a>);
                }

                <span class="comment">// out-of-order segment?</span>
                <span class="keywordflow">if</span> (old_rcv_nxt==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
                {
                    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2297a0a5817443e592d2770ec016b0a0">rcv_oooseg</a>++;
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>)
                        <a class="code" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">rcvOooSegVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2297a0a5817443e592d2770ec016b0a0">rcv_oooseg</a>);

                    <span class="comment">// RFC 2018, page 4:</span>
                    <span class="comment">// &quot;The receiver SHOULD send an ACK for every valid segment that arrives</span>
                    <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
                    <span class="comment">// SACK option.&quot;</span>
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
                    {
                        <span class="comment">// store start and end sequence numbers of current oooseg in state variables</span>
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;getSequenceNo();
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;getSequenceNo() + tcpseg-&gt;getPayloadLength();

                        <span class="keywordflow">if</span> (old_usedRcvBuffer == <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a46f4aa6d8cd91c25275f3997fc3e2e04">getAmountOfBufferedBytes</a>()) <span class="comment">// D-SACK</span>
                        {
                            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a> = <span class="keyword">true</span>;
                            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_D-SACK SET (old_rcv_nxt==rcv_nxt duplicated oooseg rcvd)\n&quot;</span>;
                        }
                        <span class="keywordflow">else</span> <span class="comment">// SACK</span>
                        {
                            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> = <span class="keyword">true</span>;
                            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_SACK SET (old_rcv_nxt==rcv_nxt oooseg rcvd)\n&quot;</span>;
                        }
                    }
                    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a10903af17a26011a95b6745eb80f65ed">receivedOutOfOrderSegment</a>();
                }
                <span class="keywordflow">else</span>
                {
                    <span class="comment">// forward data to app</span>
                    <span class="comment">//</span>
                    <span class="comment">// FIXME observe PSH bit</span>
                    <span class="comment">//</span>
                    <span class="comment">// FIXME we should implement socket READ command, and pass up only</span>
                    <span class="comment">// as many bytes as requested. rcv_wnd should be decreased</span>
                    <span class="comment">// accordingly!</span>
                    <span class="comment">//</span>
                    cPacket *msg;
                    <span class="keywordflow">while</span> ((msg=<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#abfb833d10d529c1f9fda7d09e3616699">extractBytesUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>))!=NULL)
                    {
                        msg-&gt;setKind(TCP_I_DATA);  <span class="comment">// TBD currently we never send TCP_I_URGENT_DATA</span>
                        TCPCommand *cmd = <span class="keyword">new</span> TCPCommand();
                        cmd-&gt;setConnId(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
                        msg-&gt;setControlInfo(cmd);
                        <a class="code" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp</a>(msg);
                    }

                    <span class="comment">// if this segment &quot;filled the gap&quot; until the previously arrived segment</span>
                    <span class="comment">// that carried a FIN (i.e.rcv_nxt==rcv_fin_seq), we have to advance</span>
                    <span class="comment">// rcv_nxt over the FIN.</span>
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a32121c2fcf9d110150db1588cafa595a">fin_rcvd</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a>)
                    {
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>; <span class="comment">// although not mentioned in [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 861] seems like we have to set ack_now</span>
                        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;All segments arrived up to the FIN segment, advancing rcv_nxt over the FIN\n&quot;</span>;
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a>+1;
                        <span class="comment">// state transitions will be done in the state machine, here we just set</span>
                        <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
                        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>;
                        <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
                        {
                            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
                                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
                                {
                                    <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>;
                                    <span class="comment">// start the time-wait timer, turn off the other timers</span>
                                    <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
                                    <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);

                                    <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
                                    <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
                                    <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
                                }
                                <span class="keywordflow">break</span>;
                            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
                                <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
                                <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
                                <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);

                                <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
                                <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
                                <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
                                <span class="keywordflow">break</span>;
                            <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
                                <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
                                <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
                                <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
                                <span class="keywordflow">break</span>;
                        }
                        <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_PEER_CLOSED);
                    }
                }
            }
            <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
            {
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
                    <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);

                <span class="comment">// if the ACK bit is off drop the segment and return</span>
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
                <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
            }
        }
    }

    <span class="comment">//</span>
    <span class="comment">// RFC 793: eighth, check the FIN bit,</span>
    <span class="comment">//</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getFinBit())
    {
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;

        <span class="comment">//&quot;</span>
        <span class="comment">// If the FIN bit is set, signal the user &quot;connection closing&quot; and</span>
        <span class="comment">// return any pending RECEIVEs with same message, advance RCV.NXT</span>
        <span class="comment">// over the FIN, and send an acknowledgment for the FIN.  Note that</span>
        <span class="comment">// FIN implies PUSH for any segment text not yet delivered to the</span>
        <span class="comment">// user.</span>
        <span class="comment">//&quot;</span>

        <span class="comment">// Note: seems like RFC 793 is not entirely correct here: if the</span>
        <span class="comment">// segment is &quot;above sequence&quot; (ie. RCV.NXT &lt; SEG.SEQ), we cannot</span>
        <span class="comment">// advance RCV.NXT over the FIN. Instead we remember this sequence</span>
        <span class="comment">// number and do it later.</span>
        uint32 fin_seq = (uint32)tcpseg-&gt;getSequenceNo() + (uint32)tcpseg-&gt;getPayloadLength();
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>==fin_seq)
        {
            <span class="comment">// advance rcv_nxt over FIN now</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN arrived, advancing rcv_nxt over the FIN\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>++;
            <span class="comment">// state transitions will be done in the state machine, here we just set</span>
            <span class="comment">// the proper event code (TCP_E_RCV_FIN or TCP_E_RCV_FIN_ACK)</span>
            <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ead4c5a9bfbaf2accb23697809655f2e32">TCP_E_RCV_FIN</a>;
            <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState())
            {
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac70666b0903dcc4bb0c76e4e3ddd64cd">fin_ack_rcvd</a>)
                    {
                        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea9b1f9ceb96465850b379c784bb4d66c0">TCP_E_RCV_FIN_ACK</a>;
                        <span class="comment">// start the time-wait timer, turn off the other timers</span>
                        <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
                        <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);

                        <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
                        <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
                        <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
                    }
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
                    <span class="comment">// Start the time-wait timer, turn off the other timers.</span>
                    <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
                    <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);

                    <span class="comment">// we&#39;re entering TIME_WAIT, so we can signal CLOSED the user</span>
                    <span class="comment">// (the only thing left to do is wait until the 2MSL timer expires)</span>
                    <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CLOSED);
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
                    <span class="comment">// Restart the 2 MSL time-wait timeout.</span>
                    <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
                    <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a25bdc88481176d96d87d31d71f32579b">TCP_TIMEOUT_2MSL</a>);
                    <span class="keywordflow">break</span>;
            }
            <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_PEER_CLOSED);
        }
        <span class="keywordflow">else</span>
        {
            <span class="comment">// we&#39;ll have to do it later (when an arriving segment &quot;fills the gap&quot;)</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;FIN segment above sequence, storing sequence number of FIN\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a32121c2fcf9d110150db1588cafa595a">fin_rcvd</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1259e7450282a5b49755ea64b538a724">rcv_fin_seq</a> = fin_seq;
        }

        <span class="comment">// TBD do PUSH stuff</span>
    }

    <span class="keywordflow">if</span> (old_rcv_nxt!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
    {
        <span class="comment">// if rcv_nxt changed, either because we received segment text or we</span>
        <span class="comment">// received a FIN that needs to be acked (or both), we need to send or</span>
        <span class="comment">// schedule an ACK.</span>

        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
        {
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#a906163ab3363c8f66c60371e61e3fef6">getQueueLength</a>()!=0)
            {
                <span class="comment">// RFC 2018, page 4:</span>
                <span class="comment">// &quot;If sent at all, SACK options SHOULD be included in all ACKs which do</span>
                <span class="comment">// not ACK the highest sequence number in the data receiver&#39;s queue.&quot;</span>
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa65590b4103c7d29454d8ea5b3a781c0">start_seqno</a> = tcpseg-&gt;getSequenceNo();
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab59f15cb0300b2bb025186468e7a03a5">end_seqno</a> = tcpseg-&gt;getSequenceNo() + tcpseg-&gt;getPayloadLength();
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> = <span class="keyword">true</span>;
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SND_SACK SET (rcv_nxt changed, but rexmitQ is not empty)\n&quot;</span>;
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>; <span class="comment">// although not mentioned in [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 861] seems like we have to set ack_now</span>
            }
        }

        <span class="comment">// tcpAlgorithm decides when and how to do ACKs</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#abb6b842fa0651f13c99b30adebcc0e03">receiveSeqChanged</a>();
    }

    <span class="keywordflow">if</span> ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>) &amp;&amp;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
    {
        <span class="comment">// if the user issued the CLOSE command a long time ago and we&#39;ve just</span>
        <span class="comment">// managed to send off FIN, we simulate a CLOSE command now (we had to</span>
        <span class="comment">// defer it at that time because we still had data in the send queue.)</span>
        <span class="comment">// This CLOSE will take us into the FIN_WAIT_1 state.</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1 &amp;&amp; old_snd_nxt!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>)
    {
        <span class="comment">// if we&#39;re in CLOSE_WAIT and we just got to sent our long-pending FIN,</span>
        <span class="comment">// we simulate a CLOSE command now (we had to defer it at that time because</span>
        <span class="comment">// we still had data in the send queue.) This CLOSE will take us into the</span>
        <span class="comment">// LAST_ACK state.</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Now we can do the CLOSE which was deferred a while ago\n&quot;</span>;
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf537925659bfd1160ec2e37e0293c9cf">TCP_E_CLOSE</a>;
    }

    <span class="keywordflow">return</span> event;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4d034577df86997140d627feeda66a1f"></a><!-- doxytag: member="TCPConnection::processSegmentInListen" ref="a4d034577df86997140d627feeda66a1f" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegmentInListen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in LISTEN\n&quot;</span>;

    <span class="comment">//&quot;</span>
    <span class="comment">// first check for an RST</span>
    <span class="comment">//   An incoming RST should be ignored.  Return.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
    }

    <span class="comment">//&quot;</span>
    <span class="comment">// second check for an ACK</span>
    <span class="comment">//    Any acknowledgment is bad if it arrives on a connection still in</span>
    <span class="comment">//    the LISTEN state.  An acceptable reset segment should be formed</span>
    <span class="comment">//    for any arriving ACK-bearing segment.  The RST should be</span>
    <span class="comment">//    formatted as follows:</span>
    <span class="comment">//</span>
    <span class="comment">//      &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
    <span class="comment">//</span>
    <span class="comment">//    Return.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: dropping segment and sending RST\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;getAckNo(),destAddr,srcAddr,tcpseg-&gt;getDestPort(),tcpseg-&gt;getSrcPort());
        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
    }

    <span class="comment">//&quot;</span>
    <span class="comment">// third check for a SYN</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit())
    {
        <span class="keywordflow">if</span> (tcpseg-&gt;getFinBit())
        {
            <span class="comment">// Looks like implementations vary on how to react to SYN+FIN.</span>
            <span class="comment">// Some treat it as plain SYN (and reply with SYN+ACK), some send RST+ACK.</span>
            <span class="comment">// Let&#39;s just do the former here.</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;
        }

        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: filling in foreign socket and sending SYN+ACK\n&quot;</span>;

        <span class="comment">//&quot;</span>
        <span class="comment">// If the listen was not fully specified (i.e., the foreign socket was not</span>
        <span class="comment">// fully specified), then the unspecified fields should be filled in now.</span>
        <span class="comment">//&quot;</span>
        <span class="comment">//</span>
        <span class="comment">// Also, we may need to fork, in order to leave another connection</span>
        <span class="comment">// LISTENing on the port. Note: forking will change our connId.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8762f606d8dd51286d61ebbe833df932">fork</a>)
        {
            <a class="code" href="class_t_c_p_connection.html">TCPConnection</a> *conn = <a class="code" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection</a>(); <span class="comment">// &quot;conn&quot; is the clone which will stay LISTENing, while &quot;this&quot; gets updated with the remote address</span>
            <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">addForkedConnection</a>(<span class="keyword">this</span>, conn, destAddr, srcAddr, tcpseg-&gt;getDestPort(), tcpseg-&gt;getSrcPort());
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Connection forked: this connection got new connId=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                <span class="stringliteral">&quot;spinoff keeps LISTENing with connId=&quot;</span> &lt;&lt; conn-&gt;<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;getDestPort(), tcpseg-&gt;getSrcPort());
        }

        <span class="comment">//&quot;</span>
        <span class="comment">//  Set RCV.NXT to SEG.SEQ+1, IRS is set to SEG.SEQ and any other</span>
        <span class="comment">//  control or text should be queued for processing later.  ISS</span>
        <span class="comment">//  should be selected and a SYN segment sent of the form:</span>
        <span class="comment">//</span>
        <span class="comment">//    &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
        <span class="comment">//</span>
        <span class="comment">//  SND.NXT is set to ISS+1 and SND.UNA to ISS.  The connection</span>
        <span class="comment">//  state should be changed to SYN-RECEIVED.</span>
        <span class="comment">//&quot;</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = tcpseg-&gt;getSequenceNo()+1;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>;
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>) <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a> = tcpseg-&gt;getSequenceNo();
        <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#aa830dbb0737de38e3a564aaa806ea99f">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);   <span class="comment">// FIXME may init twice...</span>
        <a class="code" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum</a>();

        <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
        <span class="comment">// initial snd_wnd from the segment here.</span>
        <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg, <span class="keyword">true</span>);

        <span class="keywordflow">if</span> (tcpseg-&gt;getHeaderLength() &gt; TCP_HEADER_OCTETS) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
            <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);

        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;
        <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
        <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();
        <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>-&gt;isScheduled())
            <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>, <a class="code" href="_t_c_p_connection_8h.html#a512458671be6d68703cc89178b0b35f0">TCP_TIMEOUT_CONN_ESTAB</a>);

        <span class="comment">//&quot;</span>
        <span class="comment">// Note that any other incoming control or data (combined with SYN)</span>
        <span class="comment">// will be processed in the SYN-RECEIVED state, but processing of SYN</span>
        <span class="comment">// and ACK should not be repeated.</span>
        <span class="comment">//&quot;</span>
        <span class="comment">// We don&#39;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
        <span class="comment">// there isn&#39;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
        <span class="comment">// so there&#39;s only URG and PSH left to handle.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()&gt;0)
        {
            <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;getPayloadLength()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
            {
                <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);
            }
            <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
            {
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
                    <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);

                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
                <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
            }
        }
        <span class="keywordflow">if</span> (tcpseg-&gt;getUrgBit() || tcpseg-&gt;getPshBit())
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>

        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>;  <span class="comment">// this will take us to SYN_RCVD</span>
    }

    <span class="comment">//&quot;</span>
    <span class="comment">//  fourth other text or control</span>
    <span class="comment">//   So you are unlikely to get here, but if you do, drop the segment, and return.</span>
    <span class="comment">//&quot;</span>
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected segment: dropping it\n&quot;</span>;
    <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a12b903f9e148f5c26f926dcdc8107c86"></a><!-- doxytag: member="TCPConnection::processSegmentInSynSent" ref="a12b903f9e148f5c26f926dcdc8107c86" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> TCPConnection::processSegmentInSynSent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a5eb334f5e4b6d6bb414d16141aca18af">tcpEV2</a> &lt;&lt; <span class="stringliteral">&quot;Processing segment in SYN_SENT\n&quot;</span>;

    <span class="comment">//&quot;</span>
    <span class="comment">// first check the ACK bit</span>
    <span class="comment">//</span>
    <span class="comment">//   If the ACK bit is set</span>
    <span class="comment">//</span>
    <span class="comment">//     If SEG.ACK =&lt; ISS, or SEG.ACK &gt; SND.NXT, send a reset (unless</span>
    <span class="comment">//     the RST bit is set, if so drop the segment and return)</span>
    <span class="comment">//</span>
    <span class="comment">//       &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
    <span class="comment">//</span>
    <span class="comment">//     and discard the segment.  Return.</span>
    <span class="comment">//</span>
    <span class="comment">//     If SND.UNA =&lt; SEG.ACK =&lt; SND.NXT then the ACK is acceptable.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
    {
        <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;getAckNo(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>) || <a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(tcpseg-&gt;getAckNo(),<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>))
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set but wrong AckNo, sending RST\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;getAckNo(),destAddr,srcAddr,tcpseg-&gt;getDestPort(),tcpseg-&gt;getSrcPort());
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
        }
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set, AckNo acceptable\n&quot;</span>;
    }

    <span class="comment">//&quot;</span>
    <span class="comment">// second check the RST bit</span>
    <span class="comment">//</span>
    <span class="comment">//   If the RST bit is set</span>
    <span class="comment">//</span>
    <span class="comment">//     If the ACK was acceptable then signal the user &quot;error:</span>
    <span class="comment">//     connection reset&quot;, drop the segment, enter CLOSED state,</span>
    <span class="comment">//     delete TCB, and return.  Otherwise (no ACK) drop the segment</span>
    <span class="comment">//     and return.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())
    {
        <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST+ACK: performing connection reset\n&quot;</span>;
            <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_CONNECTION_RESET);
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eaf96013e6e28c73e47277bb885fcf7aa6">TCP_E_RCV_RST</a>;
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST without ACK: dropping segment\n&quot;</span>;
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
        }
    }

    <span class="comment">//&quot;</span>
    <span class="comment">// third check the security and precedence -- not done</span>
    <span class="comment">//</span>
    <span class="comment">// fourth check the SYN bit</span>
    <span class="comment">//</span>
    <span class="comment">//   This step should be reached only if the ACK is ok, or there is</span>
    <span class="comment">//   no ACK, and it the segment did not contain a RST.</span>
    <span class="comment">//</span>
    <span class="comment">//   If the SYN bit is on and the security/compartment and precedence</span>
    <span class="comment">//   are acceptable then,</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit())
    {
        <span class="comment">//</span>
        <span class="comment">//   RCV.NXT is set to SEG.SEQ+1, IRS is set to</span>
        <span class="comment">//   SEG.SEQ.  SND.UNA should be advanced to equal SEG.ACK (if there</span>
        <span class="comment">//   is an ACK), and any segments on the retransmission queue which</span>
        <span class="comment">//   are thereby acknowledged should be removed.</span>
        <span class="comment">//</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> = tcpseg-&gt;getSequenceNo()+1;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>;
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>) <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3263aa617c113523e9459db081cf3208">irs</a> = tcpseg-&gt;getSequenceNo();
        <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#aa830dbb0737de38e3a564aaa806ea99f">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);

        <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
        {
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = tcpseg-&gt;getAckNo();
            <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#ae04471092e8ddf943c8c938ef1aa9c9f">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
                <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a07b77209c59eb50fce9751418039ed64">discardUpTo</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

            <span class="comment">// although not mentioned in RFC 793, seems like we have to pick up</span>
            <span class="comment">// initial snd_wnd from the segment here.</span>
            <a class="code" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo</a>(tcpseg, <span class="keyword">true</span>);
        }

        <span class="comment">// this also seems to be a good time to learn our local IP address</span>
        <span class="comment">// (was probably unspecified at connection open)</span>
        <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;<a class="code" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">updateSockPair</a>(<span class="keyword">this</span>, destAddr, srcAddr, tcpseg-&gt;getDestPort(), tcpseg-&gt;getSrcPort());

        <span class="comment">//&quot;</span>
        <span class="comment">//   If SND.UNA &gt; ISS (our SYN has been ACKed), change the connection</span>
        <span class="comment">//   state to ESTABLISHED, form an ACK segment</span>
        <span class="comment">//</span>
        <span class="comment">//     &lt;SEQ=SND.NXT&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=ACK&gt;</span>
        <span class="comment">//</span>
        <span class="comment">//   and send it.  Data or controls which were queued for</span>
        <span class="comment">//   transmission may be included.  If there are other controls or</span>
        <span class="comment">//   text in the segment then continue processing at the sixth step</span>
        <span class="comment">//   below where the URG bit is checked, otherwise return.</span>
        <span class="comment">//&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>))
        {
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK bits set, connection established.\n&quot;</span>;

            <span class="comment">// RFC says &quot;continue processing at the sixth step below where</span>
            <span class="comment">// the URG bit is checked&quot;. Those steps deal with: URG, segment text</span>
            <span class="comment">// (and PSH), and FIN.</span>
            <span class="comment">// Now: URG and PSH we don&#39;t support yet; in SYN+FIN we ignore FIN;</span>
            <span class="comment">// with segment text we just take it easy and put it in the receiveQueue</span>
            <span class="comment">// -- we&#39;ll forward it to the user when more data arrives.</span>
            <span class="keywordflow">if</span> (tcpseg-&gt;getFinBit())
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+ACK+FIN received: ignoring FIN\n&quot;</span>;
            <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()&gt;0)
            {
                <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;getPayloadLength()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
                {
                    <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);  <span class="comment">// TBD forward to app, etc.</span>
                }
                <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
                {
                    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
                        <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);

                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
                    <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
                }
            }
            <span class="keywordflow">if</span> (tcpseg-&gt;getUrgBit() || tcpseg-&gt;getPshBit())
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN+ACK\n&quot;</span>; <span class="comment">// TBD</span>

            <span class="keywordflow">if</span> (tcpseg-&gt;getHeaderLength() &gt; TCP_HEADER_OCTETS) <span class="comment">// Header options present? TCP_HEADER_OCTETS = 20</span>
                <a class="code" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions</a>(tcpseg);

            <span class="comment">// notify tcpAlgorithm (it has to send ACK of SYN) and app layer</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ac945d97e6a37246ca8cf3648e01a8a26">ack_now</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a2d051b6a9e2a9fccfa6f8b64bb8c647d">established</a>(<span class="keyword">true</span>);
            <a class="code" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp</a>();

            <span class="comment">// This will trigger transition to ESTABLISHED. Timers and notifying</span>
            <span class="comment">// app will be taken care of in stateEntered().</span>
            <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea8458ff8c0f604c80aa5aa6ee49f850c3">TCP_E_RCV_SYN_ACK</a>;
        }

        <span class="comment">//&quot;</span>
        <span class="comment">//   Otherwise enter SYN-RECEIVED, form a SYN,ACK segment</span>
        <span class="comment">//</span>
        <span class="comment">//     &lt;SEQ=ISS&gt;&lt;ACK=RCV.NXT&gt;&lt;CTL=SYN,ACK&gt;</span>
        <span class="comment">//</span>
        <span class="comment">//   and send it.  If there are other controls or text in the</span>
        <span class="comment">//   segment, queue them for processing after the ESTABLISHED state</span>
        <span class="comment">//   has been reached, return.</span>
        <span class="comment">//&quot;</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN bit set: sending SYN+ACK\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>;
        <a class="code" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck</a>();
        <a class="code" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer</a>();

        <span class="comment">// Note: code below is similar to processing SYN in LISTEN.</span>

        <span class="comment">// For consistency with that code, we ignore SYN+FIN here</span>
        <span class="keywordflow">if</span> (tcpseg-&gt;getFinBit())
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;SYN+FIN received: ignoring FIN\n&quot;</span>;

        <span class="comment">// We don&#39;t send text in SYN or SYN+ACK, but accept it. Otherwise</span>
        <span class="comment">// there isn&#39;t much left to do: RST, SYN, ACK, FIN got processed already,</span>
        <span class="comment">// so there&#39;s only URG and PSH left to handle.</span>
        <span class="keywordflow">if</span> (tcpseg-&gt;getPayloadLength()&gt;0)
        {
            <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> &gt;= tcpseg-&gt;getPayloadLength()) <span class="comment">// enough freeRcvBuffer in rcvQueue for new segment?</span>
            {
                <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ac17c031fdec7aa75b656bf7e742a38d2">insertBytesFromSegment</a>(tcpseg);  <span class="comment">// TBD forward to app, etc.</span>
            }
            <span class="keywordflow">else</span>    <span class="comment">// not enough freeRcvBuffer in rcvQueue for new segment</span>
            {
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>++; <span class="comment">// update current number of tcp receive queue drops</span>
                <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>)
                    <a class="code" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">tcpRcvQueueDropsVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47f5ceae81f976297ea36112eb36c133">tcpRcvQueueDrops</a>);

                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RcvQueueBuffer has run out, dropping segment\n&quot;</span>;
                <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
            }
        }
        <span class="keywordflow">if</span> (tcpseg-&gt;getUrgBit() || tcpseg-&gt;getPshBit())
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Ignoring URG and PSH bits in SYN\n&quot;</span>; <span class="comment">// TBD</span>

        <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea541f61a44292b46f1adaf374e22126a5">TCP_E_RCV_SYN</a>;
    }

    <span class="comment">//&quot;</span>
    <span class="comment">// fifth, if neither of the SYN or RST bits is set then drop the</span>
    <span class="comment">// segment and return.</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">return</span> <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7f5f8ddb99114615c77fe0ccf16424e7"></a><!-- doxytag: member="TCPConnection::processTCPSegment" ref="a7f5f8ddb99114615c77fe0ccf16424e7" args="(TCPSegment *tcpSeg, IPvXAddress srcAddr, IPvXAddress destAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTCPSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpSeg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>srcAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>destAddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process incoming <a class="el" href="class_t_c_p.html">TCP</a> segment. Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="class_t_c_p.html#ae3a05ea5147737dd2889b8afc2647f69">TCP::handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
    {
        ASSERT(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>==segDestAddr);
        ASSERT(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>==tcpseg-&gt;getDestPort());
    }
    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>())
    {
        ASSERT(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>==segSrcAddr);
        ASSERT(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>==tcpseg-&gt;getSrcPort());
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a9b7d3f811eab0367d3826dfb20c8d931">tryFastRoute</a>(tcpseg))
        <span class="keywordflow">return</span> <span class="keyword">true</span>;

    <span class="comment">// first do actions</span>
    <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> <span class="keyword">event</span> = <a class="code" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT</a>(tcpseg, segSrcAddr, segDestAddr);

    <span class="comment">// then state transitions</span>
    <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6f9e1e7a0cabaf710f2d37a19eea0caf"></a><!-- doxytag: member="TCPConnection::processTimer" ref="a6f9e1e7a0cabaf710f2d37a19eea0caf" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTimer </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process self-messages (timers). Normally returns true. A return value of false means that the connection structure must be deleted by the caller (<a class="el" href="class_t_c_p.html">TCP</a>). </p>

<p>Referenced by <a class="el" href="class_t_c_p.html#ae3a05ea5147737dd2889b8afc2647f69">TCP::handleMessage()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief</a>();
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; timer expired\n&quot;</span>;

    <span class="comment">// first do actions</span>
    <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85e">TCPEventCode</a> event;
    <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea46d274b511ccd4b9d9a7eeb8122821c7">TCP_E_TIMEOUT_2MSL</a>;
        <a class="code" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL</a>();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85eadf23ff2e2826987c01e8085ec6a9d869">TCP_E_TIMEOUT_CONN_ESTAB</a>;
        <a class="code" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB</a>();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea364bbb0c5f1f19bf23455be6bef115f9">TCP_E_TIMEOUT_FIN_WAIT_2</a>;
        <a class="code" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2</a>();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msg==<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>)
    {
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
        <a class="code" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT</a>(event);
    }
    <span class="keywordflow">else</span>
    {
        <span class="keyword">event</span> = <a class="code" href="_t_c_p_connection_8h.html#a9187fb8d597fec5e53124ffe46c7e85ea543beef056b1f7e1f0b341f615393f6a">TCP_E_IGNORE</a>;
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#afa586de40374ffd9830981fff79cf96c">processTimer</a>(msg, event);
    }

    <span class="comment">// then state transitions</span>
    <span class="keywordflow">return</span> <a class="code" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition</a>(event);
}
</pre></div>
</div>
</div>
<a class="anchor" id="adc95d91946a80a2ad98b0d0b1e40909e"></a><!-- doxytag: member="TCPConnection::processTSOption" ref="adc95d91946a80a2ad98b0d0b1e40909e" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processTSOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TCPOption &amp;&#160;</td>
          <td class="paramname"><em>option</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (option.getLength() != 10)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: length incorrect\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> ((!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>) ||
        (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> &amp;&amp;
                <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>))
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option TS received, but in unexpected state\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (option.getValuesArraySize() != 2)
    {
        <span class="comment">// since option.getLength() was already checked, this is a programming error not a TCP error</span>
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;TCPOption for TS does not contain the data its getLength() promises&quot;</span>);
    }

    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
    {
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a21ba446400701446863088050d7a6173">rcv_initial_ts</a> = <span class="keyword">true</span>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8c78c2a8ced36433f68e1668e9ac4eaf">ts_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af7b6cdf9719efff842f3b29b7f65e7a0">snd_initial_ts</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a21ba446400701446863088050d7a6173">rcv_initial_ts</a>;
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option TS(TSval=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;, TSecr=&quot;</span> &lt;&lt; option.getValues(1) &lt;&lt; <span class="stringliteral">&quot;) received, TS (ts_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    }
    <span class="keywordflow">else</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option TS(TSval=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;, TSecr=&quot;</span> &lt;&lt; option.getValues(1) &lt;&lt; <span class="stringliteral">&quot;) received\n&quot;</span>;

    <span class="comment">// RFC 1323, page 35:</span>
    <span class="comment">// &quot;Check whether the segment contains a Timestamps option and bit</span>
    <span class="comment">// Snd.TS.OK is on.  If so:</span>
    <span class="comment">//   If SEG.TSval &lt; TS.Recent, then test whether connection has</span>
    <span class="comment">//   been idle less than 24 days; if both are true, then the</span>
    <span class="comment">//   segment is not acceptable; follow steps below for an</span>
    <span class="comment">//   unacceptable segment.</span>
    <span class="comment">//   If SEG.SEQ is equal to Last.ACK.sent, then save SEG.[TSval] in</span>
    <span class="comment">//   variable TS.Recent.&quot;</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
    {
        <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(option.getValues(0), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a>))
        {
            <span class="keywordflow">if</span> ((simTime() - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8ac5ae9db4029d0f8a6cff75297fa2c8">time_last_data_sent</a>) &gt; <a class="code" href="_t_c_p_connection_8h.html#a6d5e1b9a987d5263ed7885c1e13a5dbf">PAWS_IDLE_TIME_THRESH</a>) <span class="comment">// PAWS_IDLE_TIME_THRESH = 24 days</span>
            {
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;PAWS: Segment is not acceptable, TSval=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt;  <a class="code" href="class_t_c_p_connection.html#ab991cf2680a63832310a4a56ac17972e">stateName</a>(<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()) &lt;&lt; <span class="stringliteral">&quot; state received: dropping segment\n&quot;</span>;
                <span class="keywordflow">return</span> <span class="keyword">false</span>;
            }
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(tcpseg-&gt;getSequenceNo(), <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfbcb8fed25793f011ff32a6dc6ee722">last_ack_sent</a>)) <span class="comment">// Note: test is modified according to the latest proposal of the tcplw@cray.com list (Braden 1993/04/26)</span>
        {
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a> = option.getValues(0);
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Updating ts_recent from segment: new ts_recent=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a83bb4cd8bc8912d6bfbf6e7e5b47e4b2"></a><!-- doxytag: member="TCPConnection::processWSOption" ref="a83bb4cd8bc8912d6bfbf6e7e5b47e4b2" args="(TCPSegment *tcpseg, const TCPOption &amp;option)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::processWSOption </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TCPOption &amp;&#160;</td>
          <td class="paramname"><em>option</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a9a8bf987d5f32ecff2b85ba0f635f019">readHeaderOptions()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (option.getLength() != 3)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: length incorrect\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() != <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option WS received, but in unexpected state\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (option.getValuesArraySize() == 0)
    {
        <span class="comment">// since option.getLength() was already checked, this is a programming error not a TCP error</span>
        <span class="keywordflow">throw</span> cRuntimeError(<span class="stringliteral">&quot;TCPOption for WS does not contain the data its getLength() promises&quot;</span>);
    }

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a271f1cd058848cfcc760da1ebe6c6cf7">rcv_ws</a> = <span class="keyword">true</span>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ade9f38cfdc9aece66e374146b6ca2750">snd_ws</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a271f1cd058848cfcc760da1ebe6c6cf7">rcv_ws</a>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa89f35b309ebf448d074aae27f0fbb23">snd_wnd_scale</a> = option.getValues(0);
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option WS(=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa89f35b309ebf448d074aae27f0fbb23">snd_wnd_scale</a> &lt;&lt; <span class="stringliteral">&quot;) received, WS (ws_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa89f35b309ebf448d074aae27f0fbb23">snd_wnd_scale</a> &gt; 14) <span class="comment">// RFC 1323, page 11: &quot;the shift count must be limited to 14&quot;</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: TCP Header Option WS received but shift count value is exceeding 14\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa89f35b309ebf448d074aae27f0fbb23">snd_wnd_scale</a> = 14;
    }
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9a8bf987d5f32ecff2b85ba0f635f019"></a><!-- doxytag: member="TCPConnection::readHeaderOptions" ref="a9a8bf987d5f32ecff2b85ba0f635f019" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::readHeaderOptions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: readHeaderOptions (Currently only EOL, NOP, MSS, WS, SACK_PERMITTED, SACK and TS are implemented) </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, and <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option(s) received:\n&quot;</span>;

    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
    {
        <span class="keyword">const</span> TCPOption&amp; option = tcpseg-&gt;getOptions(i);
        <span class="keywordtype">short</span> kind = option.getKind();
        <span class="keywordtype">short</span> length = option.getLength();
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Option type &quot;</span> &lt;&lt; kind &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#ad7429706bcb29990ebfc65ff24970faa">optionName</a>(kind) &lt;&lt; <span class="stringliteral">&quot;), length &quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
        <span class="keywordflow">switch</span>(kind)
        {
            <span class="keywordflow">case</span> TCPOPTION_END_OF_OPTION_LIST: <span class="comment">// EOL=0</span>
            <span class="keywordflow">case</span> TCPOPTION_NO_OPERATION: <span class="comment">// NOP=1</span>
                <span class="keywordflow">if</span> (length != 1)
                {
                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: option length incorrect\n&quot;</span>;
                    ok = <span class="keyword">false</span>;
                }
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> TCPOPTION_MAXIMUM_SEGMENT_SIZE: <span class="comment">// MSS=2</span>
                ok = <a class="code" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption</a>(tcpseg, option);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> TCPOPTION_WINDOW_SCALE: <span class="comment">// WS=3</span>
                ok = <a class="code" href="class_t_c_p_connection.html#a83bb4cd8bc8912d6bfbf6e7e5b47e4b2">processWSOption</a>(tcpseg, option);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> TCPOPTION_SACK_PERMITTED: <span class="comment">// SACK_PERMITTED=4</span>
                ok = <a class="code" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption</a>(tcpseg, option);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> TCPOPTION_SACK: <span class="comment">// SACK=5</span>
                ok = <a class="code" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption</a>(tcpseg, option);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> TCPOPTION_TIMESTAMP: <span class="comment">// TS=8</span>
                ok = <a class="code" href="class_t_c_p_connection.html#adc95d91946a80a2ad98b0d0b1e40909e">processTSOption</a>(tcpseg, option);
                <span class="keywordflow">break</span>;
            <span class="comment">// TODO add new TCPOptions here once they are implemented</span>
            <span class="comment">// TODO delegate to TCPAlgorithm as well -- it may want to recognized additional options</span>
            <span class="keywordflow">default</span>:
                <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Unsupported TCP option kind &quot;</span> &lt;&lt; kind &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
                <span class="keywordflow">break</span>;
        }
        (void)ok; <span class="comment">// unused</span>
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab2c57b0ff79eb111ca6840b8d7003b04"></a><!-- doxytag: member="TCPConnection::retransmitData" ref="ab2c57b0ff79eb111ca6840b8d7003b04" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit all from snd_una to snd_max </p>

<p>Referenced by <a class="el" href="class_dumb_t_c_p.html#a657167c651630243eec9f6885ce7050b">DumbTCP::processTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// retransmit everything from snd_una</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;

    uint32 bytesToSend = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
    ASSERT(bytesToSend!=0);

    <span class="comment">// TBD - avoid to send more than allowed - check cwnd and rwnd before retransmitting data!</span>
    <span class="keywordflow">while</span> (bytesToSend&gt;0)
    {
        uint32 bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
        bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytes, (uint32)(<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>)));
        <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
        <span class="comment">// Do not send packets after the FIN.</span>
        <span class="comment">// fixes bug that occurs in examples/inet/bulktransfer at event #64043  T=13.861159213744</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1)
            <span class="keywordflow">break</span>;
        bytesToSend -= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ae68910942bd1ea6558ae7849ae22ea"></a><!-- doxytag: member="TCPConnection::retransmitOneSegment" ref="a8ae68910942bd1ea6558ae7849ae22ea" args="(bool called_at_rto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::retransmitOneSegment </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>called_at_rto</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: retransmit one segment from snd_una </p>

<p>Referenced by <a class="el" href="class_t_c_p_tahoe.html#a7e4ea81dbdbfd0eb8321ccf653a6eb00">TCPTahoe::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_reno.html#a8200e1aeef42d932ef24f447beaf25f5">TCPReno::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_no_congestion_control.html#acce4963470b581797181af3f924a6433">TCPNoCongestionControl::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_new_reno.html#a0ccc1ba18d31b873fab51b8e429aaae1">TCPNewReno::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_new_reno.html#a634da20c5ad064882d2c87f6f5ff1301">TCPNewReno::receivedDataAck()</a>, <a class="el" href="class_t_c_p_tahoe.html#a5c9cd2ff02da7ddc8c1578b0e6a81236">TCPTahoe::receivedDuplicateAck()</a>, <a class="el" href="class_t_c_p_reno.html#adcf0d263e1c1551648ff9b52dff8326f">TCPReno::receivedDuplicateAck()</a>, and <a class="el" href="class_t_c_p_new_reno.html#a6ce5b0435826f11b9a459b66d7e8aee8">TCPNewReno::receivedDuplicateAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;

    <span class="comment">// retransmit one segment at snd_una, and set snd_nxt accordingly (if not called at RTO)</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;

    <span class="comment">// When FIN sent the snd_max-snd_nxt larger than bytes available in queue</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>((<a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>)<a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>),
            <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>));

    <span class="comment">// FIN (without user data) needs to be resent</span>
    <span class="keywordflow">if</span> (bytes == 0 &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a> == <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>())
    {
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a1bb1013e8a3df8d76598b1cf3a92246c">getBufferEndSeq</a>();
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;No outstanding DATA, resending FIN, advancing snd_nxt over the FIN\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
        <a class="code" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin</a>();
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = ++<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;

        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
    }
    <span class="keywordflow">else</span>
    {
        ASSERT(bytes != 0);

        <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);

        <span class="keywordflow">if</span> (!called_at_rto)
        {
            <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(old_snd_nxt, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>))
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = old_snd_nxt;
        }

        <span class="comment">// notify</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();

        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
        {
            <span class="comment">// RFC 3517, page 7: &quot;(3) Retransmit the first data segment presumed dropped -- the segment</span>
            <span class="comment">// starting with sequence number HighACK + 1.  To prevent repeated</span>
            <span class="comment">// retransmission of the same data, set HighRxt to the highest</span>
            <span class="comment">// sequence number in the retransmitted segment.&quot;</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a60c9fb67af21fc9c1cee62369a8a1486"></a><!-- doxytag: member="TCPConnection::scheduleTimeout" ref="a60c9fb67af21fc9c1cee62369a8a1486" args="(cMessage *msg, simtime_t timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::scheduleTimeout </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start a timer </p>

<p>Referenced by <a class="el" href="class_dumb_t_c_p.html#a312e0203fada40e843fc3635ff4b1cdf">DumbTCP::dataSent()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_base_alg.html#a69a0d60fa083b9a3b03e8f80d3c53e6f">TCPBaseAlg::processPersistTimer()</a>, <a class="el" href="class_t_c_p_base_alg.html#ac8a305a437d4eafd1689204e50af8870">TCPBaseAlg::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_dumb_t_c_p.html#a657167c651630243eec9f6885ce7050b">DumbTCP::processTimer()</a>, <a class="el" href="class_t_c_p_base_alg.html#a55a32a0e93c6417adb091ee162f225e2">TCPBaseAlg::receivedDataAck()</a>, <a class="el" href="class_t_c_p_base_alg.html#a772c3712679d50b0598957665b14acc9">TCPBaseAlg::receiveSeqChanged()</a>, <a class="el" href="class_t_c_p_base_alg.html#a5fc842a3f9c5297e9ba795843bf0cabb">TCPBaseAlg::startRexmitTimer()</a>, and <a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer()</a>.</p>
<div class="fragment"><pre class="fragment">        {<a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;scheduleAt(simTime()+timeout, msg);}
</pre></div>
</div>
</div>
<a class="anchor" id="a82f6b7680530f0f784e9d8efa78fa5a5"></a><!-- doxytag: member="TCPConnection::segmentArrivalWhileClosed" ref="a82f6b7680530f0f784e9d8efa78fa5a5" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::segmentArrivalWhileClosed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This method gets invoked from <a class="el" href="class_t_c_p.html">TCP</a> when a segment arrives which doesn't belong to an existing connection. <a class="el" href="class_t_c_p.html">TCP</a> creates a temporary connection object so that it can call this method, then immediately deletes it. </p>

<p>Referenced by <a class="el" href="class_t_c_p.html#a0878a06694b0e8e84f4a5cb07555258e">TCP::segmentArrivalWhileClosed()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Seg arrived: &quot;</span>;
    <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);

    <span class="comment">// This segment doesn&#39;t belong to any connection, so this object</span>
    <span class="comment">// must be a temp object created solely for the purpose of calling us</span>
    ASSERT(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>==NULL);
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Segment doesn&#39;t belong to any existing connection\n&quot;</span>;

    <span class="comment">// RFC 793:</span>
    <span class="comment">//&quot;</span>
    <span class="comment">// all data in the incoming segment is discarded.  An incoming</span>
    <span class="comment">// segment containing a RST is discarded.  An incoming segment not</span>
    <span class="comment">// containing a RST causes a RST to be sent in response.  The</span>
    <span class="comment">// acknowledgment and sequence field values are selected to make the</span>
    <span class="comment">// reset sequence acceptable to the TCP that sent the offending</span>
    <span class="comment">// segment.</span>
    <span class="comment">//</span>
    <span class="comment">// If the ACK bit is off, sequence number zero is used,</span>
    <span class="comment">//</span>
    <span class="comment">//    &lt;SEQ=0&gt;&lt;ACK=SEG.SEQ+SEG.LEN&gt;&lt;CTL=RST,ACK&gt;</span>
    <span class="comment">//</span>
    <span class="comment">// If the ACK bit is on,</span>
    <span class="comment">//</span>
    <span class="comment">//    &lt;SEQ=SEG.ACK&gt;&lt;CTL=RST&gt;</span>
    <span class="comment">//&quot;</span>
    <span class="keywordflow">if</span> (tcpseg-&gt;getRstBit())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;RST bit set: dropping segment\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> (!tcpseg-&gt;getAckBit())
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit not set: sending RST+ACK\n&quot;</span>;
        uint32 ackNo = tcpseg-&gt;getSequenceNo() + (uint32)tcpseg-&gt;getPayloadLength();
        <a class="code" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck</a>(0,ackNo,destAddr,srcAddr,tcpseg-&gt;getDestPort(),tcpseg-&gt;getSrcPort());
    }
    <span class="keywordflow">else</span>
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ACK bit set: sending RST\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(tcpseg-&gt;getAckNo(),destAddr,srcAddr,tcpseg-&gt;getDestPort(),tcpseg-&gt;getSrcPort());
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a585bbcdd70565eb01b6bfe17a1487c78"></a><!-- doxytag: member="TCPConnection::selectInitialSeqNum" ref="a585bbcdd70565eb01b6bfe17a1487c78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::selectInitialSeqNum </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: generates ISS and initializes corresponding state variables </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, and <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// set the initial send sequence number</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a> = (<span class="keywordtype">unsigned</span> long)fmod(SIMTIME_DBL(simTime())*250000.0, 1.0+(double)(<span class="keywordtype">unsigned</span>)0xffffffffUL) &amp; 0xffffffffUL;

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>;

    <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a3a426364a7ced17955eb6cc3b3cfac2d">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1); <span class="comment">// +1 is for SYN</span>
    <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a342033845eaaf7a565c82fb70718ca0e">init</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a> + 1); <span class="comment">// +1 is for SYN</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a60ee5bc5b391d621e7e684857e195151"></a><!-- doxytag: member="TCPConnection::sendAck" ref="a60ee5bc5b391d621e7e684857e195151" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendAck </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send ACK </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#a2cbb83fb79f28eaea3d33acb13526e11">TCPBaseAlg::established()</a>, <a class="el" href="class_dumb_t_c_p.html#ac6623697e6ea2a1484c7ebaa71d6d9da">DumbTCP::established()</a>, <a class="el" href="class_t_c_p_base_alg.html#ad5f7c065fdf27a650a7c711cf8e31766">TCPBaseAlg::processDelayedAckTimer()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_base_alg.html#a8d57787d474f4a317bffa76c8f13ef3a">TCPBaseAlg::receivedAckForDataNotYetSent()</a>, <a class="el" href="class_dumb_t_c_p.html#ae41e06b4a200bc5e3f9292cc0bbd20b4">DumbTCP::receivedAckForDataNotYetSent()</a>, <a class="el" href="class_t_c_p_base_alg.html#aa49a6c59e453685907e24dc671e3561d">TCPBaseAlg::receivedOutOfOrderSegment()</a>, <a class="el" href="class_dumb_t_c_p.html#ae4e6d375ffed529764578686e011726a">DumbTCP::receivedOutOfOrderSegment()</a>, <a class="el" href="class_t_c_p_base_alg.html#a772c3712679d50b0598957665b14acc9">TCPBaseAlg::receiveSeqChanged()</a>, and <a class="el" href="class_dumb_t_c_p.html#a2f6cdf0df70da4714fb31c9c0b88d375">DumbTCP::receiveSeqChanged()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;ACK&quot;</span>);

    tcpseg-&gt;setAckBit(<span class="keyword">true</span>);
    tcpseg-&gt;setSequenceNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    tcpseg-&gt;setAckNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
    tcpseg-&gt;setWindow(<a class="code" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a>());

    <span class="comment">// write header options</span>
    <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);

    <span class="comment">// notify</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0238c323366884c6598d7d92d21f69ab"></a><!-- doxytag: member="TCPConnection::sendData" ref="a0238c323366884c6598d7d92d21f69ab" args="(bool fullSegmentsOnly, uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendData </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>congestionWindow</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: Send data from sendQueue, at most congestionWindow. If fullSegmentsOnly is set, don't send segments smaller than SMSS (needed for Nagle). Returns true if some data was actually sent. </p>

<p>Referenced by <a class="el" href="class_dumb_t_c_p.html#ac6623697e6ea2a1484c7ebaa71d6d9da">DumbTCP::established()</a>, <a class="el" href="class_dumb_t_c_p.html#a22dfeeb20cbf6f934bc60dba62d42c10">DumbTCP::receivedDataAck()</a>, <a class="el" href="class_dumb_t_c_p.html#acac9e70114fe2db39931c4c130a81ef2">DumbTCP::sendCommandInvoked()</a>, and <a class="el" href="class_t_c_p_base_alg.html#a28c072f575629d0c5ec6478edd3bb7e5">TCPBaseAlg::sendData()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
    {
        <span class="comment">// we&#39;ll start sending from snd_max</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;
    }

    uint32 old_highRxt = 0;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
        old_highRxt = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();

    <span class="comment">// check how many bytes we have</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    <span class="keywordflow">if</span> (buffered==0)
        <span class="keywordflow">return</span> <span class="keyword">false</span>;

    <span class="comment">// maxWindow is minimum of snd_wnd and congestionWindow (snd_cwnd)</span>
    <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> maxWindow = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>, congestionWindow);

    <span class="comment">// effectiveWindow: number of bytes we&#39;re allowed to send now</span>
    <span class="keywordtype">long</span> effectiveWin = maxWindow - (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);
    <span class="keywordflow">if</span> (effectiveWin &lt;= 0)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Effective window is zero (advertised window &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> &lt;&lt;
            <span class="stringliteral">&quot;, congestion window &quot;</span> &lt;&lt; congestionWindow &lt;&lt; <span class="stringliteral">&quot;), cannot send.\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytesToSend = effectiveWin;

    <span class="keywordflow">if</span> (bytesToSend &gt; buffered)
        bytesToSend = buffered;

    uint32 effectiveMaxBytesSend = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
        effectiveMaxBytesSend -= <a class="code" href="_t_c_p_connection_8h.html#a86574d0dee9bf72a715b4b0a026171d6">TCP_OPTION_TS_SIZE</a>;

    <span class="comment">// last segment could be less than state-&gt;snd_mss (or less than snd_mss-TCP_OPTION_TS_SIZE is using TS option)</span>
    <span class="keywordflow">if</span> (fullSegmentsOnly &amp;&amp; buffered &gt; (<a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>)effectiveWin &amp;&amp;
            (bytesToSend &lt; (effectiveMaxBytesSend)))
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send, not enough data for a full segment (SMSS=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>
            &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    <span class="comment">// start sending &#39;bytesToSend&#39; bytes</span>
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Will send &quot;</span> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes (effectiveWindow &quot;</span> &lt;&lt; effectiveWin
        &lt;&lt; <span class="stringliteral">&quot;, in buffer &quot;</span> &lt;&lt; buffered &lt;&lt; <span class="stringliteral">&quot; bytes)\n&quot;</span>;

    uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
    ASSERT(bytesToSend&gt;0);

<span class="preprocessor">#ifdef TCP_SENDFRAGMENTS  </span><span class="comment">/* normally undefined */</span>
    <span class="comment">// make agressive use of the window until the last byte</span>
    <span class="keywordflow">while</span> (bytesToSend&gt;0)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(bytesToSend, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
        <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);
        bytesToSend -= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;
    }
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="comment">// send &lt;MSS segments only if it&#39;s the only segment we can send now - Note: If bytesToSend=1010, MSS=1012, ts_enabled=true =&gt; we may send 2 segments (1000 payload + optionsHeader and 10 payload + optionsHeader)</span>
    <span class="comment">// FIXME this should probably obey Nagle&#39;s alg -- to be checked</span>
    <span class="keywordflow">if</span> (bytesToSend &lt;= state-&gt;snd_mss)
    {
        <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
        bytesToSend -= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;
    }
    <span class="keywordflow">else</span> <span class="comment">// send whole segments only (nagle_enabled)</span>
    {
        <span class="keywordflow">while</span> (bytesToSend &gt;= effectiveMaxBytesSend)
        {
            <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
            bytesToSend -= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;
        }
    }
    <span class="comment">// check how many bytes we have - last segment could be less than state-&gt;snd_mss</span>
    buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    <span class="keywordflow">if</span> (bytesToSend==buffered &amp;&amp; buffered!=0) <span class="comment">// last segment?</span>
        <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytesToSend);
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bytesToSend&gt;0)
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; bytesToSend &lt;&lt; <span class="stringliteral">&quot; bytes of space left in effectiveWindow\n&quot;</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
    <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
    <span class="comment">// but we&#39;ll need snd_max to check validity of ACKs -- they must ack</span>
    <span class="comment">// something we really sent)</span>
    <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

    <span class="comment">// notify (once is enough)</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a> &amp;&amp; old_highRxt != <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>)
    {
        <span class="comment">// Note: Restart of REXMIT timer on retransmission is not part of RFC 2581, however optional in RFC 3517 if sent during recovery.</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission sent during recovery, restarting REXMIT timer.\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
    }
    <span class="keywordflow">else</span> <span class="comment">// don&#39;t measure RTT for retransmitted packets</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4fb6aaf244a5da2eaa02af271099a06b"></a><!-- doxytag: member="TCPConnection::sendDataDuringLossRecoveryPhase" ref="a4fb6aaf244a5da2eaa02af271099a06b" args="(uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendDataDuringLossRecoveryPhase </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>congestionWindow</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send data during Loss Recovery phase (if SACK is enabled). </p>

<p>Referenced by <a class="el" href="class_t_c_p_reno.html#a346296d9fcd3056d1add56d2f03dd391">TCPReno::receivedDataAck()</a>, and <a class="el" href="class_t_c_p_reno.html#adcf0d263e1c1551648ff9b52dff8326f">TCPReno::receivedDuplicateAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a>);
    <span class="comment">// RFC 3517 pages 7 and 8: &quot;(5) In order to take advantage of potential additional available</span>
    <span class="comment">// cwnd, proceed to step (C) below.</span>
    <span class="comment">// (...)</span>
    <span class="comment">// (C) If cwnd - pipe &gt;= 1 SMSS the sender SHOULD transmit one or more</span>
    <span class="comment">// segments as follows:</span>
    <span class="comment">// (...)</span>
    <span class="comment">// (C.5) If cwnd - pipe &gt;= 1 SMSS, return to (C.1)&quot;</span>
    <span class="keywordflow">while</span> (((<span class="keywordtype">int</span>)congestionWindow - (<span class="keywordtype">int</span>)<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>) &gt;= (<span class="keywordtype">int</span>)<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>) <span class="comment">// Note: Typecast needed to avoid prohibited transmissions</span>
    {
        <span class="comment">// RFC 3517 pages 7 and 8: &quot;(C.1) The scoreboard MUST be queried via NextSeg () for the</span>
        <span class="comment">// sequence number range of the next segment to transmit (if any),</span>
        <span class="comment">// and the given segment sent.  If NextSeg () returns failure (no</span>
        <span class="comment">// data to send) return without sending anything (i.e., terminate</span>
        <span class="comment">// steps C.1 -- C.5).&quot;</span>
        uint32 seqNum = <a class="code" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg</a>(); <span class="comment">// if nextSeg() returns 0 (=failure): terminate steps C.1 -- C.5</span>
        <span class="keywordflow">if</span> (seqNum != 0)
        {
            <a class="code" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase</a>(seqNum);
            <span class="comment">// RFC 3517 page 8: &quot;(C.4) The estimate of the amount of data outstanding in the</span>
            <span class="comment">// network must be updated by incrementing pipe by the number of</span>
            <span class="comment">// octets transmitted in (C.1).&quot;</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> += <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;
        }
        <span class="keywordflow">else</span> <span class="comment">// nextSeg () returns failure: terminate steps C.1 -- C.5</span>
            <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab04a91abde05d21293c30a78ab968eef"></a><!-- doxytag: member="TCPConnection::sendEstabIndicationToApp" ref="ab04a91abde05d21293c30a78ab968eef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendEstabIndicationToApp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends TCP_I_ESTABLISHED indication with TCPConnectInfo to application </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, and <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(TCP_I_ESTABLISHED) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(TCP_I_ESTABLISHED));
    msg-&gt;setKind(TCP_I_ESTABLISHED);

    TCPConnectInfo *ind = <span class="keyword">new</span> TCPConnectInfo();
    ind-&gt;setConnId(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
    ind-&gt;setLocalAddr(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>);
    ind-&gt;setRemoteAddr(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>);
    ind-&gt;setLocalPort(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
    ind-&gt;setRemotePort(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);

    msg-&gt;setControlInfo(ind);
    <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a70acf513d8461c73bfd06037036b1682"></a><!-- doxytag: member="TCPConnection::sendFin" ref="a70acf513d8461c73bfd06037036b1682" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendFin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends FIN </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, and <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;FIN&quot;</span>);

    <span class="comment">// Note: ACK bit *must* be set for both FIN and FIN+ACK. What makes</span>
    <span class="comment">// the difference for FIN+ACK is that its ackNo acks the remote TCP&#39;s FIN.</span>
    tcpseg-&gt;setFinBit(<span class="keyword">true</span>);
    tcpseg-&gt;setAckBit(<span class="keyword">true</span>);
    tcpseg-&gt;setAckNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
    tcpseg-&gt;setSequenceNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    tcpseg-&gt;setWindow(<a class="code" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a>());

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);

    <span class="comment">// notify</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a65a8dc93c08a685f145248d0fb327428"></a><!-- doxytag: member="TCPConnection::sendIndicationToApp" ref="a65a8dc93c08a685f145248d0fb327428" args="(int code)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendIndicationToApp </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>code</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends status indication (TCP_I_xxx) to application </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, and <a class="el" href="class_t_c_p_connection.html#a264eb196b44591ed68422a9e70dab680">signalConnectionTimeout()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Notifying app: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    cMessage *msg = <span class="keyword">new</span> cMessage(<a class="code" href="class_t_c_p_connection.html#adeef1c0b8f04a744168a107f68c397ba">indicationName</a>(code));
    msg-&gt;setKind(code);
    TCPCommand *ind = <span class="keyword">new</span> TCPCommand();
    ind-&gt;setConnId(<a class="code" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">connId</a>);
    msg-&gt;setControlInfo(ind);
    <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35768c6517e5f25424a13d1e80892b32"></a><!-- doxytag: member="TCPConnection::sendOneNewSegment" ref="a35768c6517e5f25424a13d1e80892b32" args="(bool fullSegmentsOnly, uint32 congestionWindow)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendOneNewSegment </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fullSegmentsOnly</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>congestionWindow</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send one new segment from snd_max if allowed (RFC 3042). </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#ad198abc5a259c9b1660ec149aae3b11d">TCPBaseAlg::receivedDuplicateAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a406b24dd2a997eae7618c762dfe2e48d">limited_transmit_enabled</a>);
    <span class="comment">// RFC 3042, page 3:</span>
    <span class="comment">// &quot;When a TCP sender has previously unsent data queued for transmission</span>
    <span class="comment">// it SHOULD use the Limited Transmit algorithm, which calls for a TCP</span>
    <span class="comment">// sender to transmit new data upon the arrival of the first two</span>
    <span class="comment">// consecutive duplicate ACKs when the following conditions are</span>
    <span class="comment">// satisfied:</span>
    <span class="comment">//</span>
    <span class="comment">//  * The receiver&#39;s advertised window allows the transmission of the</span>
    <span class="comment">//  segment.</span>
    <span class="comment">//</span>
    <span class="comment">//  * The amount of outstanding data would remain less than or equal</span>
    <span class="comment">//  to the congestion window plus 2 segments.  In other words, the</span>
    <span class="comment">//  sender can only send two segments beyond the congestion window</span>
    <span class="comment">//  (cwnd).</span>
    <span class="comment">//</span>
    <span class="comment">// The congestion window (cwnd) MUST NOT be changed when these new</span>
    <span class="comment">// segments are transmitted.  Assuming that these new segments and the</span>
    <span class="comment">// corresponding ACKs are not dropped, this procedure allows the sender</span>
    <span class="comment">// to infer loss using the standard Fast Retransmit threshold of three</span>
    <span class="comment">// duplicate ACKs [RFC2581].  This is more robust to reordered packets</span>
    <span class="comment">// than if an old packet were retransmitted on the first or second</span>
    <span class="comment">// duplicate ACK.</span>
    <span class="comment">//</span>
    <span class="comment">// Note: If the connection is using selective acknowledgments [RFC2018],</span>
    <span class="comment">// the data sender MUST NOT send new segments in response to duplicate</span>
    <span class="comment">// ACKs that contain no new SACK information, as a misbehaving receiver</span>
    <span class="comment">// can generate such ACKs to trigger inappropriate transmission of data</span>
    <span class="comment">// segments.  See [SCWA99] for a discussion of attacks by misbehaving</span>
    <span class="comment">// receivers.&quot;</span>
    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> || (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#afc44bbf1e92ac47b7ef4ed4158af9a64">sackedBytes_old</a>!=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a22c51e4c43cf036417d95e3584a616ad">sackedBytes</a>))
    {
        <span class="comment">// check how many bytes we have</span>
        <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>);

        <span class="keywordflow">if</span> (buffered &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> || (!fullSegmentsOnly &amp;&amp; buffered &gt; 0))
        {
            <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> outstandingData = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>;
            <span class="comment">// check conditions from RFC 3042</span>
            <span class="keywordflow">if</span> (outstandingData + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> &amp;&amp;
                outstandingData + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;= congestionWindow + 2*<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
            {
                uint32 effectiveWin = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>, congestionWindow) - outstandingData + 2*<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>; <span class="comment">// RFC 3042, page 3: &quot;(...)the sender can only send two segments beyond the congestion window (cwnd).&quot;</span>
                <span class="comment">// bytes: number of bytes we&#39;re allowed to send now</span>
                uint32 bytes = <a class="code" href="_s_c_t_p_association_8h.html#ad61931b1ae6b8e5bb714e2e6744f4470">std::min</a>(effectiveWin, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
                <span class="keywordflow">if</span> (bytes &gt;= <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> || (!fullSegmentsOnly &amp;&amp; bytes &gt; 0))
                {
                    uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
                    <span class="comment">// we&#39;ll start sending from snd_max</span>
                    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;

                    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Limited Transmit algorithm enabled. Sending one new segment.\n&quot;</span>;
                    <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(bytes);

                    <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a459ac205bbda777389c12b7353227fbe">seqGreater</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;

                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>)
                        <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

                    <span class="comment">// reset snd_nxt if needed</span>
                    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
                        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = old_snd_nxt + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;

                    <span class="comment">// notify</span>
                    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
                    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab07a8b0ce79c80e9baf75c3e82f56937"></a><!-- doxytag: member="TCPConnection::sendProbe" ref="ab07a8b0ce79c80e9baf75c3e82f56937" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::sendProbe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends 1 bytes as "probe", called by the "persist" mechanism </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#a69a0d60fa083b9a3b03e8f80d3c53e6f">TCPBaseAlg::processPersistTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// we&#39;ll start sending from snd_max</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>;

    <span class="comment">// check we have 1 byte to send</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>)==0)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Cannot send probe because send buffer is empty\n&quot;</span>;
        <span class="keywordflow">return</span> <span class="keyword">false</span>;
    }

    uint32 old_snd_nxt = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;

    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending 1 byte as probe, with seq=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(1);

    <span class="comment">// remember highest seq sent (snd_nxt may be set back on retransmission,</span>
    <span class="comment">// but we&#39;ll need snd_max to check validity of ACKs -- they must ack</span>
    <span class="comment">// something we really sent)</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>) <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

    <span class="comment">// notify</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(old_snd_nxt);

    <span class="keywordflow">return</span> <span class="keyword">true</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3dc25263bb2f0b1013ee398c1587b128"></a><!-- doxytag: member="TCPConnection::sendRst" ref="a3dc25263bb2f0b1013ee398c1587b128" args="(uint32 seq, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>destPort</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST; does not use connection state </p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST&quot;</span>);

    tcpseg-&gt;setSrcPort(srcPort);
    tcpseg-&gt;setDestPort(destPort);

    tcpseg-&gt;setRstBit(<span class="keyword">true</span>);
    tcpseg-&gt;setSequenceNo(seq);

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);
}
</pre></div>
</div>
</div>
<a class="anchor" id="afa03f88fc4589249aefe6f828eed9dd6"></a><!-- doxytag: member="TCPConnection::sendRst" ref="afa03f88fc4589249aefe6f828eed9dd6" args="(uint32 seqNo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRst </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>seqNo</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, and <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst</a>(seqNo, <a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>, <a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>, <a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>, <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade3c9c38be0aa758b4eb448d5c1169b9"></a><!-- doxytag: member="TCPConnection::sendRstAck" ref="ade3c9c38be0aa758b4eb448d5c1169b9" args="(uint32 seq, uint32 ack, IPvXAddress src, IPvXAddress dest, int srcPort, int destPort)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendRstAck </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>ack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>srcPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>destPort</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends RST+ACK; does not use connection state </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;RST+ACK&quot;</span>);

    tcpseg-&gt;setSrcPort(srcPort);
    tcpseg-&gt;setDestPort(destPort);

    tcpseg-&gt;setRstBit(<span class="keyword">true</span>);
    tcpseg-&gt;setAckBit(<span class="keyword">true</span>);
    tcpseg-&gt;setSequenceNo(seq);
    tcpseg-&gt;setAckNo(ack);

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg, src, dest);

    <span class="comment">// notify</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af71155c4fad49ea52907d840463a06d5"></a><!-- doxytag: member="TCPConnection::sendSegment" ref="af71155c4fad49ea52907d840463a06d5" args="(uint32 bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSegment </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>bytes</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends one segment of 'bytes' bytes from snd_nxt, and advances snd_nxt. <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a> and <a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a> internally all rely on this one. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a>, and <a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a>)
    {
        <span class="comment">// check rexmitQ and try to forward snd_nxt before sending new data</span>
        uint32 forward = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a8c83d42828fe0c5477981025d6d105fb">checkRexmitQueueForSackedOrRexmittedSegments</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> + forward;
    }

    <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buffered = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a4ebfb56b4bf92aaa69c7092d46e01013">getBytesAvailable</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>);
    <span class="keywordflow">if</span> (bytes &gt; buffered) <span class="comment">// last segment?</span>
        bytes = buffered;

    <span class="comment">// if header options will be added, this could reduce the number of data bytes allowed for this segment,</span>
    <span class="comment">// because following condition must to be respected:</span>
    <span class="comment">//     bytes + options_len &lt;= snd_mss</span>
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg_temp = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(NULL);
    tcpseg_temp-&gt;setAckBit(<span class="keyword">true</span>); <span class="comment">// needed for TS option, otherwise TSecr will be set to 0</span>
    <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg_temp);
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> options_len = tcpseg_temp-&gt;getHeaderLength() - TCP_HEADER_OCTETS; <span class="comment">// TCP_HEADER_OCTETS = 20</span>
    <span class="keywordflow">while</span> (bytes + options_len &gt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>)
        bytes--;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a> = bytes;

    <span class="comment">// send one segment of &#39;bytes&#39; bytes from snd_nxt, and advance snd_nxt</span>
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">sendQueue</a>-&gt;<a class="code" href="class_t_c_p_send_queue.html#a46bb6f0e35b67b91e2d3da32ccf07b00">createSegmentWithBytes</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, bytes);

    <span class="comment">// if sack_enabled copy region of tcpseg to rexmitQueue</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>)
        <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a6eb4b2c4417dfff97a1734c9a43fca76">enqueueSentData</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>+bytes);

    tcpseg-&gt;setAckNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
    tcpseg-&gt;setAckBit(<span class="keyword">true</span>);
    tcpseg-&gt;setWindow(<a class="code" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a>());

    <span class="comment">// TBD when to set PSH bit?</span>
    <span class="comment">// TBD set URG bit if needed</span>
    ASSERT(bytes==tcpseg-&gt;getPayloadLength());

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> += bytes;

    <span class="comment">// check if afterRto bit can be reset</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a> &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>))
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abff94bf9ec66bdbde487a74849de721e">afterRto</a> = <span class="keyword">false</span>;

    if (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0401bd2db76f20ea6141550db9ae4d61">send_fin</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a>==<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>)
    {
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Setting FIN on segment\n&quot;</span>;
        tcpseg-&gt;setFinBit(<span class="keyword">true</span>);
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a20daa063530e578155124d9f9e4626f0">snd_fin_seq</a>+1;
    }

    <span class="comment">// add header options and update header length (from tcpseg_temp)</span>
    tcpseg-&gt;setOptionsArraySize(tcpseg_temp-&gt;getOptionsArraySize());
    <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg_temp-&gt;getOptionsArraySize(); i++)
        tcpseg-&gt;setOptions(i, tcpseg_temp-&gt;getOptions(i));
    tcpseg-&gt;setHeaderLength(tcpseg_temp-&gt;getHeaderLength());
    <span class="keyword">delete</span> tcpseg_temp;

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac922b39992f510ef7803067e675d80f1"></a><!-- doxytag: member="TCPConnection::sendSegmentDuringLossRecoveryPhase" ref="ac922b39992f510ef7803067e675d80f1" args="(uint32 seqNum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSegmentDuringLossRecoveryPhase </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>seqNum</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send segment during Loss Recovery phase (if SACK is enabled). </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a4fb6aaf244a5da2eaa02af271099a06b">sendDataDuringLossRecoveryPhase()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a69fd5385780f1352abd11bbbc2c2c2ef">lossRecovery</a>);
    <span class="comment">// start sending from seqNum</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = seqNum;

    uint32 old_highRxt = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();

    <span class="comment">// no need to check cwnd and rwnd - has already be done before</span>
    <span class="comment">// no need to check nagle - sending mss bytes</span>
    <a class="code" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);

    uint32 sentSeqNum = seqNum + <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a>;

    <span class="comment">// RFC 3517 page 8: &quot;(C.2) If any of the data octets sent in (C.1) are below HighData,</span>
    <span class="comment">// HighRxt MUST be set to the highest sequence number of the</span>
    <span class="comment">// retransmitted segment.&quot;</span>
    <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(sentSeqNum, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)) <span class="comment">// HighData = snd_max</span>
    {
        ASSERT (sentSeqNum==<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>());
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
    }
    <span class="comment">// RFC 3517 page 8: &quot;(C.3) If any of the data octets sent in (C.1) are above HighData,</span>
    <span class="comment">// HighData must be updated to reflect the transmission of</span>
    <span class="comment">// previously unsent data.&quot;</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(sentSeqNum, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a>)) <span class="comment">// HighData = snd_max</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = sentSeqNum;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>)
        <a class="code" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">unackedVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>);

    <span class="comment">// RFC 3517, page 9: &quot;6   Managing the RTO Timer</span>
    <span class="comment">//</span>
    <span class="comment">// The standard TCP RTO estimator is defined in [RFC2988].  Due to the</span>
    <span class="comment">// fact that the SACK algorithm in this document can have an impact on</span>
    <span class="comment">// the behavior of the estimator, implementers may wish to consider how</span>
    <span class="comment">// the timer is managed.  [RFC2988] calls for the RTO timer to be</span>
    <span class="comment">// re-armed each time an ACK arrives that advances the cumulative ACK</span>
    <span class="comment">// point.  Because the algorithm presented in this document can keep the</span>
    <span class="comment">// ACK clock going through a fairly significant loss event,</span>
    <span class="comment">// (comparatively longer than the algorithm described in [RFC2581]), on</span>
    <span class="comment">// some networks the loss event could last longer than the RTO.  In this</span>
    <span class="comment">// case the RTO timer would expire prematurely and a segment that need</span>
    <span class="comment">// not be retransmitted would be resent.</span>
    <span class="comment">//</span>
    <span class="comment">// Therefore we give implementers the latitude to use the standard</span>
    <span class="comment">// [RFC2988] style RTO management or, optionally, a more careful variant</span>
    <span class="comment">// that re-arms the RTO timer on each retransmission that is sent during</span>
    <span class="comment">// recovery MAY be used.  This provides a more conservative timer than</span>
    <span class="comment">// specified in [RFC2988], and so may not always be an attractive</span>
    <span class="comment">// alternative.  However, in some cases it may prevent needless</span>
    <span class="comment">// retransmissions, go-back-N transmission and further reduction of the</span>
    <span class="comment">// congestion window.&quot;</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
    <span class="keywordflow">if</span> (old_highRxt != <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>)
    {
        <span class="comment">// Note: Restart of REXMIT timer on retransmission is not part of RFC 2581, however optional in RFC 3517 if sent during recovery.</span>
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Retransmission sent during recovery, restarting REXMIT timer.\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a3369b0b0441f0d5a5400b95f7bbe1f22">restartRexmitTimer</a>();
    }
    <span class="keywordflow">else</span> <span class="comment">// don&#39;t measure RTT for retransmitted packets</span>
        <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#aab20913df04bb33389d7949a502ae0d6">dataSent</a>(seqNum); <span class="comment">// seqNum = old_snd_nxt</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="abcd8f7efecc7c0077050184d3384b493"></a><!-- doxytag: member="TCPConnection::sendSyn" ref="abcd8f7efecc7c0077050184d3384b493" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSyn </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, and <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#aa3534408a9aa5e4cb3fc141597d0ed1e">isUnspecified</a>() || <a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>==-1)
        opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: foreign socket unspecified&quot;</span>);
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>==-1)
        opp_error(<span class="stringliteral">&quot;Error processing command OPEN_ACTIVE: local port unspecified&quot;</span>);

    <span class="comment">// create segment</span>
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN&quot;</span>);
    tcpseg-&gt;setSequenceNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
    tcpseg-&gt;setSynBit(<span class="keyword">true</span>);
    <a class="code" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a>();
    tcpseg-&gt;setWindow(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1;

    <span class="comment">// write header options</span>
    <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a675b131a43de7429552a574cabcc12dd"></a><!-- doxytag: member="TCPConnection::sendSynAck" ref="a675b131a43de7429552a574cabcc12dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendSynAck </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send SYN+ACK </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, and <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// create segment</span>
    <a class="code" href="class_t_c_p_segment.html">TCPSegment</a> *tcpseg = <a class="code" href="class_t_c_p_connection.html#a462206e0bc50ae521a47a797552a0057">createTCPSegment</a>(<span class="stringliteral">&quot;SYN+ACK&quot;</span>);
    tcpseg-&gt;setSequenceNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>);
    tcpseg-&gt;setAckNo(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>);
    tcpseg-&gt;setSynBit(<span class="keyword">true</span>);
    tcpseg-&gt;setAckBit(<span class="keyword">true</span>);
    <a class="code" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd</a>();
    tcpseg-&gt;setWindow(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a220683addcd800e00fc59f348b40cff2">snd_max</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8bd36330faab4393bbb4c56e89d140a1">snd_nxt</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a68394945e99768afc131310ce6a37ea1">iss</a>+1;

    <span class="comment">// write header options</span>
    <a class="code" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions</a>(tcpseg);

    <span class="comment">// send it</span>
    <a class="code" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP</a>(tcpseg);

    <span class="comment">// notify</span>
    <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#ab60e458026100386119cc556ab856462">ackSent</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6aa48826843116a0f5c4e0fa37a69cfc"></a><!-- doxytag: member="TCPConnection::sendToApp" ref="a6aa48826843116a0f5c4e0fa37a69cfc" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToApp </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: sends packet to application </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, and <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(msg, <span class="stringliteral">&quot;appOut&quot;</span>, <a class="code" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">appGateIndex</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8763146770969da7d0a1196efe23615c"></a><!-- doxytag: member="TCPConnection::sendToIP" ref="a8763146770969da7d0a1196efe23615c" args="(TCPSegment *tcpseg, IPvXAddress src, IPvXAddress dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a>&#160;</td>
          <td class="paramname"><em>dest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: send <a class="el" href="class_i_p.html">IP</a> packet </p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
    <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);

    <span class="keywordflow">if</span> (!dest.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
    {
        <span class="comment">// send over IPv4</span>
        <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
        controlInfo-&gt;setProtocol(IP_PROT_TCP);
        controlInfo-&gt;setSrcAddr(src.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
        controlInfo-&gt;setDestAddr(dest.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
        tcpseg-&gt;setControlInfo(controlInfo);

        check_and_cast&lt;<a class="code" href="class_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// send over IPv6</span>
        <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
        controlInfo-&gt;setProtocol(IP_PROT_TCP);
        controlInfo-&gt;setSrcAddr(src.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
        controlInfo-&gt;setDestAddr(dest.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
        tcpseg-&gt;setControlInfo(controlInfo);

        check_and_cast&lt;<a class="code" href="class_t_c_p.html">TCP</a> *&gt;(simulation.getContextModule())-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a86143cf35f957006c5fe17c506be21c7"></a><!-- doxytag: member="TCPConnection::sendToIP" ref="a86143cf35f957006c5fe17c506be21c7" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::sendToIP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: adds control info to segment and sends it to <a class="el" href="class_i_p.html">IP</a> </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin()</a>, <a class="el" href="class_t_c_p_connection.html#a3dc25263bb2f0b1013ee398c1587b128">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, and <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// record seq (only if we do send data) and ackno</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a> &amp;&amp; tcpseg-&gt;getPayloadLength()!=0)
        <a class="code" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">sndNxtVector</a>-&gt;record(tcpseg-&gt;getSequenceNo());
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>)
        <a class="code" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">sndAckVector</a>-&gt;record(tcpseg-&gt;getAckNo());

    <span class="comment">// final touches on the segment before sending</span>
    tcpseg-&gt;setSrcPort(<a class="code" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">localPort</a>);
    tcpseg-&gt;setDestPort(<a class="code" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">remotePort</a>);
    ASSERT(tcpseg-&gt;getHeaderLength() &gt;= TCP_HEADER_OCTETS);     <span class="comment">// TCP_HEADER_OCTETS = 20 (without options)</span>
    ASSERT(tcpseg-&gt;getHeaderLength() &lt;= TCP_MAX_HEADER_OCTETS); <span class="comment">// TCP_MAX_HEADER_OCTETS = 60</span>
    tcpseg-&gt;setByteLength(tcpseg-&gt;getHeaderLength() + tcpseg-&gt;getPayloadLength());
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a319733e0192979a4c2f77ae6b8b1ef33">sentBytes</a> = tcpseg-&gt;getPayloadLength(); <span class="comment">// resetting sentBytes to 0 if sending a segment without data (e.g. ACK)</span>

    <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Sending: &quot;</span>;
    <a class="code" href="class_t_c_p_connection.html#a188549e7c936c8cad622c180d3200c69">printSegmentBrief</a>(tcpseg);

    <span class="comment">// TBD reuse next function for sending</span>

    <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a43ef7d0a976817991cfd41d09435225d">isIPv6</a>())
    {
        <span class="comment">// send over IPv4</span>
        <a class="code" href="class_i_p_control_info.html">IPControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_p_control_info.html">IPControlInfo</a>();
        controlInfo-&gt;setProtocol(IP_PROT_TCP);
        controlInfo-&gt;setSrcAddr(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
        controlInfo-&gt;setDestAddr(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a00acd2be0fc0f254afb2eb7540a4ea6e">get4</a>());
        tcpseg-&gt;setControlInfo(controlInfo);

        <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipOut&quot;</span>);
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// send over IPv6</span>
        <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a> *controlInfo = <span class="keyword">new</span> <a class="code" href="class_i_pv6_control_info.html">IPv6ControlInfo</a>();
        controlInfo-&gt;setProtocol(IP_PROT_TCP);
        controlInfo-&gt;setSrcAddr(<a class="code" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">localAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
        controlInfo-&gt;setDestAddr(<a class="code" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">remoteAddr</a>.<a class="code" href="class_i_pv_x_address.html#a733678e1e28f88c954cfce854af576c6">get6</a>());
        tcpseg-&gt;setControlInfo(controlInfo);

        <a class="code" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">tcpMain</a>-&gt;send(tcpseg,<span class="stringliteral">&quot;ipv6Out&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a728bea28fa24566bb22935f0de7c4655"></a><!-- doxytag: member="TCPConnection::setPipe" ref="a728bea28fa24566bb22935f0de7c4655" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::setPipe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>For SACK <a class="el" href="class_t_c_p.html">TCP</a>. RFC 3517, page 3: "This routine traverses the sequence
 space from HighACK to HighData and MUST set the "pipe" variable to an estimate of the number of octets that are currently in transit between the <a class="el" href="class_t_c_p.html">TCP</a> sender and the <a class="el" href="class_t_c_p.html">TCP</a> receiver." </p>

<p>Referenced by <a class="el" href="class_t_c_p_reno.html#a346296d9fcd3056d1add56d2f03dd391">TCPReno::receivedDataAck()</a>, and <a class="el" href="class_t_c_p_reno.html#adcf0d263e1c1551648ff9b52dff8326f">TCPReno::receivedDuplicateAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    ASSERT (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a>);
    <span class="comment">// RFC 3517, pages 1 and 2: &quot;</span>
    <span class="comment">// &quot;HighACK&quot; is the sequence number of the highest byte of data that</span>
    <span class="comment">// has been cumulatively ACKed at a given point.</span>
    <span class="comment">//</span>
    <span class="comment">// &quot;HighData&quot; is the highest sequence number transmitted at a given</span>
    <span class="comment">// point.</span>
    <span class="comment">//</span>
    <span class="comment">// &quot;HighRxt&quot; is the highest sequence number which has been</span>
    <span class="comment">// retransmitted during the current loss recovery phase.</span>
    <span class="comment">//</span>
    <span class="comment">// &quot;Pipe&quot; is a sender&#39;s estimate of the number of bytes outstanding</span>
    <span class="comment">// in the network.  This is used during recovery for limiting the</span>
    <span class="comment">// sender&#39;s sending rate.  The pipe variable allows TCP to use a</span>
    <span class="comment">// fundamentally different congestion control than specified in</span>
    <span class="comment">// [RFC2581].  The algorithm is often referred to as the &quot;pipe</span>
    <span class="comment">// algorithm&quot;.&quot;</span>
    <span class="comment">// HighAck = snd_una</span>
    <span class="comment">// HighData = snd_max</span>

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a> = <a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#a375f04cfa1ff9d8f044864332cc2fbaf">getHighestRexmittedSeqNum</a>();
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> = 0;

    uint32 shift = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>)
        shift -= <a class="code" href="_t_c_p_connection_8h.html#a86574d0dee9bf72a715b4b0a026171d6">TCP_OPTION_TS_SIZE</a>;

    <span class="comment">// RFC 3517, page 3: &quot;This routine traverses the sequence space from HighACK to HighData</span>
    <span class="comment">// and MUST set the &quot;pipe&quot; variable to an estimate of the number of</span>
    <span class="comment">// octets that are currently in transit between the TCP sender and</span>
    <span class="comment">// the TCP receiver.  After initializing pipe to zero the following</span>
    <span class="comment">// steps are taken for each octet &#39;S1&#39; in the sequence space between</span>
    <span class="comment">// HighACK and HighData that has not been SACKed:&quot;</span>
    <span class="keywordflow">for</span> (uint32 s1=<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3a8a7f455c793cf894e22d4d72dbdc93">snd_una</a>; s1&lt;state-&gt;snd_max; s1=s1+shift)
    {
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">rexmitQueue</a>-&gt;<a class="code" href="class_t_c_p_s_a_c_k_rexmit_queue.html#af9d8cbda22d7ae05a8d367d69ec23127">getSackedBit</a>(s1)==<span class="keyword">false</span>)
        {
            <span class="comment">// RFC 3517, page 3: &quot;(a) If IsLost (S1) returns false:</span>
            <span class="comment">//</span>
            <span class="comment">//     Pipe is incremented by 1 octet.</span>
            <span class="comment">//</span>
            <span class="comment">//     The effect of this condition is that pipe is incremented for</span>
            <span class="comment">//     packets that have not been SACKed and have not been determined</span>
            <span class="comment">//     to have been lost (i.e., those segments that are still assumed</span>
            <span class="comment">//     to be in the network).&quot;</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost</a>(s1)==<span class="keyword">false</span>)
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>++;

            <span class="comment">// RFC 3517, pages 3 and 4: &quot;(b) If S1 &lt;= HighRxt:</span>
            <span class="comment">//</span>
            <span class="comment">//     Pipe is incremented by 1 octet.</span>
            <span class="comment">//</span>
            <span class="comment">//     The effect of this condition is that pipe is incremented for</span>
            <span class="comment">//     the retransmission of the octet.</span>
            <span class="comment">//</span>
            <span class="comment">//  Note that octets retransmitted without being considered lost are</span>
            <span class="comment">//  counted twice by the above mechanism.&quot;</span>
            if (<a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(s1,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a9162bd39de68566f78ab0946fac613e4">highRxt</a>))
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>++;
        }
    }

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a> * shift;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>)
        <a class="code" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">pipeVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3c0e8d7110b3fdb2a5d2de5314a2c987">pipe</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a264eb196b44591ed68422a9e70dab680"></a><!-- doxytag: member="TCPConnection::signalConnectionTimeout" ref="a264eb196b44591ed68422a9e70dab680" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::signalConnectionTimeout </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: signal to user that connection timed out </p>

<p>Referenced by <a class="el" href="class_t_c_p_base_alg.html#ac8a305a437d4eafd1689204e50af8870">TCPBaseAlg::processRexmitTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp</a>(TCP_I_TIMED_OUT);
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa58f44bc38ec0af46aca654f9403771f"></a><!-- doxytag: member="TCPConnection::startSynRexmitTimer" ref="aa58f44bc38ec0af46aca654f9403771f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::startSynRexmitTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: start SYN-REXMIT timer </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, and <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a> = 0;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a> = <a class="code" href="_t_c_p_connection_8h.html#a89ce38305130a5021e21134602a88f79">TCP_TIMEOUT_SYN_REXMIT</a>;

    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>-&gt;isScheduled())
        <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
    <a class="code" href="class_t_c_p_connection.html#a60c9fb67af21fc9c1cee62369a8a1486">scheduleTimeout</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a1bad9ac8364085b574ef441748c2e723">syn_rexmit_timeout</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1be68d20f98e68b01ef9267a8dd2088a"></a><!-- doxytag: member="TCPConnection::stateEntered" ref="a1be68d20f98e68b01ef9267a8dd2088a" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::stateEntered </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Perform cleanup necessary when entering a new state, e.g. cancelling timers </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// cancel timers</span>
    <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)
    {
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>:
            <span class="comment">// we&#39;ll never get back to INIT</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>:
            <span class="comment">// we may get back to LISTEN from SYN_RCVD</span>
            ASSERT(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
            <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
            <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>:
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>:
            <span class="comment">// we&#39;re in ESTABLISHED, these timers are no longer needed</span>
            <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
            <span class="keyword">delete</span> <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
            <a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a> = <a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a> = NULL;
            <span class="comment">// TCP_I_ESTAB notification moved inside event processing</span>
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>:
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>:
            <span class="comment">// whether connection setup succeeded (ESTABLISHED) or not (others),</span>
            <span class="comment">// cancel these timers</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
            <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>:
            <span class="comment">// all timers need to be cancelled</span>
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>)   <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">the2MSLTimer</a>);
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">connEstabTimer</a>);
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>)  <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">finWait2Timer</a>);
            <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>) <a class="code" href="class_t_c_p_connection.html#aecded14193441e78c31ca0c635ac19c8">cancelEvent</a>(<a class="code" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">synRexmitTimer</a>);
            <a class="code" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">tcpAlgorithm</a>-&gt;<a class="code" href="class_t_c_p_algorithm.html#a8f85fd7e065ed30ddaa1e741781130ae">connectionClosed</a>();
            <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab991cf2680a63832310a4a56ac17972e"></a><!-- doxytag: member="TCPConnection::stateName" ref="ab991cf2680a63832310a4a56ac17972e" args="(int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * TCPConnection::stateName </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: returns name of TCP_S_xxx constants </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL()</a>, <a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, and <a class="el" href="class_t_c_p_connection.html#adc95d91946a80a2ad98b0d0b1e40909e">processTSOption()</a>.</p>
<div class="fragment"><pre class="fragment">{
<span class="preprocessor">#define CASE(x) case x: s=#x+6; break</span>
<span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <span class="stringliteral">&quot;unknown&quot;</span>;
    <span class="keywordflow">switch</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>)
    {
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab99a253ee625d2133ac5db0e7deb7429">TCP_S_CLOSED</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca077a72ba910cb22c3a4139dd0a4c3107">TCP_S_CLOSE_WAIT</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecab44fe111730bbb0c24e5bc652659fff7">TCP_S_LAST_ACK</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecac43577621e6bf197109353b11babacd1">TCP_S_CLOSING</a>);
        <a class="code" href="_ether_m_a_c_8cc.html#a60cc06bef97da802b8522d258ac4fe89">CASE</a>(<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecae102ae04107468f65ed2c9d80bc50997">TCP_S_TIME_WAIT</a>);
    }
    <span class="keywordflow">return</span> s;
<span class="preprocessor">#undef CASE</span>
<span class="preprocessor"></span>}
</pre></div>
</div>
</div>
<a class="anchor" id="a9b7d3f811eab0367d3826dfb20c8d931"></a><!-- doxytag: member="TCPConnection::tryFastRoute" ref="a9b7d3f811eab0367d3826dfb20c8d931" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TCPConnection::tryFastRoute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Shortcut to process most common case as fast as possible. Returns false if segment requires normal (slow) route. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// fast route processing not yet implemented</span>
    <span class="keywordflow">return</span> <span class="keyword">false</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae25d720620d8fe927087e1af0692ed90"></a><!-- doxytag: member="TCPConnection::updateRcvQueueVars" ref="ae25d720620d8fe927087e1af0692ed90" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::updateRcvQueueVars </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update receiver queue related variables and statistics - called before setting rcv_wnd </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, and <a class="el" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// update receive queue related state variables</span>
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a> = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ad40894bf45a33d6e849d0317765bbaa5">getAmountOfFreeBytes</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a>);
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a>;

    <span class="comment">// update receive queue related statistics</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>)
        <a class="code" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">tcpRcvQueueBytesVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3cb8ed26db2dbc9c3821a199354367ae">usedRcvBuffer</a>);

<span class="comment">//    tcpEV &lt;&lt; &quot;receiveQ: receiveQLength=&quot; &lt;&lt; receiveQueue-&gt;getQueueLength() &lt;&lt; &quot; maxRcvBuffer=&quot; &lt;&lt; state-&gt;maxRcvBuffer &lt;&lt; &quot; usedRcvBuffer=&quot; &lt;&lt; state-&gt;usedRcvBuffer &lt;&lt; &quot; freeRcvBuffer=&quot; &lt;&lt; state-&gt;freeRcvBuffer &lt;&lt; &quot;\n&quot;;</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8e75cb648c459b120d0ab2a8ae1cf74"></a><!-- doxytag: member="TCPConnection::updateRcvWnd" ref="ac8e75cb648c459b120d0ab2a8ae1cf74" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short TCPConnection::updateRcvWnd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update receive window (rcv_wnd), and calculate scaled value if window scaling enabled. Returns the (scaled) receive window size. </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, and <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    uint32 win = 0;

    <span class="comment">// update receive queue related state variables and statistics</span>
    <a class="code" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars</a>();
    win = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a0a9bd82033191de60a5bc5b3915ba8ae">freeRcvBuffer</a>;

    <span class="comment">// Following lines are based on [Stevens, W.R.: TCP/IP Illustrated, Volume 2, pages 878-879]:</span>
    <span class="comment">// Don&#39;t advertise less than one full-sized segment to avoid SWS</span>
    <span class="keywordflow">if</span> (win &lt; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a> / 4) &amp;&amp; win &lt; state-&gt;snd_mss)
        win = 0;

    <span class="comment">// Do not shrink window</span>
    <span class="comment">// (rcv_adv minus rcv_nxt) is the amount of space still available to the sender that was previously advertised</span>
    <span class="keywordflow">if</span> (win &lt; state-&gt;rcv_adv - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>)
        win = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> - <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a>;

    <span class="comment">// Observe upper limit for advertised window on this connection</span>
    <span class="keywordflow">if</span> (win &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> &amp;&amp; !<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a>) <span class="comment">// TCP_MAX_WIN = 65535 (16 bit)</span>
        win = <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a>; <span class="comment">// Note: The window size is limited to a 16 bit value in the TCP header if WINDOW SCALE option (RFC 1323) is not used</span>

    <span class="comment">// Note: The order of the &quot;Do not shrink window&quot; and &quot;Observe upper limit&quot; parts has been changed to the order used in FreeBSD Release 7.1</span>

    <span class="comment">// update rcv_adv if needed</span>
    <span class="keywordflow">if</span> (win &gt; 0 &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#af4745b9cf95eb5b78d8ae6c3c8429cfc">seqGE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + win, <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>))
    {
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5b9de18a3fb71fab5a540f98173b12b1">rcv_nxt</a> + win;
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">rcvAdvVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a3ff9c29dc3db01ad50308f6e0f917cb3">rcv_adv</a>);
    }

    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a> = win;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>)
        <a class="code" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">rcvWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>);

    <span class="comment">// scale rcv_wnd:</span>
    uint32 scaled_rcv_wnd = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aad67fe91f8983d1769877b559a0e9d00">rcv_wnd</a>;
    <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a> = 0;
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a>)
    {
        <span class="keywordflow">while</span> (scaled_rcv_wnd &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a> &lt; 14) <span class="comment">// RFC 1323, page 11: &quot;the shift count must be limited to 14&quot;</span>
        {
            scaled_rcv_wnd = scaled_rcv_wnd &gt;&gt; 1;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a>++;
        }
    }
    ASSERT(scaled_rcv_wnd == (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)scaled_rcv_wnd);
    <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) scaled_rcv_wnd;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af1daa72bce81fcdc2cb7ccb03c134b7b"></a><!-- doxytag: member="TCPConnection::updateWndInfo" ref="af1daa72bce81fcdc2cb7ccb03c134b7b" args="(TCPSegment *tcpseg, bool doAlways=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TCPConnection::updateWndInfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>doAlways</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: update window information (snd_wnd, snd_wl1, snd_wl2) </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, and <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>.</p>
<div class="fragment"><pre class="fragment">{
    uint32 true_window = tcpseg-&gt;getWindow();
    <span class="comment">// RFC 1323, page 10:</span>
    <span class="comment">// &quot;The window field (SEG.WND) in the header of every incoming</span>
    <span class="comment">// segment, with the exception of SYN segments, is left-shifted</span>
    <span class="comment">// by Snd.Wind.Scale bits before updating SND.WND:</span>
    <span class="comment">//    SND.WND = SEG.WND &lt;&lt; Snd.Wind.Scale&quot;</span>
    <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a> &amp;&amp; !tcpseg-&gt;getSynBit())
        true_window = tcpseg-&gt;getWindow() &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa89f35b309ebf448d074aae27f0fbb23">snd_wnd_scale</a>;

    <span class="comment">// Following lines are based on [Stevens, W.R.: TCP/IP Illustrated, Volume 2, page 982]:</span>
    <span class="keywordflow">if</span> (doAlways || (tcpseg-&gt;getAckBit()
        &amp;&amp; (<a class="code" href="_t_c_p_segment_8h.html#aa2e84a0093c6f222b12a4b443c7278eb">seqLess</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a>, tcpseg-&gt;getSequenceNo()) ||
        (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a> == tcpseg-&gt;getSequenceNo() &amp;&amp; <a class="code" href="_t_c_p_segment_8h.html#a55ef269e8ae44948c1d1f1cbe14bc92b">seqLE</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a>, tcpseg-&gt;getAckNo())) ||
        (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a> == tcpseg-&gt;getAckNo() &amp;&amp; true_window &gt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>))))
    {
        <span class="comment">// send window should be updated</span>
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> = true_window;
        <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;Updating send window from segment: new wnd=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ab7f05bfa1049d2d26d5c1f53846c0512">snd_wl1</a> = tcpseg-&gt;getSequenceNo();
        <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a682afef29243955b62b8d963faf83638">snd_wl2</a> = tcpseg-&gt;getAckNo();
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>)
            <a class="code" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">sndWndVector</a>-&gt;record(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aef29087f473f09bfb53eca0f652386d4">snd_wnd</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a617d790b0cf1905e60c226dff8174a23"></a><!-- doxytag: member="TCPConnection::writeHeaderOptions" ref="a617d790b0cf1905e60c226dff8174a23" args="(TCPSegment *tcpseg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> TCPConnection::writeHeaderOptions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_t_c_p_segment.html">TCPSegment</a> *&#160;</td>
          <td class="paramname"><em>tcpseg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Utility: writeHeaderOptions (Currently only EOL, NOP, MSS, WS, SACK_PERMITTED, SACK and TS are implemented) </p>

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, and <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>.</p>
<div class="fragment"><pre class="fragment">{
    TCPOption option;
    <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> t = 0;

    <span class="keywordflow">if</span> (tcpseg-&gt;getSynBit() &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca7f359883afd2bba5873121486706ccab">TCP_S_LISTEN</a> || ((<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a>) &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;0))) <span class="comment">// SYN flag set and connetion in INIT or LISTEN state (or after synRexmit timeout)</span>
    {
        <span class="comment">// MSS header option</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &gt; 0)
        {
            option.setKind(TCPOPTION_MAXIMUM_SEGMENT_SIZE); <span class="comment">// MSS</span>
            option.setLength(4);
            option.setValuesArraySize(1);

            <span class="comment">// Update MSS</span>
            option.setValues(0,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a>);
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option MSS(=&quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a2d9952d560079e7a0cf44f2308ac564f">snd_mss</a> &lt;&lt; <span class="stringliteral">&quot;) sent\n&quot;</span>;
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;
        }

        <span class="comment">// WS header option</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a271f1cd058848cfcc760da1ebe6c6cf7">rcv_ws</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;0)))) <span class="comment">// Is WS supported by host?</span>
        {
            <span class="comment">// 1 padding byte</span>
            option.setKind(TCPOPTION_NO_OPERATION); <span class="comment">// NOP</span>
            option.setLength(1);
            option.setValuesArraySize(0);
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;

            option.setKind(TCPOPTION_WINDOW_SCALE);
            option.setLength(3);
            option.setValuesArraySize(1);

            <span class="comment">// Update WS variables</span>
            <a class="code" href="_i_n_e_t_defs_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> scaled_rcv_wnd = <a class="code" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">receiveQueue</a>-&gt;<a class="code" href="class_t_c_p_receive_queue.html#ad40894bf45a33d6e849d0317765bbaa5">getAmountOfFreeBytes</a>(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af4c6ad2cfc1d77875d1d2e049e77d50d">maxRcvBuffer</a>);
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a> = 0;
            <span class="keywordflow">while</span> (scaled_rcv_wnd &gt; <a class="code" href="_t_c_p_connection_8h.html#a45fb301bd71c5637907f72760c563002">TCP_MAX_WIN</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a> &lt; 14) <span class="comment">// RFC 1323, page 11: &quot;the shift count must be limited to 14&quot;</span>
            {
                scaled_rcv_wnd = scaled_rcv_wnd &gt;&gt; 1;
                <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a>++;
            }
            option.setValues(0,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a760bc11e6b9992af8537c1040bc2f4b9">rcv_wnd_scale</a>); <span class="comment">// rcv_wnd_scale is also set in scaleRcvWnd()</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ade9f38cfdc9aece66e374146b6ca2750">snd_ws</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aeddf7c4d018f595f1f91714bef4f6a91">ws_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ade9f38cfdc9aece66e374146b6ca2750">snd_ws</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a271f1cd058848cfcc760da1ebe6c6cf7">rcv_ws</a>;
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option WS(=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;) sent, WS (ws_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aa7c9e34ce8f44fb9a49691899b02bc1d">ws_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;
        }

        <span class="comment">// SACK_PERMITTED header option</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;0)))) <span class="comment">// Is SACK supported by host?</span>
        {
            <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8c78c2a8ced36433f68e1668e9ac4eaf">ts_support</a>) <span class="comment">// if TS is supported by host, do not add NOPs to this segment</span>
            {
                <span class="comment">// 2 padding bytes</span>
                option.setKind(TCPOPTION_NO_OPERATION); <span class="comment">// NOP</span>
                option.setLength(1);
                option.setValuesArraySize(0);
                tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+2);
                tcpseg-&gt;setOptions(t,option);
                t++;
                tcpseg-&gt;setOptions(t,option);
                t++;
            }

            option.setKind(TCPOPTION_SACK_PERMITTED);
            option.setLength(2);
            option.setValuesArraySize(0);

            <span class="comment">// Update SACK variables</span>
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a5db0ff74ca0d19891ca3c7e02f99d9a0">snd_sack_perm</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abd85c9f0a5e0769ae58e357f11e541fb">rcv_sack_perm</a>;
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option SACK_PERMITTED sent, SACK (sack_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;
        }

        <span class="comment">// TS header option</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8c78c2a8ced36433f68e1668e9ac4eaf">ts_support</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a21ba446400701446863088050d7a6173">rcv_initial_ts</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState() == <a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca857f320749c4757dceed359145658eff">TCP_S_INIT</a> || (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#abfce4d61e489f5c73d2f73aa072814e6">syn_rexmit_count</a>&gt;0)))) <span class="comment">// Is TS supported by host?</span>
        {
            <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a25835ffc35b7d02038a899a25657870b">sack_support</a>) <span class="comment">// if SACK is supported by host, do not add NOPs to this segment</span>
            {
                <span class="comment">// 2 padding bytes</span>
                option.setKind(TCPOPTION_NO_OPERATION); <span class="comment">// NOP</span>
                option.setLength(1);
                option.setValuesArraySize(0);
                tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+2);
                tcpseg-&gt;setOptions(t,option);
                t++;
                tcpseg-&gt;setOptions(t,option);
                t++;
            }

            option.setKind(TCPOPTION_TIMESTAMP);
            option.setLength(10);
            option.setValuesArraySize(2);

            <span class="comment">// Update TS variables</span>
            <span class="comment">// RFC 1323, page 13: &quot;The Timestamp Value field (TSval) contains the current value of the timestamp clock of the TCP sending the option.&quot;</span>
            option.setValues(0,<a class="code" href="class_t_c_p_connection.html#ad2ab4393f60b26351d445334d4626cc7">convertSimtimeToTS</a>(simTime()));
            <span class="comment">// RFC 1323, page 16: &quot;(3) When a TSopt is sent, its TSecr field is set to the current TS.Recent value.&quot;</span>
            <span class="comment">// RFC 1323, page 13:</span>
            <span class="comment">// &quot;The Timestamp Echo Reply field (TSecr) is only valid if the ACK</span>
            <span class="comment">// bit is set in the TCP header; if it is valid, it echos a times-</span>
            <span class="comment">// tamp value that was sent by the remote TCP in the TSval field</span>
            <span class="comment">// of a Timestamps option.  When TSecr is not valid, its value</span>
            <span class="comment">// must be zero.&quot;</span>
            <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
                option.setValues(1,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a>);
            <span class="keywordflow">else</span>
                option.setValues(1,0);
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af7b6cdf9719efff842f3b29b7f65e7a0">snd_initial_ts</a> = <span class="keyword">true</span>;
            <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> = <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8c78c2a8ced36433f68e1668e9ac4eaf">ts_support</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#af7b6cdf9719efff842f3b29b7f65e7a0">snd_initial_ts</a> &amp;&amp; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a21ba446400701446863088050d7a6173">rcv_initial_ts</a>;
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option TS(TSval=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;, TSecr=&quot;</span> &lt;&lt; option.getValues(1) &lt;&lt; <span class="stringliteral">&quot;) sent, TS (ts_enabled) is set to: &quot;</span> &lt;&lt; <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;
        }

        <span class="comment">// TODO add new TCPOptions here once they are implemented</span>
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca70c06b27000be54aee473572dd755890">TCP_S_SYN_SENT</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca6d12bc57c1710f3d93ee80e392e1361f">TCP_S_SYN_RCVD</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaa8c5be2b3d7977abc27dfc396001f467">TCP_S_ESTABLISHED</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfeca2cf3a0cecd0eeeed17966b0c4f208964">TCP_S_FIN_WAIT_1</a> || <a class="code" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">fsm</a>.getState()==<a class="code" href="_t_c_p_connection_8h.html#a4310b47e70de394d33f7cf601e35bfecaba28bfede161fc6d56ec1d30a363e463">TCP_S_FIN_WAIT_2</a>) <span class="comment">// connetion is not in INIT or LISTEN state</span>
    {
        <span class="comment">// TS header option</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>) <span class="comment">// Is TS enabled?</span>
        {
            <span class="keywordflow">if</span> (!(<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> || <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>))) <span class="comment">// if SACK is enabled and SACKs need to be added, do not add NOPs to this segment</span>
            {
                <span class="comment">// 2 padding bytes</span>
                option.setKind(TCPOPTION_NO_OPERATION); <span class="comment">// NOP</span>
                option.setLength(1);
                option.setValuesArraySize(0);
                tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+2);
                tcpseg-&gt;setOptions(t,option);
                t++;
                tcpseg-&gt;setOptions(t,option);
                t++;
            }

            option.setKind(TCPOPTION_TIMESTAMP);
            option.setLength(10);
            option.setValuesArraySize(2);

            <span class="comment">// Update TS variables</span>
            <span class="comment">// RFC 1323, page 13: &quot;The Timestamp Value field (TSval) contains the current value of the timestamp clock of the TCP sending the option.&quot;</span>
            option.setValues(0,<a class="code" href="class_t_c_p_connection.html#ad2ab4393f60b26351d445334d4626cc7">convertSimtimeToTS</a>(simTime()));
            <span class="comment">// RFC 1323, page 16: &quot;(3) When a TSopt is sent, its TSecr field is set to the current TS.Recent value.&quot;</span>
            <span class="comment">// RFC 1323, page 13:</span>
            <span class="comment">// &quot;The Timestamp Echo Reply field (TSecr) is only valid if the ACK</span>
            <span class="comment">// bit is set in the TCP header; if it is valid, it echos a times-</span>
            <span class="comment">// tamp value that was sent by the remote TCP in the TSval field</span>
            <span class="comment">// of a Timestamps option.  When TSecr is not valid, its value</span>
            <span class="comment">// must be zero.&quot;</span>
            <span class="keywordflow">if</span> (tcpseg-&gt;getAckBit())
                option.setValues(1,<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a559dbf80a5c95f70cfb3f899326d8cb5">ts_recent</a>);
            <span class="keywordflow">else</span>
                option.setValues(1,0);
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;TCP Header Option TS(TSval=&quot;</span> &lt;&lt; option.getValues(0) &lt;&lt; <span class="stringliteral">&quot;, TSecr=&quot;</span> &lt;&lt; option.getValues(1) &lt;&lt; <span class="stringliteral">&quot;) sent\n&quot;</span>;
            tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+1);
            tcpseg-&gt;setOptions(t,option);
            t++;
        }

        <span class="comment">// SACK header option</span>

        <span class="comment">// RFC 2018, page 4:</span>
        <span class="comment">// &quot;If sent at all, SACK options SHOULD be included in all ACKs which do</span>
        <span class="comment">// not ACK the highest sequence number in the data receiver&#39;s queue.  In</span>
        <span class="comment">// this situation the network has lost or mis-ordered data, such that</span>
        <span class="comment">// the receiver holds non-contiguous data in its queue.  RFC 1122,</span>
        <span class="comment">// Section 4.2.2.21, discusses the reasons for the receiver to send ACKs</span>
        <span class="comment">// in response to additional segments received in this state.  The</span>
        <span class="comment">// receiver SHOULD send an ACK for every valid segment that arrives</span>
        <span class="comment">// containing new data, and each of these &quot;duplicate&quot; ACKs SHOULD bear a</span>
        <span class="comment">// SACK option.&quot;</span>
        <span class="keywordflow">if</span> (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a47c0467054bd0209efc992c63d5d4d04">sack_enabled</a> &amp;&amp; (<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#ad03a121385224b940565040fe9eb433a">snd_sack</a> || <a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#a8a15484ad9b2724916935eab69c6693f">snd_dsack</a>))
        {
            <span class="keywordflow">if</span> (!<a class="code" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">state</a>-&gt;<a class="code" href="class_t_c_p_state_variables.html#aea39bfb1176d367d349fb4efcbbe807f">ts_enabled</a>) <span class="comment">// if TS is enabled, do not add NOPs to this segment</span>
            {
                <span class="comment">// 2 padding bytes</span>
                option.setKind(TCPOPTION_NO_OPERATION); <span class="comment">// NOP</span>
                option.setLength(1);
                option.setValuesArraySize(0);
                tcpseg-&gt;setOptionsArraySize(tcpseg-&gt;getOptionsArraySize()+2);
                tcpseg-&gt;setOptions(t,option);
                t++;
                tcpseg-&gt;setOptions(t,option);
                t++;
            }

            <a class="code" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks</a>(tcpseg);
            t++;
        }

        <span class="comment">// TODO add new TCPOptions here once they are implemented</span>

        <span class="comment">// TODO delegate to TCPAlgorithm as well -- it may want to append additional options</span>
    }

    <span class="keywordflow">if</span> (tcpseg-&gt;getOptionsArraySize() != 0)
    {
        <a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> options_len = 0;
        <span class="keywordflow">for</span> (<a class="code" href="_i_n_e_t_defs_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i=0; i&lt;tcpseg-&gt;getOptionsArraySize(); i++)
            options_len = options_len + tcpseg-&gt;getOptions(i).getLength();

        <span class="keywordflow">if</span> (options_len &lt;= 40) <span class="comment">// Options length allowed? - maximum: 40 Bytes</span>
            tcpseg-&gt;setHeaderLength(TCP_HEADER_OCTETS+options_len); <span class="comment">// TCP_HEADER_OCTETS = 20</span>
        <span class="keywordflow">else</span>
        {
            tcpseg-&gt;setHeaderLength(TCP_HEADER_OCTETS); <span class="comment">// TCP_HEADER_OCTETS = 20</span>
            tcpseg-&gt;setOptionsArraySize(0); <span class="comment">// drop all options</span>
            <a class="code" href="_t_c_p_8h.html#a601325e92d65fe658c80eab711e12304">tcpEV</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Options length exceeded! Segment will be sent without options&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }

    <span class="keywordflow">return</span> *tcpseg;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ac07531e9f1e23e1da9d4263f0da58cd9"></a><!-- doxytag: member="TCPConnection::appGateIndex" ref="ac07531e9f1e23e1da9d4263f0da58cd9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#ac07531e9f1e23e1da9d4263f0da58cd9">TCPConnection::appGateIndex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp()</a>, and <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a93b66fc68b48870a93479aa0bf4ac773"></a><!-- doxytag: member="TCPConnection::connEstabTimer" ref="a93b66fc68b48870a93479aa0bf4ac773" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#a93b66fc68b48870a93479aa0bf4ac773">TCPConnection::connEstabTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fee1d63c934294942e34b17a92d2fd5"></a><!-- doxytag: member="TCPConnection::connId" ref="a6fee1d63c934294942e34b17a92d2fd5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#a6fee1d63c934294942e34b17a92d2fd5">TCPConnection::connId</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp()</a>, and <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="abceb1f0559f6e8c9f0e8d906b3e124e7"></a><!-- doxytag: member="TCPConnection::dupAcksVector" ref="abceb1f0559f6e8c9f0e8d906b3e124e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#abceb1f0559f6e8c9f0e8d906b3e124e7">TCPConnection::dupAcksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5a1fb22c64b7f9edd700721bdec1d20"></a><!-- doxytag: member="TCPConnection::finWait2Timer" ref="ab5a1fb22c64b7f9edd700721bdec1d20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#ab5a1fb22c64b7f9edd700721bdec1d20">TCPConnection::finWait2Timer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="af7032e0a7991f87167efce40df32535e"></a><!-- doxytag: member="TCPConnection::fsm" ref="af7032e0a7991f87167efce40df32535e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cFSM <a class="el" href="class_t_c_p_connection.html#af7032e0a7991f87167efce40df32535e">TCPConnection::fsm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT()</a>, <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#ae29072ef963e593c4c3053827ebbec6e">process_TIMEOUT_2MSL()</a>, <a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="class_t_c_p_connection.html#a53d62d237307ad56bae8d320ff557e48">process_TIMEOUT_FIN_WAIT_2()</a>, <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption()</a>, <a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption()</a>, <a class="el" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#adc95d91946a80a2ad98b0d0b1e40909e">processTSOption()</a>, <a class="el" href="class_t_c_p_connection.html#a83bb4cd8bc8912d6bfbf6e7e5b47e4b2">processWSOption()</a>, <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions()</a>.</p>

</div>
</div>
<a class="anchor" id="a08c53cabdcc750399f2af42d7c04d8e7"></a><!-- doxytag: member="TCPConnection::localAddr" ref="a08c53cabdcc750399f2af42d7c04d8e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#a08c53cabdcc750399f2af42d7c04d8e7">TCPConnection::localAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">TCP::addSockPair()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, and <a class="el" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a248676b3def3f1af2dd46b9520ba4e96"></a><!-- doxytag: member="TCPConnection::localPort" ref="a248676b3def3f1af2dd46b9520ba4e96" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#a248676b3def3f1af2dd46b9520ba4e96">TCPConnection::localPort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">TCP::addSockPair()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>, and <a class="el" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="af4bd1681a62ef1ce6ac4237ed64bf468"></a><!-- doxytag: member="TCPConnection::pipeVector" ref="af4bd1681a62ef1ce6ac4237ed64bf468" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#af4bd1681a62ef1ce6ac4237ed64bf468">TCPConnection::pipeVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="abe4b8c8de0df4555c93fc23dcb099893"></a><!-- doxytag: member="TCPConnection::rcvAckVector" ref="abe4b8c8de0df4555c93fc23dcb099893" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#abe4b8c8de0df4555c93fc23dcb099893">TCPConnection::rcvAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a985637bb70c925f74fa6ad8bb53af0d0"></a><!-- doxytag: member="TCPConnection::rcvAdvVector" ref="a985637bb70c925f74fa6ad8bb53af0d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a985637bb70c925f74fa6ad8bb53af0d0">TCPConnection::rcvAdvVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a6ae35f9e338201b6f1f36e1c0aaf9acb"></a><!-- doxytag: member="TCPConnection::rcvOooSegVector" ref="a6ae35f9e338201b6f1f36e1c0aaf9acb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a6ae35f9e338201b6f1f36e1c0aaf9acb">TCPConnection::rcvOooSegVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a88d83f671702d2b86f59942b94165daa"></a><!-- doxytag: member="TCPConnection::rcvSacksVector" ref="a88d83f671702d2b86f59942b94165daa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a88d83f671702d2b86f59942b94165daa">TCPConnection::rcvSacksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a02c1500cf2719ebc20fe5e44ca9c663f"></a><!-- doxytag: member="TCPConnection::rcvSeqVector" ref="a02c1500cf2719ebc20fe5e44ca9c663f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a02c1500cf2719ebc20fe5e44ca9c663f">TCPConnection::rcvSeqVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae5a0350b06c4be2dd4285230e08717cd"></a><!-- doxytag: member="TCPConnection::rcvWndVector" ref="ae5a0350b06c4be2dd4285230e08717cd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#ae5a0350b06c4be2dd4285230e08717cd">TCPConnection::rcvWndVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a1f9a74ed0fae5b105a1a1cfb2bab9006"></a><!-- doxytag: member="TCPConnection::receiveQueue" ref="a1f9a74ed0fae5b105a1a1cfb2bab9006" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_receive_queue.html">TCPReceiveQueue</a>* <a class="el" href="class_t_c_p_connection.html#a1f9a74ed0fae5b105a1a1cfb2bab9006">TCPConnection::receiveQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars()</a>, <a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="aee1b7ed1b1412bf36a125fcbab3e9e34"></a><!-- doxytag: member="TCPConnection::remoteAddr" ref="aee1b7ed1b1412bf36a125fcbab3e9e34" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_i_pv_x_address.html">IPvXAddress</a> <a class="el" href="class_t_c_p_connection.html#aee1b7ed1b1412bf36a125fcbab3e9e34">TCPConnection::remoteAddr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">TCP::addSockPair()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, and <a class="el" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="aab271d97998bcfc7477fc1d99af2df08"></a><!-- doxytag: member="TCPConnection::remotePort" ref="aab271d97998bcfc7477fc1d99af2df08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_t_c_p_connection.html#aab271d97998bcfc7477fc1d99af2df08">TCPConnection::remotePort</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p.html#abec1cedad1e72a349f7bd804501584fa">TCP::addForkedConnection()</a>, <a class="el" href="class_t_c_p.html#a0521bf14a4f31786b1869f417d56eecb">TCP::addSockPair()</a>, <a class="el" href="class_t_c_p_connection.html#a8aaec47dd8098dbaa015f2e3e7b16442">printConnBrief()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#a7f5f8ddb99114615c77fe0ccf16424e7">processTCPSegment()</a>, <a class="el" href="class_t_c_p.html#a43b1ce87aa8f1f864fef4fef8c48892d">TCP::removeConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#afa03f88fc4589249aefe6f828eed9dd6">sendRst()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>, and <a class="el" href="class_t_c_p.html#a89cade3eb3a3f44ffae57c08dedd9285">TCP::updateSockPair()</a>.</p>

</div>
</div>
<a class="anchor" id="a7de9df6b234a7dabb5b5e7eb7520734d"></a><!-- doxytag: member="TCPConnection::rexmitQueue" ref="a7de9df6b234a7dabb5b5e7eb7520734d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_s_a_c_k_rexmit_queue.html">TCPSACKRexmitQueue</a>* <a class="el" href="class_t_c_p_connection.html#a7de9df6b234a7dabb5b5e7eb7520734d">TCPConnection::rexmitQueue</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost()</a>, <a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_base_alg.html#ac8a305a437d4eafd1689204e50af8870">TCPBaseAlg::processRexmitTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived()</a>, <a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a7c229fb19da75c880c60a41280721d0e"></a><!-- doxytag: member="TCPConnection::sackedBytesVector" ref="a7c229fb19da75c880c60a41280721d0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a7c229fb19da75c880c60a41280721d0e">TCPConnection::sackedBytesVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a0dec48343ab1df2cc4157a3da114f54e"></a><!-- doxytag: member="TCPConnection::sendQueue" ref="a0dec48343ab1df2cc4157a3da114f54e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_send_queue.html">TCPSendQueue</a>* <a class="el" href="class_t_c_p_connection.html#a0dec48343ab1df2cc4157a3da114f54e">TCPConnection::sendQueue</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#aafbfa20356a296e70ca483daa9132460">isSendQueueEmpty()</a>, <a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg()</a>, <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="af597155e6e0a1417ca5fd8cab178fcce"></a><!-- doxytag: member="TCPConnection::sndAckVector" ref="af597155e6e0a1417ca5fd8cab178fcce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#af597155e6e0a1417ca5fd8cab178fcce">TCPConnection::sndAckVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a67990b92349ae122edcf1d0a1a6b004c"></a><!-- doxytag: member="TCPConnection::sndNxtVector" ref="a67990b92349ae122edcf1d0a1a6b004c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a67990b92349ae122edcf1d0a1a6b004c">TCPConnection::sndNxtVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a19d5bebef3053d95b66713e1e78e4200"></a><!-- doxytag: member="TCPConnection::sndSacksVector" ref="a19d5bebef3053d95b66713e1e78e4200" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a19d5bebef3053d95b66713e1e78e4200">TCPConnection::sndSacksVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a21c55311a3c27fe7808c962a5faffdf5"></a><!-- doxytag: member="TCPConnection::sndWndVector" ref="a21c55311a3c27fe7808c962a5faffdf5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a21c55311a3c27fe7808c962a5faffdf5">TCPConnection::sndWndVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a4780b0038982452cef8139e04f84b4c8"></a><!-- doxytag: member="TCPConnection::state" ref="a4780b0038982452cef8139e04f84b4c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_state_variables.html">TCPStateVariables</a>* <a class="el" href="class_t_c_p_connection.html#a4780b0038982452cef8139e04f84b4c8">TCPConnection::state</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#afada098bf955db81aa1786f33c813363">addSacks()</a>, <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a261dc1ebd41e03d655b112f2b82b3f08">isLost()</a>, <a class="el" href="class_t_c_p_connection.html#acceb561b23349d06b298858e39433435">isSegmentAcceptable()</a>, <a class="el" href="class_t_c_p_connection.html#aafbfa20356a296e70ca483daa9132460">isSendQueueEmpty()</a>, <a class="el" href="class_t_c_p_connection.html#ae8d9450252219a54062112f6d8688309">nextSeg()</a>, <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>, <a class="el" href="class_t_c_p_connection.html#afb2189f1428627dcde1d1b0bfbc50833">process_ABORT()</a>, <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a46ac1b09624942471db2eb76ef991143">process_RCV_SEGMENT()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#a519a2b6612737fbdbd5641dfa33833e8">process_STATUS()</a>, <a class="el" href="class_t_c_p_connection.html#a7b47d21fa8a97f13cab52097f3332ea6">process_TIMEOUT_CONN_ESTAB()</a>, <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#a632302213a1f4344d908bdfd1509323d">processMSSOption()</a>, <a class="el" href="class_t_c_p_connection.html#a4d240ca8f36aa37a29b8bcc44ec052cd">processRstInSynReceived()</a>, <a class="el" href="class_t_c_p_connection.html#a33b50078727564bd2c4e7e906e2f1648">processSACKOption()</a>, <a class="el" href="class_t_c_p_connection.html#a009bb98808477c6cbf9b0b82c3ae2ca4">processSACKPermittedOption()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#adc95d91946a80a2ad98b0d0b1e40909e">processTSOption()</a>, <a class="el" href="class_t_c_p_connection.html#a83bb4cd8bc8912d6bfbf6e7e5b47e4b2">processWSOption()</a>, <a class="el" href="class_t_c_p_connection.html#ab2c57b0ff79eb111ca6840b8d7003b04">retransmitData()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a82f6b7680530f0f784e9d8efa78fa5a5">segmentArrivalWhileClosed()</a>, <a class="el" href="class_t_c_p_connection.html#a585bbcdd70565eb01b6bfe17a1487c78">selectInitialSeqNum()</a>, <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a4fb6aaf244a5da2eaa02af271099a06b">sendDataDuringLossRecoveryPhase()</a>, <a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin()</a>, <a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a>, <a class="el" href="class_t_c_p_connection.html#af71155c4fad49ea52907d840463a06d5">sendSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="class_t_c_p_connection.html#abcd8f7efecc7c0077050184d3384b493">sendSyn()</a>, <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, <a class="el" href="class_t_c_p_connection.html#a728bea28fa24566bb22935f0de7c4655">setPipe()</a>, <a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars()</a>, <a class="el" href="class_t_c_p_connection.html#ac8e75cb648c459b120d0ab2a8ae1cf74">updateRcvWnd()</a>, <a class="el" href="class_t_c_p_connection.html#af1daa72bce81fcdc2cb7ccb03c134b7b">updateWndInfo()</a>, <a class="el" href="class_t_c_p_connection.html#a617d790b0cf1905e60c226dff8174a23">writeHeaderOptions()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad2e24541092cf4c58f67845e6621f3cb"></a><!-- doxytag: member="TCPConnection::synRexmitTimer" ref="ad2e24541092cf4c58f67845e6621f3cb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#ad2e24541092cf4c58f67845e6621f3cb">TCPConnection::synRexmitTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a33c6fe420de8b7fc6c09761f70118ed0">process_TIMEOUT_SYN_REXMIT()</a>, <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>, <a class="el" href="class_t_c_p_connection.html#aa58f44bc38ec0af46aca654f9403771f">startSynRexmitTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a305b76fec9de3d8524f7ae5cf1dd55f0"></a><!-- doxytag: member="TCPConnection::tcpAlgorithm" ref="a305b76fec9de3d8524f7ae5cf1dd55f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p_algorithm.html">TCPAlgorithm</a>* <a class="el" href="class_t_c_p_connection.html#a305b76fec9de3d8524f7ae5cf1dd55f0">TCPConnection::tcpAlgorithm</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, <a class="el" href="class_t_c_p_connection.html#a65fa8d6570761c63cdab5cef7f5df685">process_SEND()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a60ee5bc5b391d621e7e684857e195151">sendAck()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a70acf513d8461c73bfd06037036b1682">sendFin()</a>, <a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a>, <a class="el" href="class_t_c_p_connection.html#ade3c9c38be0aa758b4eb448d5c1169b9">sendRstAck()</a>, <a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="class_t_c_p_connection.html#a675b131a43de7429552a574cabcc12dd">sendSynAck()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ae74f100a2d121edee4b0e167596b8ac5"></a><!-- doxytag: member="TCPConnection::tcpMain" ref="ae74f100a2d121edee4b0e167596b8ac5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_t_c_p.html">TCP</a>* <a class="el" href="class_t_c_p_connection.html#ae74f100a2d121edee4b0e167596b8ac5">TCPConnection::tcpMain</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a1d5624dcbc77e79d142f6a886b3e788d">cloneListeningConnection()</a>, <a class="el" href="class_t_c_p_connection.html#a8ddd3d422b9d6e00ad15cf99f9870ef4">configureStateVariables()</a>, <a class="el" href="class_t_c_p_connection.html#a69caa8ea0ffbe8d9f73f935aac1b29d9">initConnection()</a>, <a class="el" href="class_t_c_p_connection.html#aa1fe5fa359d4063c984d686e4166b798">performStateTransition()</a>, <a class="el" href="class_t_c_p_connection.html#a6ef625498d593ac11744aa92a404e06d">process_OPEN_ACTIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a26e4a86dfbc1efaf02e99ea14d410ae3">process_OPEN_PASSIVE()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#ab04a91abde05d21293c30a78ab968eef">sendEstabIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a65a8dc93c08a685f145248d0fb327428">sendIndicationToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a6aa48826843116a0f5c4e0fa37a69cfc">sendToApp()</a>, <a class="el" href="class_t_c_p_connection.html#a86143cf35f957006c5fe17c506be21c7">sendToIP()</a>, and <a class="el" href="class_t_c_p_connection.html#aab510bb961623a41ade36bfbda9f86b6">TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d09993cf4b38b48fd5d4d51b7842607"></a><!-- doxytag: member="TCPConnection::tcpRcvQueueBytesVector" ref="a3d09993cf4b38b48fd5d4d51b7842607" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a3d09993cf4b38b48fd5d4d51b7842607">TCPConnection::tcpRcvQueueBytesVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, <a class="el" href="class_t_c_p_connection.html#ae25d720620d8fe927087e1af0692ed90">updateRcvQueueVars()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="ad24c6dbc6d3b7e143ca4fc180092aa6b"></a><!-- doxytag: member="TCPConnection::tcpRcvQueueDropsVector" ref="ad24c6dbc6d3b7e143ca4fc180092aa6b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#ad24c6dbc6d3b7e143ca4fc180092aa6b">TCPConnection::tcpRcvQueueDropsVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a4d034577df86997140d627feeda66a1f">processSegmentInListen()</a>, <a class="el" href="class_t_c_p_connection.html#a12b903f9e148f5c26f926dcdc8107c86">processSegmentInSynSent()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ea0361f0b40f10bc9a3ce397b2c0e2f"></a><!-- doxytag: member="TCPConnection::the2MSLTimer" ref="a0ea0361f0b40f10bc9a3ce397b2c0e2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="class_t_c_p_connection.html#a0ea0361f0b40f10bc9a3ce397b2c0e2f">TCPConnection::the2MSLTimer</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#aa0758284e5bd6bd162b6ff267add2e2d">processSegment1stThru8th()</a>, <a class="el" href="class_t_c_p_connection.html#a6f9e1e7a0cabaf710f2d37a19eea0caf">processTimer()</a>, <a class="el" href="class_t_c_p_connection.html#a1be68d20f98e68b01ef9267a8dd2088a">stateEntered()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<a class="anchor" id="a7cc325d99a5b02944a46c6a425fd01fc"></a><!-- doxytag: member="TCPConnection::unackedVector" ref="a7cc325d99a5b02944a46c6a425fd01fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cOutVector* <a class="el" href="class_t_c_p_connection.html#a7cc325d99a5b02944a46c6a425fd01fc">TCPConnection::unackedVector</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="class_t_c_p_connection.html#a5aa9b20651a4c1f90772a7c02eacbf05">process_CLOSE()</a>, <a class="el" href="class_t_c_p_connection.html#ac1144f5ca6e960176d6e623998cb7456">processAckInEstabEtc()</a>, <a class="el" href="class_t_c_p_connection.html#a8ae68910942bd1ea6558ae7849ae22ea">retransmitOneSegment()</a>, <a class="el" href="class_t_c_p_connection.html#a0238c323366884c6598d7d92d21f69ab">sendData()</a>, <a class="el" href="class_t_c_p_connection.html#a35768c6517e5f25424a13d1e80892b32">sendOneNewSegment()</a>, <a class="el" href="class_t_c_p_connection.html#ab07a8b0ce79c80e9baf75c3e82f56937">sendProbe()</a>, <a class="el" href="class_t_c_p_connection.html#ac922b39992f510ef7803067e675d80f1">sendSegmentDuringLossRecoveryPhase()</a>, <a class="el" href="class_t_c_p_connection.html#a11a3cccb118b0b66bee1a07929510e4c">TCPConnection()</a>, and <a class="el" href="class_t_c_p_connection.html#a0b79ac9c31e99766954c9cca733a362d">~TCPConnection()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_t_c_p_connection_8h.html">TCPConnection.h</a></li>
<li><a class="el" href="_t_c_p_connection_base_8cc.html">TCPConnectionBase.cc</a></li>
<li><a class="el" href="_t_c_p_connection_event_proc_8cc.html">TCPConnectionEventProc.cc</a></li>
<li><a class="el" href="_t_c_p_connection_rcv_segment_8cc.html">TCPConnectionRcvSegment.cc</a></li>
<li><a class="el" href="_t_c_p_connection_util_8cc.html">TCPConnectionUtil.cc</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_t_c_p_connection.html">TCPConnection</a>      </li>
      <li class="footer">Generated on Fri Nov 18 2011 12:47:16 for INET Framework for OMNeT++/OMNEST by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
